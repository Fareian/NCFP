{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 55, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/USER/Desktop/WORK/new_creation/lib/config.ts"],"sourcesContent":["const config = {\r\n  env: {\r\n    apiEndpoint: process.env.NEXT_PUBLIC_API_ENDPOINT!,\r\n    prodApiEndpoint: process.env.NEXT_PUBLIC_PROD_API_ENDPOINT!,\r\n    imagekit: {\r\n      publicKey: process.env.NEXT_PUBLIC_IMAGEKIT_PUBLIC_KEY!,\r\n      urlEndpoint: process.env.NEXT_PUBLIC_IMAGEKIT_URL_ENDPOINT!,\r\n      privateKey: process.env.IMAGEKIT_PRIVATE_KEY!,\r\n    },\r\n    databaseUrl: process.env.DATABASE_URL!,\r\n    upstash: {\r\n      redisUrl: process.env.UPSTASH_REDIS_URL!,\r\n      redisToken: process.env.UPSTASH_REDIS_TOKEN!,\r\n      qstashUrl: process.env.QSTASH_URL!,\r\n      qstashToken: process.env.QSTASH_TOKEN!,\r\n    },\r\n    resendToken: process.env.RESEND_TOKEN!,\r\n  },\r\n};\r\n\r\nexport default config;\r\n"],"names":[],"mappings":";;;AAAA,MAAM,SAAS;IACb,KAAK;QACH,WAAW;QACX,eAAe;QACf,UAAU;YACR,SAAS;YACT,WAAW;YACX,YAAY,QAAQ,GAAG,CAAC,oBAAoB;QAC9C;QACA,aAAa,QAAQ,GAAG,CAAC,YAAY;QACrC,SAAS;YACP,UAAU,QAAQ,GAAG,CAAC,iBAAiB;YACvC,YAAY,QAAQ,GAAG,CAAC,mBAAmB;YAC3C,WAAW,QAAQ,GAAG,CAAC,UAAU;YACjC,aAAa,QAAQ,GAAG,CAAC,YAAY;QACvC;QACA,aAAa,QAAQ,GAAG,CAAC,YAAY;IACvC;AACF;uCAEe"}},
    {"offset": {"line": 78, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 84, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/USER/Desktop/WORK/new_creation/database/drizzle.ts"],"sourcesContent":["import config from \"@/lib/config\";\nimport { drizzle } from \"drizzle-orm/neon-http\";\nimport { neon } from \"@neondatabase/serverless\";\n\nconst sql = neon(config.env.databaseUrl);\n\nexport const db = drizzle(sql);"],"names":[],"mappings":";;;AAAA;AAEA;AADA;;;;AAGA,MAAM,MAAM,CAAA,GAAA,wJAAA,CAAA,OAAI,AAAD,EAAE,+GAAA,CAAA,UAAM,CAAC,GAAG,CAAC,WAAW;AAEhC,MAAM,KAAK,CAAA,GAAA,0JAAA,CAAA,UAAO,AAAD,EAAE"}},
    {"offset": {"line": 95, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 101, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/USER/Desktop/WORK/new_creation/database/schema.ts"],"sourcesContent":["import {\n  varchar,\n  uuid,\n  integer,\n  text,\n  pgTable,\n  date,\n  pgEnum,\n  timestamp,\n} from \"drizzle-orm/pg-core\";\n\nexport const STATUS_ENUM = pgEnum(\"status\", [\n  \"PENDING\",\n  \"APPROVED\",\n  \"REJECTED\",\n]);\nexport const ROLE_ENUM = pgEnum(\"role\", [\"USER\", \"ADMIN\"]);\n\nexport const users = pgTable(\"users\", {\n  id: uuid(\"id\").notNull().primaryKey().defaultRandom().unique(),\n  fullName: varchar(\"full_name\", { length: 255 }).notNull(),\n  email: text(\"email\").notNull().unique(),\n  password: text(\"password\").notNull(),\n  phone: varchar(\"phone\", { length: 20 }),\n  downloads: integer(\"downloads\").notNull().default(0),\n  status: STATUS_ENUM(\"status\").default(\"PENDING\"),\n  role: ROLE_ENUM(\"role\").default(\"USER\"),\n  lastActivityDate: date(\"last_activity_date\").defaultNow(),\n  createdAt: timestamp(\"created_at\", {\n    withTimezone: true,\n  }).defaultNow(),\n});\n\nexport const books = pgTable(\"books\", {\n  id: uuid(\"id\").notNull().primaryKey().defaultRandom().unique(),\n  title: varchar(\"title\", { length: 255 }).notNull(),\n  author: varchar(\"author\", { length: 255 }).notNull(),\n  category: text(\"category\").notNull(),\n  coverUrl: text(\"cover_url\").notNull(),\n  coverColor: varchar(\"cover_color\", { length: 7 }).notNull(),\n  description: text(\"description\").notNull(),\n  summary: varchar(\"summary\").notNull(),\n  fileUrl: text(\"file_url\").notNull(), \n  createdAt: timestamp(\"created_at\", { withTimezone: true }).defaultNow(),\n});\n\nexport const articles = pgTable(\"articles\", {\n  id: uuid(\"id\").notNull().primaryKey().defaultRandom().unique(),\n  title: varchar(\"title\", { length: 255 }).notNull(),\n  author: varchar(\"author\", { length: 255 }).notNull(),\n  summary: varchar(\"summary\", { length: 500 }).notNull(),\n  content: text(\"content\").notNull(),\n  coverUrl: text(\"cover_url\").notNull(),\n  createdAt: timestamp(\"created_at\", { withTimezone: true }).defaultNow(),\n});\n\nexport const downloadLogs = pgTable(\"download_logs\", {\n  id: uuid(\"id\").notNull().primaryKey().defaultRandom().unique(),\n  userId: uuid(\"user_id\").notNull(),\n  bookId: uuid(\"book_id\").notNull(),\n  timestamp: timestamp(\"timestamp\", { withTimezone: true }).defaultNow(),\n});\n"],"names":[],"mappings":";;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;AAWO,MAAM,cAAc,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,UAAU;IAC1C;IACA;IACA;CACD;AACM,MAAM,YAAY,CAAA,GAAA,iKAAA,CAAA,SAAM,AAAD,EAAE,QAAQ;IAAC;IAAQ;CAAQ;AAElD,MAAM,QAAQ,CAAA,GAAA,uJAAA,CAAA,UAAO,AAAD,EAAE,SAAS;IACpC,IAAI,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,MAAM,OAAO,GAAG,UAAU,GAAG,aAAa,GAAG,MAAM;IAC5D,UAAU,CAAA,GAAA,oKAAA,CAAA,UAAO,AAAD,EAAE,aAAa;QAAE,QAAQ;IAAI,GAAG,OAAO;IACvD,OAAO,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,SAAS,OAAO,GAAG,MAAM;IACrC,UAAU,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,YAAY,OAAO;IAClC,OAAO,CAAA,GAAA,oKAAA,CAAA,UAAO,AAAD,EAAE,SAAS;QAAE,QAAQ;IAAG;IACrC,WAAW,CAAA,GAAA,oKAAA,CAAA,UAAO,AAAD,EAAE,aAAa,OAAO,GAAG,OAAO,CAAC;IAClD,QAAQ,YAAY,UAAU,OAAO,CAAC;IACtC,MAAM,UAAU,QAAQ,OAAO,CAAC;IAChC,kBAAkB,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,sBAAsB,UAAU;IACvD,WAAW,CAAA,GAAA,sKAAA,CAAA,YAAS,AAAD,EAAE,cAAc;QACjC,cAAc;IAChB,GAAG,UAAU;AACf;AAEO,MAAM,QAAQ,CAAA,GAAA,uJAAA,CAAA,UAAO,AAAD,EAAE,SAAS;IACpC,IAAI,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,MAAM,OAAO,GAAG,UAAU,GAAG,aAAa,GAAG,MAAM;IAC5D,OAAO,CAAA,GAAA,oKAAA,CAAA,UAAO,AAAD,EAAE,SAAS;QAAE,QAAQ;IAAI,GAAG,OAAO;IAChD,QAAQ,CAAA,GAAA,oKAAA,CAAA,UAAO,AAAD,EAAE,UAAU;QAAE,QAAQ;IAAI,GAAG,OAAO;IAClD,UAAU,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,YAAY,OAAO;IAClC,UAAU,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,aAAa,OAAO;IACnC,YAAY,CAAA,GAAA,oKAAA,CAAA,UAAO,AAAD,EAAE,eAAe;QAAE,QAAQ;IAAE,GAAG,OAAO;IACzD,aAAa,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,eAAe,OAAO;IACxC,SAAS,CAAA,GAAA,oKAAA,CAAA,UAAO,AAAD,EAAE,WAAW,OAAO;IACnC,SAAS,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,YAAY,OAAO;IACjC,WAAW,CAAA,GAAA,sKAAA,CAAA,YAAS,AAAD,EAAE,cAAc;QAAE,cAAc;IAAK,GAAG,UAAU;AACvE;AAEO,MAAM,WAAW,CAAA,GAAA,uJAAA,CAAA,UAAO,AAAD,EAAE,YAAY;IAC1C,IAAI,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,MAAM,OAAO,GAAG,UAAU,GAAG,aAAa,GAAG,MAAM;IAC5D,OAAO,CAAA,GAAA,oKAAA,CAAA,UAAO,AAAD,EAAE,SAAS;QAAE,QAAQ;IAAI,GAAG,OAAO;IAChD,QAAQ,CAAA,GAAA,oKAAA,CAAA,UAAO,AAAD,EAAE,UAAU;QAAE,QAAQ;IAAI,GAAG,OAAO;IAClD,SAAS,CAAA,GAAA,oKAAA,CAAA,UAAO,AAAD,EAAE,WAAW;QAAE,QAAQ;IAAI,GAAG,OAAO;IACpD,SAAS,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,WAAW,OAAO;IAChC,UAAU,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,aAAa,OAAO;IACnC,WAAW,CAAA,GAAA,sKAAA,CAAA,YAAS,AAAD,EAAE,cAAc;QAAE,cAAc;IAAK,GAAG,UAAU;AACvE;AAEO,MAAM,eAAe,CAAA,GAAA,uJAAA,CAAA,UAAO,AAAD,EAAE,iBAAiB;IACnD,IAAI,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,MAAM,OAAO,GAAG,UAAU,GAAG,aAAa,GAAG,MAAM;IAC5D,QAAQ,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,WAAW,OAAO;IAC/B,QAAQ,CAAA,GAAA,iKAAA,CAAA,OAAI,AAAD,EAAE,WAAW,OAAO;IAC/B,WAAW,CAAA,GAAA,sKAAA,CAAA,YAAS,AAAD,EAAE,aAAa;QAAE,cAAc;IAAK,GAAG,UAAU;AACtE"}},
    {"offset": {"line": 190, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 212, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/USER/Desktop/WORK/new_creation/auth.ts"],"sourcesContent":["import NextAuth, { User } from \"next-auth\";\nimport { compare } from \"bcryptjs\";\nimport CredentialsProvider from \"next-auth/providers/credentials\";\nimport { db } from \"@/database/drizzle\";\nimport { users } from \"@/database/schema\";\nimport { eq } from \"drizzle-orm\";\n\nexport const { handlers, signIn, signOut, auth } = NextAuth({\n  session: {\n    strategy: \"jwt\",\n  },\n  providers: [\n    CredentialsProvider({\n      async authorize(credentials) {\n        if (!credentials?.email || !credentials?.password) {\n          return null;\n        }\n\n        const user = await db\n          .select()\n          .from(users)\n          .where(eq(users.email, credentials.email.toString()))\n          .limit(1);\n\n        if (user.length === 0) return null;\n\n        if (user[0].status !== \"APPROVED\") {\n          console.log(\"User status is not APPROVED:\", user[0].status);\n          return null;\n        }\n\n        const isPasswordValid = await compare(\n          credentials.password.toString(),\n          user[0].password,\n        );\n\n        if (!isPasswordValid) return null;\n\n        return {\n          id: user[0].id.toString(),\n          email: user[0].email,\n          name: user[0].fullName,\n        } as User;\n      },\n    }),\n  ],\n  pages: {\n    signIn: \"/sign-in\",\n  },\n  callbacks: {\n    async jwt({ token, user }) {\n      if (user) {\n        token.id = user.id;\n        token.name = user.name;\n      }\n\n      return token;\n    },\n    async session({ session, token }) {\n      if (session.user) {\n        session.user.id = token.id as string;\n        session.user.name = token.name as string;\n      }\n\n      return session;\n    },\n  },\n});\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;AACA;AACA;AAJA;AAEA;AAGA;;;;;;;AAEO,MAAM,EAAE,QAAQ,EAAE,MAAM,EAAE,OAAO,EAAE,IAAI,EAAE,GAAG,CAAA,GAAA,uJAAA,CAAA,UAAQ,AAAD,EAAE;IAC1D,SAAS;QACP,UAAU;IACZ;IACA,WAAW;QACT,CAAA,GAAA,4JAAA,CAAA,UAAmB,AAAD,EAAE;YAClB,MAAM,WAAU,WAAW;gBACzB,IAAI,CAAC,aAAa,SAAS,CAAC,aAAa,UAAU;oBACjD,OAAO;gBACT;gBAEA,MAAM,OAAO,MAAM,qHAAA,CAAA,KAAE,CAClB,MAAM,GACN,IAAI,CAAC,oHAAA,CAAA,QAAK,EACV,KAAK,CAAC,CAAA,GAAA,oKAAA,CAAA,KAAE,AAAD,EAAE,oHAAA,CAAA,QAAK,CAAC,KAAK,EAAE,YAAY,KAAK,CAAC,QAAQ,KAChD,KAAK,CAAC;gBAET,IAAI,KAAK,MAAM,KAAK,GAAG,OAAO;gBAE9B,IAAI,IAAI,CAAC,EAAE,CAAC,MAAM,KAAK,YAAY;oBACjC,QAAQ,GAAG,CAAC,gCAAgC,IAAI,CAAC,EAAE,CAAC,MAAM;oBAC1D,OAAO;gBACT;gBAEA,MAAM,kBAAkB,MAAM,CAAA,GAAA,mIAAA,CAAA,UAAO,AAAD,EAClC,YAAY,QAAQ,CAAC,QAAQ,IAC7B,IAAI,CAAC,EAAE,CAAC,QAAQ;gBAGlB,IAAI,CAAC,iBAAiB,OAAO;gBAE7B,OAAO;oBACL,IAAI,IAAI,CAAC,EAAE,CAAC,EAAE,CAAC,QAAQ;oBACvB,OAAO,IAAI,CAAC,EAAE,CAAC,KAAK;oBACpB,MAAM,IAAI,CAAC,EAAE,CAAC,QAAQ;gBACxB;YACF;QACF;KACD;IACD,OAAO;QACL,QAAQ;IACV;IACA,WAAW;QACT,MAAM,KAAI,EAAE,KAAK,EAAE,IAAI,EAAE;YACvB,IAAI,MAAM;gBACR,MAAM,EAAE,GAAG,KAAK,EAAE;gBAClB,MAAM,IAAI,GAAG,KAAK,IAAI;YACxB;YAEA,OAAO;QACT;QACA,MAAM,SAAQ,EAAE,OAAO,EAAE,KAAK,EAAE;YAC9B,IAAI,QAAQ,IAAI,EAAE;gBAChB,QAAQ,IAAI,CAAC,EAAE,GAAG,MAAM,EAAE;gBAC1B,QAAQ,IAAI,CAAC,IAAI,GAAG,MAAM,IAAI;YAChC;YAEA,OAAO;QACT;IACF;AACF"}},
    {"offset": {"line": 278, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 284, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/USER/Desktop/WORK/new_creation/app/api/download/%5BbookId%5D/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\";\r\nimport { db } from \"@/database/drizzle\";\r\nimport { books, downloadLogs } from \"@/database/schema\";\r\nimport { eq } from \"drizzle-orm\";\r\nimport { auth } from \"@/auth\";\r\nimport { randomUUID } from \"crypto\";\r\n\r\nexport async function GET(req: NextRequest, { params }: { params: { bookId: string } }) {\r\n  // Require authentication\r\n  const session = await auth();\r\n  if (!session || !session.user) {\r\n    return new NextResponse(\"Unauthorized\", { status: 401 });\r\n  }\r\n\r\n  const { bookId } = params;\r\n  // Fetch the book by ID\r\n  const [book] = await db.select().from(books).where(eq(books.id, bookId)).limit(1);\r\n  if (!book) {\r\n    return new NextResponse(\"Book not found\", { status: 404 });\r\n  }\r\n\r\n  // Log the download\r\n  if (!session.user.id || !book.id) {\r\n    return new NextResponse(\"Invalid user or book ID\", { status: 500 });\r\n  }\r\n  await db.insert(downloadLogs).values({\r\n    id: randomUUID(),\r\n    userId: String(session.user.id),\r\n    bookId: String(book.id),\r\n    // timestamp will default to now\r\n  });\r\n\r\n  // Fetch the file from ImageKit and stream it to the user\r\n  const fileResponse = await fetch(book.fileUrl);\r\n  if (!fileResponse.ok) {\r\n    return new NextResponse(\"Failed to fetch file from ImageKit\", { status: 502 });\r\n  }\r\n\r\n  // Extract file extension from fileUrl\r\n  const extMatch = book.fileUrl.match(/\\.([a-zA-Z0-9]+)(\\?|$)/);\r\n  const ext = extMatch ? extMatch[1] : \"pdf\";\r\n  const fileName = book.title.replace(/[^a-z0-9]/gi, \"_\").toLowerCase() + \".\" + ext;\r\n  const headers = new Headers(fileResponse.headers);\r\n  headers.set(\"Content-Disposition\", `attachment; filename=\\\"${fileName}\\\"`);\r\n\r\n  return new NextResponse(fileResponse.body, {\r\n    status: 200,\r\n    headers,\r\n  });\r\n} "],"names":[],"mappings":";;;AAAA;AACA;AACA;AAEA;AACA;AAFA;;;;;;;AAIO,eAAe,IAAI,GAAgB,EAAE,EAAE,MAAM,EAAkC;IACpF,yBAAyB;IACzB,MAAM,UAAU,MAAM,CAAA,GAAA,sGAAA,CAAA,OAAI,AAAD;IACzB,IAAI,CAAC,WAAW,CAAC,QAAQ,IAAI,EAAE;QAC7B,OAAO,IAAI,gIAAA,CAAA,eAAY,CAAC,gBAAgB;YAAE,QAAQ;QAAI;IACxD;IAEA,MAAM,EAAE,MAAM,EAAE,GAAG;IACnB,uBAAuB;IACvB,MAAM,CAAC,KAAK,GAAG,MAAM,qHAAA,CAAA,KAAE,CAAC,MAAM,GAAG,IAAI,CAAC,oHAAA,CAAA,QAAK,EAAE,KAAK,CAAC,CAAA,GAAA,oKAAA,CAAA,KAAE,AAAD,EAAE,oHAAA,CAAA,QAAK,CAAC,EAAE,EAAE,SAAS,KAAK,CAAC;IAC/E,IAAI,CAAC,MAAM;QACT,OAAO,IAAI,gIAAA,CAAA,eAAY,CAAC,kBAAkB;YAAE,QAAQ;QAAI;IAC1D;IAEA,mBAAmB;IACnB,IAAI,CAAC,QAAQ,IAAI,CAAC,EAAE,IAAI,CAAC,KAAK,EAAE,EAAE;QAChC,OAAO,IAAI,gIAAA,CAAA,eAAY,CAAC,2BAA2B;YAAE,QAAQ;QAAI;IACnE;IACA,MAAM,qHAAA,CAAA,KAAE,CAAC,MAAM,CAAC,oHAAA,CAAA,eAAY,EAAE,MAAM,CAAC;QACnC,IAAI,CAAA,GAAA,qGAAA,CAAA,aAAU,AAAD;QACb,QAAQ,OAAO,QAAQ,IAAI,CAAC,EAAE;QAC9B,QAAQ,OAAO,KAAK,EAAE;IAExB;IAEA,yDAAyD;IACzD,MAAM,eAAe,MAAM,MAAM,KAAK,OAAO;IAC7C,IAAI,CAAC,aAAa,EAAE,EAAE;QACpB,OAAO,IAAI,gIAAA,CAAA,eAAY,CAAC,sCAAsC;YAAE,QAAQ;QAAI;IAC9E;IAEA,sCAAsC;IACtC,MAAM,WAAW,KAAK,OAAO,CAAC,KAAK,CAAC;IACpC,MAAM,MAAM,WAAW,QAAQ,CAAC,EAAE,GAAG;IACrC,MAAM,WAAW,KAAK,KAAK,CAAC,OAAO,CAAC,eAAe,KAAK,WAAW,KAAK,MAAM;IAC9E,MAAM,UAAU,IAAI,QAAQ,aAAa,OAAO;IAChD,QAAQ,GAAG,CAAC,uBAAuB,CAAC,uBAAuB,EAAE,SAAS,EAAE,CAAC;IAEzE,OAAO,IAAI,gIAAA,CAAA,eAAY,CAAC,aAAa,IAAI,EAAE;QACzC,QAAQ;QACR;IACF;AACF"}},
    {"offset": {"line": 344, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}