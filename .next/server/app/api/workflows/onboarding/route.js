(()=>{var e={};e.id=460,e.ids=[460],e.modules={10846:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},44870:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},29294:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-async-storage.external.js")},63033:e=>{"use strict";e.exports=require("next/dist/server/app-render/work-unit-async-storage.external.js")},55511:e=>{"use strict";e.exports=require("crypto")},77598:e=>{"use strict";e.exports=require("node:crypto")},50700:(e,t,r)=>{"use strict";let a,s;r.r(t),r.d(t,{patchFetch:()=>u_,routeModule:()=>ux,serverHooks:()=>ub,workAsyncStorage:()=>uv,workUnitAsyncStorage:()=>uw});var n,i,o,l,u,c,d,p,h,f,m,y,g,x,v,w,b,_,k,S,T,E,I,C,A,R,N,O,P,U,$,j,M,B,F={};r.r(F),r.d(F,{POST:()=>ug});var q=r(42706),D=r(28203),L=r(45994);let H=require("node:buffer"),W=new TextEncoder,z=new TextDecoder,J=e=>new Uint8Array(H.Buffer.from(function(e){let t=e;return t instanceof Uint8Array&&(t=z.decode(t)),t}(e),"base64url"));var Z=r(77598);let K=require("node:util");class V extends Error{static code="ERR_JOSE_GENERIC";code="ERR_JOSE_GENERIC";constructor(e,t){super(e,t),this.name=this.constructor.name,Error.captureStackTrace?.(this,this.constructor)}}class G extends V{static code="ERR_JWT_CLAIM_VALIDATION_FAILED";code="ERR_JWT_CLAIM_VALIDATION_FAILED";claim;reason;payload;constructor(e,t,r="unspecified",a="unspecified"){super(e,{cause:{claim:r,reason:a,payload:t}}),this.claim=r,this.reason=a,this.payload=t}}class Q extends V{static code="ERR_JWT_EXPIRED";code="ERR_JWT_EXPIRED";claim;reason;payload;constructor(e,t,r="unspecified",a="unspecified"){super(e,{cause:{claim:r,reason:a,payload:t}}),this.claim=r,this.reason=a,this.payload=t}}class Y extends V{static code="ERR_JOSE_ALG_NOT_ALLOWED";code="ERR_JOSE_ALG_NOT_ALLOWED"}class X extends V{static code="ERR_JOSE_NOT_SUPPORTED";code="ERR_JOSE_NOT_SUPPORTED"}class ee extends V{static code="ERR_JWS_INVALID";code="ERR_JWS_INVALID"}class et extends V{static code="ERR_JWT_INVALID";code="ERR_JWT_INVALID"}class er extends V{[Symbol.asyncIterator];static code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";code="ERR_JWKS_MULTIPLE_MATCHING_KEYS";constructor(e="multiple matching keys found in the JSON Web Key Set",t){super(e,t)}}class ea extends V{static code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";code="ERR_JWS_SIGNATURE_VERIFICATION_FAILED";constructor(e="signature verification failed",t){super(e,t)}}function es(e){switch(e){case"PS256":case"RS256":case"ES256":case"ES256K":return"sha256";case"PS384":case"RS384":case"ES384":return"sha384";case"PS512":case"RS512":case"ES512":return"sha512";case"Ed25519":case"EdDSA":return;default:throw new X(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}let en=Z.webcrypto,ei=e=>K.types.isCryptoKey(e),eo=e=>K.types.isKeyObject(e);function el(e,t,...r){if((r=r.filter(Boolean)).length>2){let t=r.pop();e+=`one of type ${r.join(", ")}, or ${t}.`}else 2===r.length?e+=`one of type ${r[0]} or ${r[1]}.`:e+=`of type ${r[0]}.`;return null==t?e+=` Received ${t}`:"function"==typeof t&&t.name?e+=` Received function ${t.name}`:"object"==typeof t&&null!=t&&t.constructor?.name&&(e+=` Received an instance of ${t.constructor.name}`),e}let eu=(e,...t)=>el("Key must be ",e,...t);function ec(e,t,...r){return el(`Key for the ${e} algorithm must be `,t,...r)}let ed=e=>eo(e)||ei(e),ep=["KeyObject"];function eh(e){if(!("object"==typeof e&&null!==e)||"[object Object]"!==Object.prototype.toString.call(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function ef(e){return eh(e)&&"string"==typeof e.kty}(globalThis.CryptoKey||en?.CryptoKey)&&ep.push("CryptoKey"),new WeakMap;let em=e=>{switch(e){case"prime256v1":return"P-256";case"secp384r1":return"P-384";case"secp521r1":return"P-521";case"secp256k1":return"secp256k1";default:throw new X("Unsupported key curve for this operation")}},ey=(e,t)=>{let r;if(ei(e))r=Z.KeyObject.from(e);else if(eo(e))r=e;else if(ef(e))return e.crv;else throw TypeError(eu(e,...ep));if("secret"===r.type)throw TypeError('only "private" or "public" type keys can be used for this operation');switch(r.asymmetricKeyType){case"ed25519":case"ed448":return`Ed${r.asymmetricKeyType.slice(2)}`;case"x25519":case"x448":return`X${r.asymmetricKeyType.slice(1)}`;case"ec":{let e=r.asymmetricKeyDetails.namedCurve;if(t)return e;return em(e)}default:throw TypeError("Invalid asymmetric key type for this operation")}},eg=(e,t)=>{let r;try{r=e instanceof Z.KeyObject?e.asymmetricKeyDetails?.modulusLength:Buffer.from(e.n,"base64url").byteLength<<3}catch{}if("number"!=typeof r||r<2048)throw TypeError(`${t} requires key modulusLength to be 2048 bits or larger`)},ex=new Map([["ES256","P-256"],["ES256K","secp256k1"],["ES384","P-384"],["ES512","P-521"]]);function ev(e,t){let r,a,s,n;if(t instanceof Z.KeyObject)r=t.asymmetricKeyType,a=t.asymmetricKeyDetails;else switch(s=!0,t.kty){case"RSA":r="rsa";break;case"EC":r="ec";break;case"OKP":if("Ed25519"===t.crv){r="ed25519";break}if("Ed448"===t.crv){r="ed448";break}throw TypeError("Invalid key for this operation, its crv must be Ed25519 or Ed448");default:throw TypeError("Invalid key for this operation, its kty must be RSA, OKP, or EC")}switch(e){case"Ed25519":if("ed25519"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519");break;case"EdDSA":if(!["ed25519","ed448"].includes(r))throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ed25519 or ed448");break;case"RS256":case"RS384":case"RS512":if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa");eg(t,e);break;case"PS256":case"PS384":case"PS512":if("rsa-pss"===r){let{hashAlgorithm:t,mgf1HashAlgorithm:r,saltLength:s}=a,n=parseInt(e.slice(-3),10);if(void 0!==t&&(t!==`sha${n}`||r!==t))throw TypeError(`Invalid key for this operation, its RSA-PSS parameters do not meet the requirements of "alg" ${e}`);if(void 0!==s&&s>n>>3)throw TypeError(`Invalid key for this operation, its RSA-PSS parameter saltLength does not meet the requirements of "alg" ${e}`)}else if("rsa"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be rsa or rsa-pss");eg(t,e),n={padding:Z.constants.RSA_PKCS1_PSS_PADDING,saltLength:Z.constants.RSA_PSS_SALTLEN_DIGEST};break;case"ES256":case"ES256K":case"ES384":case"ES512":{if("ec"!==r)throw TypeError("Invalid key for this operation, its asymmetricKeyType must be ec");let a=ey(t),s=ex.get(e);if(a!==s)throw TypeError(`Invalid key curve for the algorithm, its curve must be ${s}, got ${a}`);n={dsaEncoding:"ieee-p1363"};break}default:throw new X(`alg ${e} is not supported either by JOSE or your javascript runtime`)}return s?{format:"jwk",key:t,...n}:n?{...n,key:t}:t}function ew(e,t="algorithm.name"){return TypeError(`CryptoKey does not support this operation, its ${t} must be ${e}`)}function eb(e,t){return e.name===t}function e_(e){return parseInt(e.name.slice(4),10)}function ek(e,t,r){if(t instanceof Uint8Array){if(!e.startsWith("HS"))throw TypeError(eu(t,...ep));return(0,Z.createSecretKey)(t)}if(t instanceof Z.KeyObject)return t;if(ei(t))return function(e,t,...r){switch(t){case"HS256":case"HS384":case"HS512":{if(!eb(e.algorithm,"HMAC"))throw ew("HMAC");let r=parseInt(t.slice(2),10);if(e_(e.algorithm.hash)!==r)throw ew(`SHA-${r}`,"algorithm.hash");break}case"RS256":case"RS384":case"RS512":{if(!eb(e.algorithm,"RSASSA-PKCS1-v1_5"))throw ew("RSASSA-PKCS1-v1_5");let r=parseInt(t.slice(2),10);if(e_(e.algorithm.hash)!==r)throw ew(`SHA-${r}`,"algorithm.hash");break}case"PS256":case"PS384":case"PS512":{if(!eb(e.algorithm,"RSA-PSS"))throw ew("RSA-PSS");let r=parseInt(t.slice(2),10);if(e_(e.algorithm.hash)!==r)throw ew(`SHA-${r}`,"algorithm.hash");break}case"EdDSA":if("Ed25519"!==e.algorithm.name&&"Ed448"!==e.algorithm.name)throw ew("Ed25519 or Ed448");break;case"Ed25519":if(!eb(e.algorithm,"Ed25519"))throw ew("Ed25519");break;case"ES256":case"ES384":case"ES512":{if(!eb(e.algorithm,"ECDSA"))throw ew("ECDSA");let r=function(e){switch(e){case"ES256":return"P-256";case"ES384":return"P-384";case"ES512":return"P-521";default:throw Error("unreachable")}}(t);if(e.algorithm.namedCurve!==r)throw ew(r,"algorithm.namedCurve");break}default:throw TypeError("CryptoKey does not support this operation")}(function(e,t){if(t.length&&!t.some(t=>e.usages.includes(t))){let e="CryptoKey does not support this operation, its usages must include ";if(t.length>2){let r=t.pop();e+=`one of ${t.join(", ")}, or ${r}.`}else 2===t.length?e+=`one of ${t[0]} or ${t[1]}.`:e+=`${t[0]}.`;throw TypeError(e)}})(e,r)}(t,e,r),Z.KeyObject.from(t);if(ef(t))return e.startsWith("HS")?(0,Z.createSecretKey)(Buffer.from(t.k,"base64url")):t;throw TypeError(eu(t,...ep,"Uint8Array","JSON Web Key"))}let eS=(0,K.promisify)(Z.sign),eT=async(e,t,r)=>{let a=ek(e,t,"sign");if(e.startsWith("HS")){let t=Z.createHmac(function(e){switch(e){case"HS256":return"sha256";case"HS384":return"sha384";case"HS512":return"sha512";default:throw new X(`alg ${e} is not supported either by JOSE or your javascript runtime`)}}(e),a);return t.update(r),t.digest()}return eS(es(e),r,ev(e,a))},eE=(0,K.promisify)(Z.verify),eI=async(e,t,r,a)=>{let s=ek(e,t,"verify");if(e.startsWith("HS")){let t=await eT(e,s,a);try{return Z.timingSafeEqual(r,t)}catch{return!1}}let n=es(e),i=ev(e,s);try{return await eE(n,a,i,r)}catch{return!1}},eC=(...e)=>{let t;let r=e.filter(Boolean);if(0===r.length||1===r.length)return!0;for(let e of r){let r=Object.keys(e);if(!t||0===t.size){t=new Set(r);continue}for(let e of r){if(t.has(e))return!1;t.add(e)}}return!0},eA=e=>e?.[Symbol.toStringTag],eR=(e,t,r)=>{if(void 0!==t.use&&"sig"!==t.use)throw TypeError("Invalid key for this operation, when present its use must be sig");if(void 0!==t.key_ops&&t.key_ops.includes?.(r)!==!0)throw TypeError(`Invalid key for this operation, when present its key_ops must include ${r}`);if(void 0!==t.alg&&t.alg!==e)throw TypeError(`Invalid key for this operation, when present its alg must be ${e}`);return!0},eN=(e,t,r,a)=>{if(!(t instanceof Uint8Array)){if(a&&ef(t)){if(function(e){return ef(e)&&"oct"===e.kty&&"string"==typeof e.k}(t)&&eR(e,t,r))return;throw TypeError('JSON Web Key for symmetric algorithms must have JWK "kty" (Key Type) equal to "oct" and the JWK "k" (Key Value) present')}if(!ed(t))throw TypeError(ec(e,t,...ep,"Uint8Array",a?"JSON Web Key":null));if("secret"!==t.type)throw TypeError(`${eA(t)} instances for symmetric algorithms must be of type "secret"`)}},eO=(e,t,r,a)=>{if(a&&ef(t))switch(r){case"sign":if(function(e){return"oct"!==e.kty&&"string"==typeof e.d}(t)&&eR(e,t,r))return;throw TypeError("JSON Web Key for this operation be a private JWK");case"verify":if(function(e){return"oct"!==e.kty&&void 0===e.d}(t)&&eR(e,t,r))return;throw TypeError("JSON Web Key for this operation be a public JWK")}if(!ed(t))throw TypeError(ec(e,t,...ep,a?"JSON Web Key":null));if("secret"===t.type)throw TypeError(`${eA(t)} instances for asymmetric algorithms must not be of type "secret"`);if("sign"===r&&"public"===t.type)throw TypeError(`${eA(t)} instances for asymmetric algorithm signing must be of type "private"`);if("decrypt"===r&&"public"===t.type)throw TypeError(`${eA(t)} instances for asymmetric algorithm decryption must be of type "private"`);if(t.algorithm&&"verify"===r&&"private"===t.type)throw TypeError(`${eA(t)} instances for asymmetric algorithm verifying must be of type "public"`);if(t.algorithm&&"encrypt"===r&&"private"===t.type)throw TypeError(`${eA(t)} instances for asymmetric algorithm encryption must be of type "public"`)};function eP(e,t,r,a){t.startsWith("HS")||"dir"===t||t.startsWith("PBES2")||/^A\d{3}(?:GCM)?KW$/.test(t)?eN(t,r,a,e):eO(t,r,a,e)}eP.bind(void 0,!1);let eU=eP.bind(void 0,!0),e$=function(e,t,r,a,s){let n;if(void 0!==s.crit&&a?.crit===void 0)throw new e('"crit" (Critical) Header Parameter MUST be integrity protected');if(!a||void 0===a.crit)return new Set;if(!Array.isArray(a.crit)||0===a.crit.length||a.crit.some(e=>"string"!=typeof e||0===e.length))throw new e('"crit" (Critical) Header Parameter MUST be an array of non-empty strings when present');for(let i of(n=void 0!==r?new Map([...Object.entries(r),...t.entries()]):t,a.crit)){if(!n.has(i))throw new X(`Extension Header Parameter "${i}" is not recognized`);if(void 0===s[i])throw new e(`Extension Header Parameter "${i}" is missing`);if(n.get(i)&&void 0===a[i])throw new e(`Extension Header Parameter "${i}" MUST be integrity protected`)}return new Set(a.crit)},ej=(e,t)=>{if(void 0!==t&&(!Array.isArray(t)||t.some(e=>"string"!=typeof e)))throw TypeError(`"${e}" option must be an array of strings`);if(t)return new Set(t)},eM=e=>e.d?(0,Z.createPrivateKey)({format:"jwk",key:e}):(0,Z.createPublicKey)({format:"jwk",key:e});async function eB(e,t){if(!eh(e))throw TypeError("JWK must be an object");switch(t||=e.alg,e.kty){case"oct":if("string"!=typeof e.k||!e.k)throw TypeError('missing "k" (Key Value) Parameter value');return J(e.k);case"RSA":if("oth"in e&&void 0!==e.oth)throw new X('RSA JWK "oth" (Other Primes Info) Parameter value is not supported');case"EC":case"OKP":return eM({...e,alg:t});default:throw new X('Unsupported "kty" (Key Type) Parameter value')}}async function eF(e,t,r){let a,s;if(!eh(e))throw new ee("Flattened JWS must be an object");if(void 0===e.protected&&void 0===e.header)throw new ee('Flattened JWS must have either of the "protected" or "header" members');if(void 0!==e.protected&&"string"!=typeof e.protected)throw new ee("JWS Protected Header incorrect type");if(void 0===e.payload)throw new ee("JWS Payload missing");if("string"!=typeof e.signature)throw new ee("JWS Signature missing or incorrect type");if(void 0!==e.header&&!eh(e.header))throw new ee("JWS Unprotected Header incorrect type");let n={};if(e.protected)try{let t=J(e.protected);n=JSON.parse(z.decode(t))}catch{throw new ee("JWS Protected Header is invalid")}if(!eC(n,e.header))throw new ee("JWS Protected and JWS Unprotected Header Parameter names must be disjoint");let i={...n,...e.header},o=e$(ee,new Map([["b64",!0]]),r?.crit,n,i),l=!0;if(o.has("b64")&&"boolean"!=typeof(l=n.b64))throw new ee('The "b64" (base64url-encode payload) Header Parameter must be a boolean');let{alg:u}=i;if("string"!=typeof u||!u)throw new ee('JWS "alg" (Algorithm) Header Parameter missing or invalid');let c=r&&ej("algorithms",r.algorithms);if(c&&!c.has(u))throw new Y('"alg" (Algorithm) Header Parameter value not allowed');if(l){if("string"!=typeof e.payload)throw new ee("JWS Payload must be a string")}else if("string"!=typeof e.payload&&!(e.payload instanceof Uint8Array))throw new ee("JWS Payload must be a string or an Uint8Array instance");let d=!1;"function"==typeof t?(t=await t(n,e),d=!0,eU(u,t,"verify"),ef(t)&&(t=await eB(t,u))):eU(u,t,"verify");let p=function(...e){let t=new Uint8Array(e.reduce((e,{length:t})=>e+t,0)),r=0;for(let a of e)t.set(a,r),r+=a.length;return t}(W.encode(e.protected??""),W.encode("."),"string"==typeof e.payload?W.encode(e.payload):e.payload);try{a=J(e.signature)}catch{throw new ee("Failed to base64url decode the signature")}if(!await eI(u,t,a,p))throw new ea;if(l)try{s=J(e.payload)}catch{throw new ee("Failed to base64url decode the payload")}else s="string"==typeof e.payload?W.encode(e.payload):e.payload;let h={payload:s};return(void 0!==e.protected&&(h.protectedHeader=n),void 0!==e.header&&(h.unprotectedHeader=e.header),d)?{...h,key:t}:h}async function eq(e,t,r){if(e instanceof Uint8Array&&(e=z.decode(e)),"string"!=typeof e)throw new ee("Compact JWS must be a string or Uint8Array");let{0:a,1:s,2:n,length:i}=e.split(".");if(3!==i)throw new ee("Invalid Compact JWS");let o=await eF({payload:s,protected:a,signature:n},t,r),l={payload:o.payload,protectedHeader:o.protectedHeader};return"function"==typeof t?{...l,key:o.key}:l}let eD=e=>Math.floor(e.getTime()/1e3),eL=/^(\+|\-)? ?(\d+|\d+\.\d+) ?(seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)(?: (ago|from now))?$/i,eH=e=>{let t;let r=eL.exec(e);if(!r||r[4]&&r[1])throw TypeError("Invalid time period format");let a=parseFloat(r[2]);switch(r[3].toLowerCase()){case"sec":case"secs":case"second":case"seconds":case"s":t=Math.round(a);break;case"minute":case"minutes":case"min":case"mins":case"m":t=Math.round(60*a);break;case"hour":case"hours":case"hr":case"hrs":case"h":t=Math.round(3600*a);break;case"day":case"days":case"d":t=Math.round(86400*a);break;case"week":case"weeks":case"w":t=Math.round(604800*a);break;default:t=Math.round(0x1e187e0*a)}return"-"===r[1]||"ago"===r[4]?-t:t},eW=e=>e.toLowerCase().replace(/^application\//,""),ez=(e,t)=>"string"==typeof e?t.includes(e):!!Array.isArray(e)&&t.some(Set.prototype.has.bind(new Set(e))),eJ=(e,t,r={})=>{let a,s;try{a=JSON.parse(z.decode(t))}catch{}if(!eh(a))throw new et("JWT Claims Set must be a top-level JSON object");let{typ:n}=r;if(n&&("string"!=typeof e.typ||eW(e.typ)!==eW(n)))throw new G('unexpected "typ" JWT header value',a,"typ","check_failed");let{requiredClaims:i=[],issuer:o,subject:l,audience:u,maxTokenAge:c}=r,d=[...i];for(let e of(void 0!==c&&d.push("iat"),void 0!==u&&d.push("aud"),void 0!==l&&d.push("sub"),void 0!==o&&d.push("iss"),new Set(d.reverse())))if(!(e in a))throw new G(`missing required "${e}" claim`,a,e,"missing");if(o&&!(Array.isArray(o)?o:[o]).includes(a.iss))throw new G('unexpected "iss" claim value',a,"iss","check_failed");if(l&&a.sub!==l)throw new G('unexpected "sub" claim value',a,"sub","check_failed");if(u&&!ez(a.aud,"string"==typeof u?[u]:u))throw new G('unexpected "aud" claim value',a,"aud","check_failed");switch(typeof r.clockTolerance){case"string":s=eH(r.clockTolerance);break;case"number":s=r.clockTolerance;break;case"undefined":s=0;break;default:throw TypeError("Invalid clockTolerance option type")}let{currentDate:p}=r,h=eD(p||new Date);if((void 0!==a.iat||c)&&"number"!=typeof a.iat)throw new G('"iat" claim must be a number',a,"iat","invalid");if(void 0!==a.nbf){if("number"!=typeof a.nbf)throw new G('"nbf" claim must be a number',a,"nbf","invalid");if(a.nbf>h+s)throw new G('"nbf" claim timestamp check failed',a,"nbf","check_failed")}if(void 0!==a.exp){if("number"!=typeof a.exp)throw new G('"exp" claim must be a number',a,"exp","invalid");if(a.exp<=h-s)throw new Q('"exp" claim timestamp check failed',a,"exp","check_failed")}if(c){let e=h-a.iat;if(e-s>("number"==typeof c?c:eH(c)))throw new Q('"iat" claim timestamp check failed (too far in the past)',a,"iat","check_failed");if(e<0-s)throw new G('"iat" claim timestamp check failed (it should be in the past)',a,"iat","check_failed")}return a};async function eZ(e,t,r){let a=await eq(e,t,r);if(a.protectedHeader.crit?.includes("b64")&&!1===a.protectedHeader.b64)throw new et("JWTs MUST NOT use unencoded payload");let s={payload:eJ(a.protectedHeader,a.payload,r),protectedHeader:a.protectedHeader};return"function"==typeof t?{...s,key:a.key}:s}var eK=r(15236);let eV={withStackTrace:!1},eG=(e,t,r=eV)=>({data:t.isOk()?{type:"Ok",value:t.value}:{type:"Err",value:t.error},message:e,stack:r.withStackTrace?Error().stack:void 0});function eQ(e,t,r,a){return new(r||(r=Promise))(function(t,s){function n(e){try{o(a.next(e))}catch(e){s(e)}}function i(e){try{o(a.throw(e))}catch(e){s(e)}}function o(e){var a;e.done?t(e.value):((a=e.value)instanceof r?a:new r(function(e){e(a)})).then(n,i)}o((a=a.apply(e,[])).next())})}function eY(e){return this instanceof eY?(this.v=e,this):new eY(e)}class eX{constructor(e){this._promise=e}static fromSafePromise(e){return new eX(e.then(e=>new e3(e)))}static fromPromise(e,t){return new eX(e.then(e=>new e3(e)).catch(e=>new e9(t(e))))}static fromThrowable(e,t){return(...r)=>new eX(eQ(this,void 0,void 0,function*(){try{return new e3((yield e(...r)))}catch(e){return new e9(t?t(e):e)}}))}static combine(e){return e2(e)}static combineWithAllErrors(e){return e8(e)}map(e){return new eX(this._promise.then(t=>eQ(this,void 0,void 0,function*(){return t.isErr()?new e9(t.error):new e3((yield e(t.value)))})))}andThrough(e){return new eX(this._promise.then(t=>eQ(this,void 0,void 0,function*(){if(t.isErr())return new e9(t.error);let r=yield e(t.value);return r.isErr()?new e9(r.error):new e3(t.value)})))}andTee(e){return new eX(this._promise.then(t=>eQ(this,void 0,void 0,function*(){if(t.isErr())return new e9(t.error);try{yield e(t.value)}catch(e){}return new e3(t.value)})))}mapErr(e){return new eX(this._promise.then(t=>eQ(this,void 0,void 0,function*(){return t.isOk()?new e3(t.value):new e9((yield e(t.error)))})))}andThen(e){return new eX(this._promise.then(t=>{if(t.isErr())return new e9(t.error);let r=e(t.value);return r instanceof eX?r._promise:r}))}orElse(e){return new eX(this._promise.then(t=>eQ(this,void 0,void 0,function*(){return t.isErr()?e(t.error):new e3(t.value)})))}match(e,t){return this._promise.then(r=>r.match(e,t))}unwrapOr(e){return this._promise.then(t=>t.unwrapOr(e))}safeUnwrap(){return function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var a,s=r.apply(e,t||[]),n=[];return a={},i("next"),i("throw"),i("return"),a[Symbol.asyncIterator]=function(){return this},a;function i(e){s[e]&&(a[e]=function(t){return new Promise(function(r,a){n.push([e,t,r,a])>1||o(e,t)})})}function o(e,t){try{var r;(r=s[e](t)).value instanceof eY?Promise.resolve(r.value.v).then(l,u):c(n[0][2],r)}catch(e){c(n[0][3],e)}}function l(e){o("next",e)}function u(e){o("throw",e)}function c(e,t){e(t),n.shift(),n.length&&o(n[0][0],n[0][1])}}(this,arguments,function*(){return yield eY((yield eY((yield*function(e){var t,r;return t={},a("next"),a("throw",function(e){throw e}),a("return"),t[Symbol.iterator]=function(){return this},t;function a(a,s){t[a]=e[a]?function(t){return(r=!r)?{value:eY(e[a](t)),done:"return"===a}:s?s(t):t}:s}}(function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(r){t[r]=e[r]&&function(t){return new Promise(function(a,s){(function(e,t,r,a){Promise.resolve(a).then(function(t){e({value:t,done:r})},t)})(a,s,(t=e[r](t)).done,t.value)})}}}((yield eY(this._promise.then(e=>e.safeUnwrap())))))))))})}then(e,t){return this._promise.then(e,t)}}let e0=e=>new eX(Promise.resolve(new e9(e)));eX.fromPromise,eX.fromSafePromise,eX.fromThrowable;let e1=e=>{let t=e6([]);for(let r of e){if(r.isErr()){t=e5(r.error);break}t.map(e=>e.push(r.value))}return t},e2=e=>eX.fromSafePromise(Promise.all(e)).andThen(e1),e4=e=>{let t=e6([]);for(let r of e)r.isErr()&&t.isErr()?t.error.push(r.error):r.isErr()&&t.isOk()?t=e5([r.error]):r.isOk()&&t.isOk()&&t.value.push(r.value);return t},e8=e=>eX.fromSafePromise(Promise.all(e)).andThen(e4);!function(e){e.fromThrowable=function(e,t){return(...r)=>{try{let t=e(...r);return e6(t)}catch(e){return e5(t?t(e):e)}}},e.combine=function(e){return e1(e)},e.combineWithAllErrors=function(e){return e4(e)}}(n||(n={}));let e6=e=>new e3(e);function e5(e){return new e9(e)}class e3{constructor(e){this.value=e}isOk(){return!0}isErr(){return!this.isOk()}map(e){return e6(e(this.value))}mapErr(e){return e6(this.value)}andThen(e){return e(this.value)}andThrough(e){return e(this.value).map(e=>this.value)}andTee(e){try{e(this.value)}catch(e){}return e6(this.value)}orElse(e){return e6(this.value)}asyncAndThen(e){return e(this.value)}asyncAndThrough(e){return e(this.value).map(()=>this.value)}asyncMap(e){return eX.fromSafePromise(e(this.value))}unwrapOr(e){return this.value}match(e,t){return e(this.value)}safeUnwrap(){let e=this.value;return function*(){return e}()}_unsafeUnwrap(e){return this.value}_unsafeUnwrapErr(e){throw eG("Called `_unsafeUnwrapErr` on an Ok",this,e)}}class e9{constructor(e){this.error=e}isOk(){return!1}isErr(){return!this.isOk()}map(e){return e5(this.error)}mapErr(e){return e5(e(this.error))}andThrough(e){return e5(this.error)}andTee(e){return e5(this.error)}andThen(e){return e5(this.error)}orElse(e){return e(this.error)}asyncAndThen(e){return e0(this.error)}asyncAndThrough(e){return e0(this.error)}asyncMap(e){return e0(this.error)}unwrapOr(e){return e}match(e,t){return t(this.error)}safeUnwrap(){let e=this.error;return function*(){throw yield e5(e),Error("Do not use this generator out of `safeTry`")}()}_unsafeUnwrap(e){throw eG("Called `_unsafeUnwrap` on an Err",this,e)}_unsafeUnwrapErr(e){return this.error}}n.fromThrowable;var e7=class extends Error{constructor(e){super(e),this.name="SignatureError"}},te=class{currentSigningKey;nextSigningKey;constructor(e){this.currentSigningKey=e.currentSigningKey,this.nextSigningKey=e.nextSigningKey}async verify(e){let t;try{t=await this.verifyWithKey(this.currentSigningKey,e)}catch{t=await this.verifyWithKey(this.nextSigningKey,e)}return this.verifyBodyAndUrl(t,e),!0}async verifyWithKey(e,t){return(await eZ(t.signature,new TextEncoder().encode(e),{issuer:"Upstash",clockTolerance:t.clockTolerance}).catch(e=>{throw new e7(e.message)})).payload}verifyBodyAndUrl(e,t){if(void 0!==t.url&&e.sub!==t.url)throw new e7(`invalid subject: ${e.sub}, want: ${t.url}`);let r=eK.SHA256(t.body).toString(eK.enc.Base64url),a=new RegExp(/=+$/);if(e.body.replace(a,"")!==r.replace(a,""))throw new e7(`body hash does not match, want: ${e.body}, got: ${r}`)}},tt=class{http;constructor(e){this.http=e}async listMessages(e){let t={...e?.filter,topicName:e?.filter?.urlGroup},r=await this.http.request({method:"GET",path:["v2","dlq"],query:{cursor:e?.cursor,count:e?.count,...t}});return{messages:r.messages.map(e=>({...e,urlGroup:e.topicName,ratePerSecond:"rate"in e?e.rate:void 0})),cursor:r.cursor}}async delete(e){return await this.http.request({method:"DELETE",path:["v2","dlq",e],parseResponseAsJson:!1})}async deleteMany(e){return await this.http.request({method:"DELETE",path:["v2","dlq"],headers:{"Content-Type":"application/json"},body:JSON.stringify({dlqIds:e.dlqIds})})}},tr=class extends Error{status;constructor(e,t){super(e),this.name="QstashError",this.status=t}},ta=class extends tr{limit;remaining;reset;constructor(e){super(`Exceeded burst rate limit. ${JSON.stringify(e)}`,429),this.name="QstashRatelimitError",this.limit=e.limit,this.remaining=e.remaining,this.reset=e.reset}},ts=class extends tr{limitRequests;limitTokens;remainingRequests;remainingTokens;resetRequests;resetTokens;constructor(e){super(`Exceeded chat rate limit. ${JSON.stringify(e)}`,429),this.name="QstashChatRatelimitError",this.limitRequests=e["limit-requests"],this.limitTokens=e["limit-tokens"],this.remainingRequests=e["remaining-requests"],this.remainingTokens=e["remaining-tokens"],this.resetRequests=e["reset-requests"],this.resetTokens=e["reset-tokens"]}},tn=class extends tr{limit;remaining;reset;constructor(e){super(`Exceeded daily rate limit. ${JSON.stringify(e)}`,429),this.name="QstashDailyRatelimitError",this.limit=e.limit,this.remaining=e.remaining,this.reset=e.reset}},ti=class extends tr{constructor(e){super(e),this.name="QStashWorkflowError"}},to=class extends Error{stepInfo;stepName;constructor(e,t){super(`This is an Upstash Workflow error thrown after a step executes. It is expected to be raised. Make sure that you await for each step. Also, if you are using try/catch blocks, you should not wrap context.run/sleep/sleepUntil/call methods with try/catch. Aborting workflow after executing step '${e}'.`),this.name="QStashWorkflowAbort",this.stepName=e,this.stepInfo=t}},tl=class{baseUrl;authorization;options;retry;headers;telemetryHeaders;constructor(e){this.baseUrl=e.baseUrl.replace(/\/$/,""),this.authorization=e.authorization,this.retry="boolean"!=typeof e.retry||e.retry?{attempts:e.retry?.retries??5,backoff:e.retry?.backoff??(e=>50*Math.exp(e))}:{attempts:1,backoff:()=>0},this.headers=e.headers,this.telemetryHeaders=e.telemetryHeaders}async request(e){let{response:t}=await this.requestWithBackoff(e);if(!1!==e.parseResponseAsJson)return await t.json()}async *requestStream(e){let{response:t}=await this.requestWithBackoff(e);if(!t.body)throw Error("No response body");let r=t.body.getReader(),a=new TextDecoder;try{for(;;){let{done:e,value:t}=await r.read();if(e)break;for(let e of a.decode(t,{stream:!0}).split("\n").filter(Boolean))if(e.startsWith("data: ")){let t=e.slice(6);if("[DONE]"===t)break;yield JSON.parse(t)}}}finally{await r.cancel()}}requestWithBackoff=async e=>{let t,r;let[a,s]=this.processRequest(e);for(let e=0;e<=this.retry.attempts;e++)try{t=await fetch(a.toString(),s);break}catch(t){r=t,e<this.retry.attempts&&await new Promise(t=>setTimeout(t,this.retry.backoff(e)))}if(!t)throw r??Error("Exhausted all retries");return await this.checkResponse(t),{response:t,error:r}};processRequest=e=>{let t=new Headers(e.headers);t.has("Authorization")||t.set("Authorization",this.authorization);let r={method:e.method,headers:t,body:e.body,keepalive:e.keepalive},a=new URL([e.baseUrl??this.baseUrl,...e.path].join("/"));if(e.query)for(let[t,r]of Object.entries(e.query))void 0!==r&&a.searchParams.set(t,r.toString());return[a.toString(),r]};async checkResponse(e){if(429===e.status){if(e.headers.get("x-ratelimit-limit-requests"))throw new ts({"limit-requests":e.headers.get("x-ratelimit-limit-requests"),"limit-tokens":e.headers.get("x-ratelimit-limit-tokens"),"remaining-requests":e.headers.get("x-ratelimit-remaining-requests"),"remaining-tokens":e.headers.get("x-ratelimit-remaining-tokens"),"reset-requests":e.headers.get("x-ratelimit-reset-requests"),"reset-tokens":e.headers.get("x-ratelimit-reset-tokens")});if(e.headers.get("RateLimit-Limit"))throw new tn({limit:e.headers.get("RateLimit-Limit"),remaining:e.headers.get("RateLimit-Remaining"),reset:e.headers.get("RateLimit-Reset")});throw new ta({limit:e.headers.get("Burst-RateLimit-Limit"),remaining:e.headers.get("Burst-RateLimit-Remaining"),reset:e.headers.get("Burst-RateLimit-Reset")})}if(e.status<200||e.status>=300){let t=await e.text();throw new tr(t.length>0?t:`Error: status=${e.status}`,e.status)}}},tu=(e,t,r,a)=>{if(!e)return{};if("helicone"===e.name)return"upstash"===a?{baseURL:"https://qstash.helicone.ai/llm/v1/chat/completions",defaultHeaders:{"Helicone-Auth":`Bearer ${e.token}`,Authorization:`Bearer ${t}`}}:{baseURL:"https://gateway.helicone.ai/v1/chat/completions",defaultHeaders:{"Helicone-Auth":`Bearer ${e.token}`,"Helicone-Target-Url":r,Authorization:`Bearer ${t}`}};throw Error("Unknown analytics provider")},tc=class e{http;token;constructor(e,t){this.http=e,this.token=t}static toChatRequest(e){let t=[];return t.push({role:"system",content:e.system},{role:"user",content:e.user}),{...e,messages:t}}create=async e=>{let t;if("upstash"!=e.provider.owner)return this.createThirdParty(e);let r=JSON.stringify(e),a={"Content-Type":"application/json",Authorization:`Bearer ${this.token}`,..."stream"in e&&e.stream?{Connection:"keep-alive",Accept:"text/event-stream","Cache-Control":"no-cache"}:{}};if(e.analytics){let{baseURL:r,defaultHeaders:s}=tu({name:"helicone",token:e.analytics.token},this.getAuthorizationToken(),e.provider.baseUrl,"upstash");a={...a,...s},t=r}let s=e.analytics?[]:["llm","v1","chat","completions"];return"stream"in e&&e.stream?this.http.requestStream({path:s,method:"POST",headers:a,baseUrl:t,body:r}):this.http.request({path:s,method:"POST",headers:a,baseUrl:t,body:r})};createThirdParty=async e=>{let{baseUrl:t,token:r,owner:a,organization:s}=e.provider;if("upstash"===a)throw Error("Upstash is not 3rd party provider!");delete e.provider,delete e.system;let n=e.analytics;delete e.analytics;let i=JSON.stringify(e),o=n?.name&&n.token,l=n?.name&&n.token?tu({name:n.name,token:n.token},r,t,a):{defaultHeaders:void 0,baseURL:t},u="stream"in e&&e.stream,c={"Content-Type":"application/json",Authorization:`Bearer ${r}`,...s?{"OpenAI-Organization":s}:{},...u?{Connection:"keep-alive",Accept:"text/event-stream","Cache-Control":"no-cache"}:{},...l.defaultHeaders};return await this.http[u?"requestStream":"request"]({path:o?[]:["v1","chat","completions"],method:"POST",headers:c,body:i,baseUrl:l.baseURL})};getAuthorizationToken(){let e=String(this.http.authorization),t=/Bearer (.+)/.exec(e);if(!t)throw Error("Invalid authorization header format");return t[1]}prompt=async t=>{let r=e.toChatRequest(t);return this.create(r)}},td=class{http;constructor(e){this.http=e}async get(e){let t=await this.http.request({method:"GET",path:["v2","messages",e]});return{...t,urlGroup:t.topicName,ratePerSecond:"rate"in t?t.rate:void 0}}async delete(e){return await this.http.request({method:"DELETE",path:["v2","messages",e],parseResponseAsJson:!1})}async deleteMany(e){return(await this.http.request({method:"DELETE",path:["v2","messages"],headers:{"Content-Type":"application/json"},body:JSON.stringify({messageIds:e})})).cancelled}async deleteAll(){return(await this.http.request({method:"DELETE",path:["v2","messages"]})).cancelled}},tp=class{baseUrl;token;owner;constructor(e,t,r){this.baseUrl=e,this.token=t,this.owner=r}getUrl(){return`${this.baseUrl}/${this.getRoute().join("/")}`}},th=class extends tp{apiKind="llm";organization;method="POST";constructor(e,t,r,a){super(e,t,r),this.organization=a}getRoute(){return"anthropic"===this.owner?["v1","messages"]:["v1","chat","completions"]}getHeaders(e){if("upstash"===this.owner&&!e.analytics)return{"content-type":"application/json"};let t={["anthropic"===this.owner?"x-api-key":"authorization"]:"anthropic"===this.owner?this.token:`Bearer ${this.token}`,"content-type":"application/json"};return"openai"===this.owner&&this.organization&&(t["OpenAI-Organization"]=this.organization),"anthropic"===this.owner&&(t["anthropic-version"]="2023-06-01"),t}onFinish(e,t){return t.analytics?function(e,t){if("helicone"===t.name)return e.appendHeaders["Helicone-Auth"]=`Bearer ${t.token}`,"upstash"===e.owner?tb(e,"https://qstash.helicone.ai",["llm",...e.route]):(e.appendHeaders["Helicone-Target-Url"]=e.baseUrl,tb(e,"https://gateway.helicone.ai",e.route)),e;throw Error("Unknown analytics provider")}(e,t.analytics):e}},tf=()=>new th("https://qstash.upstash.io/llm","","upstash"),tm=({token:e,organization:t})=>new th("https://api.openai.com",e,"openai",t),ty=({token:e})=>new th("https://api.anthropic.com",e,"anthropic"),tg=({baseUrl:e,token:t})=>new th(e.replace(/\/(v1\/)?chat\/completions$/,""),t,"custom"),tx=(e,t)=>{let{name:r,provider:a,...s}=e,n=a??tf();if("upstash"!==n.owner||n.token||(n.token=t),!n.baseUrl)throw TypeError("baseUrl cannot be empty or undefined!");if(!n.token)throw TypeError("token cannot be empty or undefined!");if(n.apiKind!==r)throw TypeError(`Unexpected api name. Expected '${n.apiKind}', received ${r}`);let i={url:n.getUrl(),baseUrl:n.baseUrl,route:n.getRoute(),appendHeaders:n.getHeaders(s),owner:n.owner,method:n.method};return n.onFinish(i,s)},tv=(e,t)=>{let r=new Headers(t);for(let[t,a]of e.entries())r.set(t,a);return r},tw=(e,t,r)=>{if(!e.api)return e.headers=t,e;let{url:a,appendHeaders:s,owner:n,method:i}=tx(e.api,r);if("llm"!==e.api.name)return{...e,method:e.method??i,headers:tv(t,s),url:a,api:void 0};{let r=e.callback;if(!r)throw TypeError("Callback cannot be undefined when using LLM api.");return{...e,method:e.method??i,headers:tv(t,s),..."upstash"!==n||e.api.analytics?{url:a,api:void 0}:{api:{name:"llm"},url:void 0,callback:r}}}};function tb(e,t,r){e.baseUrl=t,e.route=r,e.url=`${t}/${r.join("/")}`}var t_=e=>{let t=e.toLowerCase();return t.startsWith("content-type")||t.startsWith("upstash-")};function tk(e){for(let t of[...e.keys()].filter(e=>!t_(e))){let r=e.get(t);null!==r&&e.set(`Upstash-Forward-${t}`,r),e.delete(t)}return e}function tS(e,t,r){if(!t)return e;let a=new Headers(t);return e.forEach((e,t)=>{a.set(t,e)}),r?.forEach((e,t)=>{e&&a.append(t,e)}),a}function tT(e){let t=tk(new Headers(e.headers));if(t.set("Upstash-Method",e.method??"POST"),void 0!==e.delay&&("string"==typeof e.delay?t.set("Upstash-Delay",e.delay):t.set("Upstash-Delay",`${e.delay.toFixed(0)}s`)),void 0!==e.notBefore&&t.set("Upstash-Not-Before",e.notBefore.toFixed(0)),void 0!==e.deduplicationId&&t.set("Upstash-Deduplication-Id",e.deduplicationId),e.contentBasedDeduplication&&t.set("Upstash-Content-Based-Deduplication","true"),void 0!==e.retries&&t.set("Upstash-Retries",e.retries.toFixed(0)),void 0!==e.callback&&t.set("Upstash-Callback",e.callback),void 0!==e.failureCallback&&t.set("Upstash-Failure-Callback",e.failureCallback),void 0!==e.timeout&&("string"==typeof e.timeout?t.set("Upstash-Timeout",e.timeout):t.set("Upstash-Timeout",`${e.timeout}s`)),e.flowControl?.key){let r=e.flowControl.parallelism?.toString(),a=(e.flowControl.rate??e.flowControl.ratePerSecond)?.toString(),s="number"==typeof e.flowControl.period?`${e.flowControl.period}s`:e.flowControl.period,n=[r?`parallelism=${r}`:void 0,a?`rate=${a}`:void 0,s?`period=${s}`:void 0].filter(Boolean);if(0===n.length)throw new tr("Provide at least one of parallelism or ratePerSecond for flowControl");t.set("Upstash-Flow-Control-Key",e.flowControl.key),t.set("Upstash-Flow-Control-Value",n.join(", "))}return t}function tE(e){let t=e.url??e.urlGroup??e.topic;if(t)return t;if(e.api?.name==="llm")return"api/llm";if(e.api?.name==="email")return tx(e.api,"not-needed").baseUrl;throw new tr(`Failed to infer request path for ${JSON.stringify(e)}`)}function tI(e){try{let t=atob(e),r=Uint8Array.from(t,e=>e.codePointAt(0));return new TextDecoder().decode(r)}catch(t){try{let r=atob(e);return console.warn(`Upstash QStash: Failed while decoding base64 "${e}". Decoding with atob and returning it instead. ${t}`),r}catch(t){return console.warn(`Upstash QStash: Failed to decode base64 "${e}" with atob. Returning it as it is. ${t}`),e}}}var tC=class{http;queueName;constructor(e,t){this.http=e,this.queueName=t}async upsert(e){if(!this.queueName)throw Error("Please provide a queue name to the Queue constructor");let t={queueName:this.queueName,parallelism:e.parallelism??1,paused:e.paused??!1};await this.http.request({method:"POST",path:["v2","queues"],headers:{"Content-Type":"application/json"},body:JSON.stringify(t),parseResponseAsJson:!1})}async get(){if(!this.queueName)throw Error("Please provide a queue name to the Queue constructor");return await this.http.request({method:"GET",path:["v2","queues",this.queueName]})}async list(){return await this.http.request({method:"GET",path:["v2","queues"]})}async delete(){if(!this.queueName)throw Error("Please provide a queue name to the Queue constructor");await this.http.request({method:"DELETE",path:["v2","queues",this.queueName],parseResponseAsJson:!1})}async enqueue(e){if(!this.queueName)throw Error("Please provide a queue name to the Queue constructor");let t=tS(tT(e),this.http.headers,this.http.telemetryHeaders),r=tE(e);return await this.http.request({path:["v2","enqueue",this.queueName,r],body:e.body,headers:t,method:"POST"})}async enqueueJSON(e){let t=tk(new Headers(e.headers));t.set("Content-Type","application/json");let r=tw(e,t,String(this.http.authorization).split("Bearer ")[1]);return await this.enqueue({...r,body:JSON.stringify(r.body)})}async pause(){if(!this.queueName)throw Error("Please provide a queue name to the Queue constructor");await this.http.request({method:"POST",path:["v2","queues",this.queueName,"pause"],parseResponseAsJson:!1})}async resume(){if(!this.queueName)throw Error("Please provide a queue name to the Queue constructor");await this.http.request({method:"POST",path:["v2","queues",this.queueName,"resume"],parseResponseAsJson:!1})}},tA=class{http;constructor(e){this.http=e}async create(e){let t=tk(new Headers(e.headers));if(t.has("Content-Type")||t.set("Content-Type","application/json"),t.set("Upstash-Cron",e.cron),void 0!==e.method&&t.set("Upstash-Method",e.method),void 0!==e.delay&&("string"==typeof e.delay?t.set("Upstash-Delay",e.delay):t.set("Upstash-Delay",`${e.delay.toFixed(0)}s`)),void 0!==e.retries&&t.set("Upstash-Retries",e.retries.toFixed(0)),void 0!==e.callback&&t.set("Upstash-Callback",e.callback),void 0!==e.failureCallback&&t.set("Upstash-Failure-Callback",e.failureCallback),void 0!==e.timeout&&("string"==typeof e.timeout?t.set("Upstash-Timeout",e.timeout):t.set("Upstash-Timeout",`${e.timeout}s`)),void 0!==e.scheduleId&&t.set("Upstash-Schedule-Id",e.scheduleId),void 0!==e.queueName&&t.set("Upstash-Queue-Name",e.queueName),e.flowControl?.key){let r=e.flowControl.parallelism?.toString(),a=(e.flowControl.rate??e.flowControl.ratePerSecond)?.toString(),s="number"==typeof e.flowControl.period?`${e.flowControl.period}s`:e.flowControl.period,n=[r?`parallelism=${r}`:void 0,a?`rate=${a}`:void 0,s?`period=${s}`:void 0].filter(Boolean);if(0===n.length)throw new tr("Provide at least one of parallelism or ratePerSecond for flowControl");t.set("Upstash-Flow-Control-Key",e.flowControl.key),t.set("Upstash-Flow-Control-Value",n.join(", "))}return await this.http.request({method:"POST",headers:tS(t,this.http.headers,this.http.telemetryHeaders),path:["v2","schedules",e.destination],body:e.body})}async get(e){let t=await this.http.request({method:"GET",path:["v2","schedules",e]});return"rate"in t&&(t.ratePerSecond=t.rate),t}async list(){let e=await this.http.request({method:"GET",path:["v2","schedules"]});for(let t of e)"rate"in t&&(t.ratePerSecond=t.rate);return e}async delete(e){return await this.http.request({method:"DELETE",path:["v2","schedules",e],parseResponseAsJson:!1})}async pause({schedule:e}){await this.http.request({method:"PATCH",path:["v2","schedules",e,"pause"],parseResponseAsJson:!1})}async resume({schedule:e}){await this.http.request({method:"PATCH",path:["v2","schedules",e,"resume"],parseResponseAsJson:!1})}},tR=class{http;constructor(e){this.http=e}async addEndpoints(e){await this.http.request({method:"POST",path:["v2","topics",e.name,"endpoints"],headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoints:e.endpoints}),parseResponseAsJson:!1})}async removeEndpoints(e){await this.http.request({method:"DELETE",path:["v2","topics",e.name,"endpoints"],headers:{"Content-Type":"application/json"},body:JSON.stringify({endpoints:e.endpoints}),parseResponseAsJson:!1})}async list(){return await this.http.request({method:"GET",path:["v2","topics"]})}async get(e){return await this.http.request({method:"GET",path:["v2","topics",e]})}async delete(e){return await this.http.request({method:"DELETE",path:["v2","topics",e],parseResponseAsJson:!1})}},tN=class{http;token;constructor(e){let t="undefined"==typeof process?{}:process.env,r=(e?.baseUrl??t.QSTASH_URL??"https://qstash.upstash.io").replace(/\/$/,"");"https://qstash.upstash.io/v2/publish"===r&&(r="https://qstash.upstash.io");let a=e?.token??t.QSTASH_TOKEN,s=!t.UPSTASH_DISABLE_TELEMETRY&&(e?.enableTelemetry??!0),n="undefined"!=typeof caches&&"default"in caches,i=new Headers(s?{"Upstash-Telemetry-Sdk":"upstash-qstash-js@v2.8.1","Upstash-Telemetry-Platform":n?"cloudflare":t.VERCEL?"vercel":t.AWS_REGION?"aws":"","Upstash-Telemetry-Runtime":"object"==typeof process&&"object"==typeof process.versions&&process.versions.bun?`bun@${process.versions.bun}`:"string"==typeof EdgeRuntime?"edge-light":"object"==typeof process&&"string"==typeof process.version?`node@${process.version}`:""}:{});this.http=new tl({retry:e?.retry,baseUrl:r,authorization:`Bearer ${a}`,headers:tk(new Headers(e?.headers??{})),telemetryHeaders:i}),a||console.warn("[Upstash QStash] client token is not set. Either pass a token or set QSTASH_TOKEN env variable."),this.token=a}get urlGroups(){return new tR(this.http)}get topics(){return this.urlGroups}get dlq(){return new tt(this.http)}get messages(){return new td(this.http)}get schedules(){return new tA(this.http)}get workflow(){return new tz(this.http)}queue(e){return new tC(this.http,e?.queueName)}chat(){return new tc(this.http,this.token)}async publish(e){let t=tS(tT(e),this.http.headers,this.http.telemetryHeaders);return await this.http.request({path:["v2","publish",tE(e)],body:e.body,headers:t,method:"POST"})}async publishJSON(e){let t=tk(new Headers(e.headers));t.set("Content-Type","application/json");let r=tw(e,t,String(this.http.authorization).split("Bearer ")[1]);return await this.publish({...r,body:JSON.stringify(r.body)})}async batch(e){let t=[];for(let r of e){let e=Object.fromEntries(tS(tT(r),this.http.headers,this.http.telemetryHeaders).entries());t.push({destination:tE(r),headers:e,body:r.body,...r.queueName&&{queue:r.queueName}})}let r=await this.http.request({path:["v2","batch"],body:JSON.stringify(t),headers:{"Content-Type":"application/json"},method:"POST"});return Array.isArray(r)?r:[r]}async batchJSON(e){let t=e.map(e=>{"body"in e&&(e.body=JSON.stringify(e.body));let t=String(this.http.authorization).split("Bearer ")[1],r=tw(e,new Headers(e.headers),t);return r.headers.set("Content-Type","application/json"),r});return await this.batch(t)}async logs(e){let t={};for(let[r,a]of("number"==typeof e?.cursor&&e.cursor>0?t.cursor=e.cursor.toString():"string"==typeof e?.cursor&&""!==e.cursor&&(t.cursor=e.cursor),Object.entries(e?.filter??{})))"number"==typeof a&&a<0||("urlGroup"===r?t.topicName=a.toString():void 0!==a&&(t[r]=a.toString()));let r=await this.http.request({path:["v2","events"],method:"GET",query:t}),a=r.events.map(e=>({...e,urlGroup:e.topicName}));return{cursor:r.cursor,logs:a,events:a}}async events(e){return await this.logs(e)}},tO=(e,t,r,a,s,n,i)=>{let o={"Upstash-Workflow-Init":e,"Upstash-Workflow-RunId":t,"Upstash-Workflow-Url":r,"Upstash-Forward-Upstash-Workflow-Sdk-Version":"1",...n?{"Upstash-Failure-Callback-Forward-Upstash-Workflow-Is-Failure":"true","Upstash-Failure-Callback":n}:{},...void 0===i?{}:{"Upstash-Retries":i.toString()}};if(a)for(let e of a.keys())s?.callHeaders?o[`Upstash-Callback-Forward-${e}`]=a.get(e):o[`Upstash-Forward-${e}`]=a.get(e);if(s?.callHeaders){let e=Object.fromEntries(Object.entries(s.callHeaders).map(([e,t])=>[`Upstash-Forward-${e}`,t])),a=s.callHeaders["Content-Type"];return{...o,...e,"Upstash-Callback":r,"Upstash-Callback-Workflow-RunId":t,"Upstash-Callback-Workflow-CallType":"fromCallback","Upstash-Callback-Workflow-Init":"false","Upstash-Callback-Workflow-Url":r,"Upstash-Callback-Forward-Upstash-Workflow-Callback":"true","Upstash-Callback-Forward-Upstash-Workflow-StepId":s.stepId.toString(),"Upstash-Callback-Forward-Upstash-Workflow-StepName":s.stepName,"Upstash-Callback-Forward-Upstash-Workflow-StepType":s.stepType,"Upstash-Callback-Forward-Upstash-Workflow-Concurrent":s.concurrent.toString(),"Upstash-Callback-Forward-Upstash-Workflow-ContentType":a??"application/json","Upstash-Workflow-CallType":"toCallback"}}return o},tP=class e{context;promises=new WeakMap;activeLazyStepList;debug;nonPlanStepCount;steps;indexInCurrentList=0;stepCount=0;planStepCount=0;executingStep=!1;constructor(e,t,r){this.context=e,this.debug=r,this.steps=t,this.nonPlanStepCount=this.steps.filter(e=>!e.targetStep).length}async addStep(t){if(this.executingStep)throw new ti(`A step can not be run inside another step. Tried to run '${t.stepName}' inside '${this.executingStep}'`);this.stepCount+=1;let r=this.activeLazyStepList??[];this.activeLazyStepList||(this.activeLazyStepList=r,this.indexInCurrentList=0),r.push(t);let a=this.indexInCurrentList++,s=this.deferExecution().then(async()=>{if(!this.promises.has(r)){let e=this.getExecutionPromise(r);this.promises.set(r,e),this.activeLazyStepList=void 0,this.planStepCount+=r.length>1?r.length:0}return this.promises.get(r)}),n=await s;return e.getResult(r,n,a)}wrapStep(e,t){this.executingStep=e;let r=t();return this.executingStep=!1,r}async runSingle(e){if(this.stepCount<this.nonPlanStepCount){let t=this.steps[this.stepCount+this.planStepCount];return tU(e,t),await this.debug?.log("INFO","RUN_SINGLE",{fromRequest:!0,step:t,stepCount:this.stepCount}),t.out}let t=await e.getResultStep(1,this.stepCount);return await this.debug?.log("INFO","RUN_SINGLE",{fromRequest:!1,step:t,stepCount:this.stepCount}),await this.submitStepsToQStash([t]),t.out}async runParallel(e){let t=this.stepCount-(e.length-1),r=this.getParallelCallState(e.length,t),a=tj(this.steps),s=a[t+this.planStepCount]?.concurrent;if("first"!==r&&s!==e.length)throw new ti(`Incompatible number of parallel steps when call state was '${r}'. Expected ${e.length}, got ${s} from the request.`);switch(await this.debug?.log("INFO","RUN_PARALLEL",{parallelCallState:r,initialStepCount:t,plannedParallelStepCount:s,stepCount:this.stepCount,planStepCount:this.planStepCount}),r){case"first":{let r=e.map((r,a)=>r.getPlanStep(e.length,t+a));await this.submitStepsToQStash(r);break}case"partial":{let r=this.steps.at(-1);if(!r||void 0===r.targetStep)throw new ti(`There must be a last step and it should have targetStep larger than 0.Received: ${JSON.stringify(r)}`);let a=r.targetStep-t;tU(e[a],r);try{let t=await e[a].getResultStep(e.length,r.targetStep);await this.submitStepsToQStash([t])}catch(e){if(e instanceof to)throw e;throw new ti(`Error submitting steps to QStash in partial parallel step execution: ${e}`)}break}case"discard":throw new to("discarded parallel");case"last":{let r=a.filter(e=>e.stepId>=t).slice(0,e.length);return t$(e,r),r.map(e=>e.out)}}return Array.from({length:e.length}).fill(void 0)}getParallelCallState(e,t){let r=this.steps.filter(e=>(e.targetStep??e.stepId)>=t);return 0===r.length?"first":r.length>=2*e?"last":r.at(-1)?.targetStep?"partial":"discard"}async submitStepsToQStash(e){if(0===e.length)throw new ti(`Unable to submit steps to QStash. Provided list is empty. Current step: ${this.stepCount}`);await this.debug?.log("SUBMIT","SUBMIT_STEP",{length:e.length,steps:e});let t=await this.context.qstashClient.batchJSON(e.map(e=>{let t=tO("false",this.context.workflowRunId,this.context.url,this.context.headers,e,this.context.failureUrl,this.context.retries),r=1===e.concurrent||0===e.stepId;return e.callUrl?{headers:t,method:e.callMethod,body:e.callBody,url:e.callUrl}:{headers:t,method:"POST",body:e,url:this.context.url,notBefore:r?e.sleepUntil:void 0,delay:r?e.sleepFor:void 0}}));throw await this.debug?.log("INFO","SUBMIT_STEP",{messageIds:t.map(e=>({message:e.messageId}))}),new to(e[0].stepName,e[0])}getExecutionPromise(e){return 1===e.length?this.runSingle(e[0]):this.runParallel(e)}static getResult(e,t,r){if(1===e.length)return t;if(Array.isArray(t)&&e.length===t.length&&r<e.length)return t[r];throw new ti(`Unexpected parallel call result while executing step ${r}: '${t}'. Expected ${e.length} many items`)}async deferExecution(){await Promise.resolve(),await Promise.resolve()}},tU=(e,t)=>{if(e.stepName!==t.stepName)throw new ti(`Incompatible step name. Expected '${e.stepName}', got '${t.stepName}' from the request`);if(e.stepType!==t.stepType)throw new ti(`Incompatible step type. Expected '${e.stepType}', got '${t.stepType}' from the request`)},t$=(e,t)=>{try{for(let[r,a]of t.entries())tU(e[r],a)}catch(r){if(r instanceof ti){let a=e.map(e=>e.stepName),s=e.map(e=>e.stepType),n=t.map(e=>e.stepName),i=t.map(e=>e.stepType);throw new ti(`Incompatible steps detected in parallel execution: ${r.message}
  > Step Names from the request: ${JSON.stringify(n)}
    Step Types from the request: ${JSON.stringify(i)}
  > Step Names expected: ${JSON.stringify(a)}
    Step Types expected: ${JSON.stringify(s)}`)}throw r}},tj=e=>{let t=e=>e.targetStep??e.stepId;return[...e].sort((e,r)=>t(e)-t(r))},tM=class{stepName;constructor(e){this.stepName=e}},tB=class extends tM{stepFunction;stepType="Run";constructor(e,t){super(e),this.stepFunction=t}getPlanStep(e,t){return{stepId:0,stepName:this.stepName,stepType:this.stepType,concurrent:e,targetStep:t}}async getResultStep(e,t){let r=this.stepFunction();return r instanceof Promise&&(r=await r),{stepId:t,stepName:this.stepName,stepType:this.stepType,out:r,concurrent:e}}},tF=class extends tM{sleep;stepType="SleepFor";constructor(e,t){super(e),this.sleep=t}getPlanStep(e,t){return{stepId:0,stepName:this.stepName,stepType:this.stepType,sleepFor:this.sleep,concurrent:e,targetStep:t}}async getResultStep(e,t){return await Promise.resolve({stepId:t,stepName:this.stepName,stepType:this.stepType,sleepFor:this.sleep,concurrent:e})}},tq=class extends tM{sleepUntil;stepType="SleepUntil";constructor(e,t){super(e),this.sleepUntil=t}getPlanStep(e,t){return{stepId:0,stepName:this.stepName,stepType:this.stepType,sleepUntil:this.sleepUntil,concurrent:e,targetStep:t}}async getResultStep(e,t){return await Promise.resolve({stepId:t,stepName:this.stepName,stepType:this.stepType,sleepUntil:this.sleepUntil,concurrent:e})}},tD=class extends tM{url;method;body;headers;stepType="Call";constructor(e,t,r,a,s){super(e),this.url=t,this.method=r,this.body=a,this.headers=s}getPlanStep(e,t){return{stepId:0,stepName:this.stepName,stepType:this.stepType,concurrent:e,targetStep:t}}async getResultStep(e,t){return await Promise.resolve({stepId:t,stepName:this.stepName,stepType:this.stepType,concurrent:e,callUrl:this.url,callMethod:this.method,callBody:this.body,callHeaders:this.headers})}},tL=e=>{let[t,...r]=JSON.parse(e),a=tI(t.body),s=[{stepId:0,stepName:"init",stepType:"Initial",out:a,concurrent:1},...r.filter(e=>"step"===e.callType).map(e=>JSON.parse(tI(e.body)))];return{rawInitialPayload:a,steps:s}},tH=e=>{let t=[],r=[],a=[];for(let s of e)0===s.stepId?t.includes(s.targetStep??0)||(a.push(s),t.push(s.targetStep??0)):r.includes(s.stepId)||(a.push(s),r.push(s.stepId));return a},tW=async(e,t)=>{if(e.length<2)return!1;let r=e.at(-1),a=r.stepId,s=r.targetStep;for(let r=0;r<e.length-1;r++){let n=e[r];if(n.stepId===a&&n.targetStep===s){let e=`Upstash Workflow: The step '${n.stepName}' with id '${n.stepId}'  has run twice during workflow execution. Rest of the workflow will continue running as usual.`;return await t?.log("WARN","RESPONSE_DEFAULT",e),console.warn(e),!0}}return!1},tz=class{http;constructor(e){this.http=e}async cancel(e){return await this.http.request({path:["v2","workflows","runs",`${e}?cancel=true`],method:"DELETE",parseResponseAsJson:!1})??!0}},tJ=class extends tp{apiKind="email";batch;method="POST";constructor(e,t,r,a){super(e,t,r),this.batch=a}getRoute(){return this.batch?["emails","batch"]:["emails"]}getHeaders(e){return{authorization:`Bearer ${this.token}`}}onFinish(e,t){return e}},tZ=({token:e,batch:t=!1})=>new tJ("https://api.resend.com",e,"resend",t),tK="vercel.ai.error",tV=Symbol.for(tK),tG=class e extends Error{constructor({name:e,message:t,cause:r}){super(t),this[i]=!0,this.name=e,this.cause=r}static isInstance(t){return e.hasMarker(t,tK)}static hasMarker(e,t){let r=Symbol.for(t);return null!=e&&"object"==typeof e&&r in e&&"boolean"==typeof e[r]&&!0===e[r]}};i=tV;var tQ=tG,tY="AI_APICallError",tX=`vercel.ai.error.${tY}`,t0=Symbol.for(tX),t1=class extends tQ{constructor({message:e,url:t,requestBodyValues:r,statusCode:a,responseHeaders:s,responseBody:n,cause:i,isRetryable:l=null!=a&&(408===a||409===a||429===a||a>=500),data:u}){super({name:tY,message:e,cause:i}),this[o]=!0,this.url=t,this.requestBodyValues=r,this.statusCode=a,this.responseHeaders=s,this.responseBody=n,this.isRetryable=l,this.data=u}static isInstance(e){return tQ.hasMarker(e,tX)}};o=t0;var t2="AI_EmptyResponseBodyError",t4=`vercel.ai.error.${t2}`,t8=Symbol.for(t4),t6=class extends tQ{constructor({message:e="Empty response body"}={}){super({name:t2,message:e}),this[l]=!0}static isInstance(e){return tQ.hasMarker(e,t4)}};function t5(e){return null==e?"unknown error":"string"==typeof e?e:e instanceof Error?e.message:JSON.stringify(e)}l=t8;var t3="AI_InvalidArgumentError",t9=`vercel.ai.error.${t3}`,t7=Symbol.for(t9),re=class extends tQ{constructor({message:e,cause:t,argument:r}){super({name:t3,message:e,cause:t}),this[u]=!0,this.argument=r}static isInstance(e){return tQ.hasMarker(e,t9)}};u=t7;var rt="AI_InvalidPromptError",rr=`vercel.ai.error.${rt}`,ra=Symbol.for(rr),rs=class extends tQ{constructor({prompt:e,message:t,cause:r}){super({name:rt,message:`Invalid prompt: ${t}`,cause:r}),this[c]=!0,this.prompt=e}static isInstance(e){return tQ.hasMarker(e,rr)}};c=ra;var rn="AI_InvalidResponseDataError",ri=`vercel.ai.error.${rn}`,ro=Symbol.for(ri),rl=class extends tQ{constructor({data:e,message:t=`Invalid response data: ${JSON.stringify(e)}.`}){super({name:rn,message:t}),this[d]=!0,this.data=e}static isInstance(e){return tQ.hasMarker(e,ri)}};d=ro;var ru="AI_JSONParseError",rc=`vercel.ai.error.${ru}`,rd=Symbol.for(rc),rp=class extends tQ{constructor({text:e,cause:t}){super({name:ru,message:`JSON parsing failed: Text: ${e}.
Error message: ${t5(t)}`,cause:t}),this[p]=!0,this.text=e}static isInstance(e){return tQ.hasMarker(e,rc)}};p=rd;var rh="AI_LoadAPIKeyError",rf=`vercel.ai.error.${rh}`,rm=Symbol.for(rf),ry=class extends tQ{constructor({message:e}){super({name:rh,message:e}),this[h]=!0}static isInstance(e){return tQ.hasMarker(e,rf)}};h=rm,Symbol.for("vercel.ai.error.AI_LoadSettingError"),Symbol.for("vercel.ai.error.AI_NoContentGeneratedError");var rg="AI_NoSuchModelError",rx=`vercel.ai.error.${rg}`,rv=Symbol.for(rx),rw=class extends tQ{constructor({errorName:e=rg,modelId:t,modelType:r,message:a=`No such ${r}: ${t}`}){super({name:e,message:a}),this[f]=!0,this.modelId=t,this.modelType=r}static isInstance(e){return tQ.hasMarker(e,rx)}};f=rv;var rb="AI_TooManyEmbeddingValuesForCallError",r_=`vercel.ai.error.${rb}`,rk=Symbol.for(r_),rS=class extends tQ{constructor(e){super({name:rb,message:`Too many values for a single embedding call. The ${e.provider} model "${e.modelId}" can only embed up to ${e.maxEmbeddingsPerCall} values per call, but ${e.values.length} values were provided.`}),this[m]=!0,this.provider=e.provider,this.modelId=e.modelId,this.maxEmbeddingsPerCall=e.maxEmbeddingsPerCall,this.values=e.values}static isInstance(e){return tQ.hasMarker(e,r_)}};m=rk;var rT="AI_TypeValidationError",rE=`vercel.ai.error.${rT}`,rI=Symbol.for(rE),rC=class e extends tQ{constructor({value:e,cause:t}){super({name:rT,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${t5(t)}`,cause:t}),this[y]=!0,this.value=e}static isInstance(e){return tQ.hasMarker(e,rE)}static wrap({value:t,cause:r}){return e.isInstance(r)&&r.value===t?r:new e({value:t,cause:r})}};y=rI;var rA="AI_UnsupportedFunctionalityError",rR=`vercel.ai.error.${rA}`,rN=Symbol.for(rR),rO=class extends tQ{constructor({functionality:e,message:t=`'${e}' functionality not supported.`}){super({name:rA,message:t}),this[g]=!0,this.functionality=e}static isInstance(e){return tQ.hasMarker(e,rR)}};function rP(e){return null===e||"string"==typeof e||"number"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(rP):"object"==typeof e&&Object.entries(e).every(([e,t])=>"string"==typeof e&&rP(t)))}g=rN;let rU=(e,t=21)=>(r=t)=>{let a="",s=0|r;for(;s--;)a+=e[Math.random()*e.length|0];return a};var r$=r(5487);function rj(...e){return e.reduce((e,t)=>({...e,...null!=t?t:{}}),{})}async function rM(e){return null==e?Promise.resolve():new Promise(t=>setTimeout(t,e))}function rB(e){let t={};return e.headers.forEach((e,r)=>{t[r]=e}),t}var rF=({prefix:e,size:t=16,alphabet:r="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:a="-"}={})=>{let s=rU(r,t);if(null==e)return s;if(r.includes(a))throw new re({argument:"separator",message:`The separator "${a}" must not be part of the alphabet "${r}".`});return t=>`${e}${a}${s(t)}`},rq=rF();function rD(e){return e instanceof Error&&("AbortError"===e.name||"TimeoutError"===e.name)}var rL=Symbol.for("vercel.ai.validator");function rH({value:e,schema:t}){let r="object"==typeof t&&null!==t&&rL in t&&!0===t[rL]&&"validate"in t?t:{[rL]:!0,validate:e=>{let r=t.safeParse(e);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}};try{if(null==r.validate)return{success:!0,value:e};let t=r.validate(e);if(t.success)return t;return{success:!1,error:rC.wrap({value:e,cause:t.error})}}catch(t){return{success:!1,error:rC.wrap({value:e,cause:t})}}}function rW({text:e,schema:t}){try{let r=r$.parse(e);if(null==t)return{success:!0,value:r,rawValue:r};let a=rH({value:r,schema:t});return a.success?{...a,rawValue:r}:a}catch(t){return{success:!1,error:rp.isInstance(t)?t:new rp({text:e,cause:t})}}}function rz(e){try{return r$.parse(e),!0}catch(e){return!1}}function rJ({provider:e,providerOptions:t,schema:r}){if((null==t?void 0:t[e])==null)return;let a=rH({value:t[e],schema:r});if(!a.success)throw new re({argument:"providerOptions",message:`invalid ${e} provider options`,cause:a.error});return a.value}var rZ=()=>globalThis.fetch,rK=async({url:e,headers:t,body:r,failedResponseHandler:a,successfulResponseHandler:s,abortSignal:n,fetch:i})=>rG({url:e,headers:{"Content-Type":"application/json",...t},body:{content:JSON.stringify(r),values:r},failedResponseHandler:a,successfulResponseHandler:s,abortSignal:n,fetch:i}),rV=async({url:e,headers:t,formData:r,failedResponseHandler:a,successfulResponseHandler:s,abortSignal:n,fetch:i})=>rG({url:e,headers:t,body:{content:r,values:Object.fromEntries(r.entries())},failedResponseHandler:a,successfulResponseHandler:s,abortSignal:n,fetch:i}),rG=async({url:e,headers:t={},body:r,successfulResponseHandler:a,failedResponseHandler:s,abortSignal:n,fetch:i=rZ()})=>{try{let o=await i(e,{method:"POST",headers:Object.fromEntries(Object.entries(t).filter(([e,t])=>null!=t)),body:r.content,signal:n}),l=rB(o);if(!o.ok){let t;try{t=await s({response:o,url:e,requestBodyValues:r.values})}catch(t){if(rD(t)||t1.isInstance(t))throw t;throw new t1({message:"Failed to process error response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}throw t.value}try{return await a({response:o,url:e,requestBodyValues:r.values})}catch(t){if(t instanceof Error&&(rD(t)||t1.isInstance(t)))throw t;throw new t1({message:"Failed to process successful response",cause:t,statusCode:o.status,url:e,responseHeaders:l,requestBodyValues:r.values})}}catch(t){if(rD(t))throw t;if(t instanceof TypeError&&"fetch failed"===t.message){let a=t.cause;if(null!=a)throw new t1({message:`Cannot connect to API: ${a.message}`,cause:a,url:e,requestBodyValues:r.values,isRetryable:!0})}throw t}},rQ=e=>async({response:t})=>{let r=rB(t);if(null==t.body)throw new t6({});return{responseHeaders:r,value:t.body.pipeThrough(new TextDecoderStream).pipeThrough(function(){let e,t,r,a="",s=[];function n(e,t){if(""===e){i(t);return}if(e.startsWith(":"))return;let r=e.indexOf(":");if(-1===r){o(e,"");return}let a=e.slice(0,r),s=r+1;o(a,s<e.length&&" "===e[s]?e.slice(s+1):e.slice(s))}function i(a){s.length>0&&(a.enqueue({event:e,data:s.join("\n"),id:t,retry:r}),s=[],e=void 0,r=void 0)}function o(a,n){switch(a){case"event":e=n;break;case"data":s.push(n);break;case"id":t=n;break;case"retry":let i=parseInt(n,10);isNaN(i)||(r=i)}}return new TransformStream({transform(e,t){let{lines:r,incompleteLine:s}=function(e,t){let r=[],a=e;for(let e=0;e<t.length;){let s=t[e++];"\n"===s?(r.push(a),a=""):"\r"===s?(r.push(a),a="","\n"===t[e]&&e++):a+=s}return{lines:r,incompleteLine:a}}(a,e);a=s;for(let e=0;e<r.length;e++)n(r[e],t)},flush(e){n(a,e),i(e)}})}()).pipeThrough(new TransformStream({transform({data:t},r){"[DONE]"!==t&&r.enqueue(rW({text:t,schema:e}))}}))}},rY=e=>async({response:t,url:r,requestBodyValues:a})=>{let s=await t.text(),n=rW({text:s,schema:e}),i=rB(t);if(!n.success)throw new t1({message:"Invalid JSON response",cause:n.error,statusCode:t.status,responseHeaders:i,responseBody:s,url:r,requestBodyValues:a});return{responseHeaders:i,value:n.value,rawValue:n.rawValue}},rX=()=>async({response:e,url:t,requestBodyValues:r})=>{let a=rB(e);if(!e.body)throw new t1({message:"Response body is empty",url:t,requestBodyValues:r,statusCode:e.status,responseHeaders:a,responseBody:void 0});try{let t=await e.arrayBuffer();return{responseHeaders:a,value:new Uint8Array(t)}}catch(s){throw new t1({message:"Failed to read response as array buffer",url:t,requestBodyValues:r,statusCode:e.status,responseHeaders:a,responseBody:void 0,cause:s})}},{btoa:r0,atob:r1}=globalThis;function r2(e){let t=r1(e.replace(/-/g,"+").replace(/_/g,"/"));return Uint8Array.from(t,e=>e.codePointAt(0))}function r4(e){let t="";for(let r=0;r<e.length;r++)t+=String.fromCodePoint(e[r]);return r0(t)}var r8=r(72944),r6=r(20916);(function(e){e.assertEqual=e=>{},e.assertIs=function(e){},e.assertNever=function(e){throw Error()},e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&Number.isFinite(e)&&Math.floor(e)===e,e.joinValues=function(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)},e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t})(x||(x={})),(v||(v={})).mergeShapes=(e,t)=>({...e,...t});let r5=x.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),r3=e=>{switch(typeof e){case"undefined":return r5.undefined;case"string":return r5.string;case"number":return Number.isNaN(e)?r5.nan:r5.number;case"boolean":return r5.boolean;case"function":return r5.function;case"bigint":return r5.bigint;case"symbol":return r5.symbol;case"object":if(Array.isArray(e))return r5.array;if(null===e)return r5.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return r5.promise;if("undefined"!=typeof Map&&e instanceof Map)return r5.map;if("undefined"!=typeof Set&&e instanceof Set)return r5.set;if("undefined"!=typeof Date&&e instanceof Date)return r5.date;return r5.object;default:return r5.unknown}},r9=x.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);class r7 extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}format(e){let t=e||function(e){return e.message},r={_errors:[]},a=e=>{for(let s of e.issues)if("invalid_union"===s.code)s.unionErrors.map(a);else if("invalid_return_type"===s.code)a(s.returnTypeError);else if("invalid_arguments"===s.code)a(s.argumentsError);else if(0===s.path.length)r._errors.push(t(s));else{let e=r,a=0;for(;a<s.path.length;){let r=s.path[a];a===s.path.length-1?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(s))):e[r]=e[r]||{_errors:[]},e=e[r],a++}}};return a(this),r}static assert(e){if(!(e instanceof r7))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,x.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}}r7.create=e=>new r7(e);let ae=(e,t)=>{let r;switch(e.code){case r9.invalid_type:r=e.received===r5.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case r9.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,x.jsonStringifyReplacer)}`;break;case r9.unrecognized_keys:r=`Unrecognized key(s) in object: ${x.joinValues(e.keys,", ")}`;break;case r9.invalid_union:r="Invalid input";break;case r9.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${x.joinValues(e.options)}`;break;case r9.invalid_enum_value:r=`Invalid enum value. Expected ${x.joinValues(e.options)}, received '${e.received}'`;break;case r9.invalid_arguments:r="Invalid function arguments";break;case r9.invalid_return_type:r="Invalid function return type";break;case r9.invalid_date:r="Invalid date";break;case r9.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:x.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case r9.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case r9.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case r9.custom:r="Invalid input";break;case r9.invalid_intersection_types:r="Intersection results could not be merged";break;case r9.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case r9.not_finite:r="Number must be finite";break;default:r=t.defaultError,x.assertNever(e)}return{message:r}},at=e=>{let{data:t,path:r,errorMaps:a,issueData:s}=e,n=[...r,...s.path||[]],i={...s,path:n};if(void 0!==s.message)return{...s,path:n,message:s.message};let o="";for(let e of a.filter(e=>!!e).slice().reverse())o=e(i,{data:t,defaultError:o}).message;return{...s,path:n,message:o}};function ar(e,t){let r=at({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,ae,ae==ae?void 0:ae].filter(e=>!!e)});e.common.issues.push(r)}class aa{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if("aborted"===a.status)return as;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,a=await e.value;r.push({key:t,value:a})}return aa.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:t,value:s}=a;if("aborted"===t.status||"aborted"===s.status)return as;"dirty"===t.status&&e.dirty(),"dirty"===s.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==s.value||a.alwaysSet)&&(r[t.value]=s.value)}return{status:e.value,value:r}}}let as=Object.freeze({status:"aborted"}),an=e=>({status:"dirty",value:e}),ai=e=>({status:"valid",value:e}),ao=e=>"aborted"===e.status,al=e=>"dirty"===e.status,au=e=>"valid"===e.status,ac=e=>"undefined"!=typeof Promise&&e instanceof Promise;!function(e){e.errToObj=e=>"string"==typeof e?{message:e}:e||{},e.toString=e=>"string"==typeof e?e:e?.message}(w||(w={}));class ad{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}}let ap=(e,t)=>{if(au(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new r7(e.common.issues);return this._error=t,this._error}}};function ah(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:s}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:s}:{errorMap:(t,s)=>{let{message:n}=e;return"invalid_enum_value"===t.code?{message:n??s.defaultError}:void 0===s.data?{message:n??a??s.defaultError}:"invalid_type"!==t.code?{message:s.defaultError}:{message:n??r??s.defaultError}},description:s}}class af{get description(){return this._def.description}_getType(e){return r3(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:r3(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new aa,ctx:{common:e.parent.common,data:e.data,parsedType:r3(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(ac(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){return Promise.resolve(this._parse(e))}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){let r={common:{issues:[],async:t?.async??!1,contextualErrorMap:t?.errorMap},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:r3(e)},a=this._parseSync({data:e,path:r.path,parent:r});return ap(r,a)}"~validate"(e){let t={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:r3(e)};if(!this["~standard"].async)try{let r=this._parseSync({data:e,path:[],parent:t});return au(r)?{value:r.value}:{issues:t.common.issues}}catch(e){e?.message?.toLowerCase()?.includes("encountered")&&(this["~standard"].async=!0),t.common={issues:[],async:!0}}return this._parseAsync({data:e,path:[],parent:t}).then(e=>au(e)?{value:e.value}:{issues:t.common.issues})}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:t?.errorMap,async:!0},path:t?.path||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:r3(e)},a=this._parse({data:e,path:r.path,parent:r});return ap(r,await (ac(a)?a:Promise.resolve(a)))}refine(e,t){let r=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,a)=>{let s=e(t),n=()=>a.addIssue({code:r9.custom,...r(t)});return"undefined"!=typeof Promise&&s instanceof Promise?s.then(e=>!!e||(n(),!1)):!!s||(n(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new a3({schema:this,typeName:b.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return a9.create(this,this._def)}nullable(){return a7.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return aW.create(this)}promise(){return a5.create(this,this._def)}or(e){return aJ.create([this,e],this._def)}and(e){return aV.create(this,e,this._def)}transform(e){return new a3({...ah(this._def),schema:this,typeName:b.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new se({...ah(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:b.ZodDefault})}brand(){return new sa({typeName:b.ZodBranded,type:this,...ah(this._def)})}catch(e){return new st({...ah(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:b.ZodCatch})}describe(e){return new this.constructor({...this._def,description:e})}pipe(e){return ss.create(this,e)}readonly(){return sn.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}}let am=/^c[^\s-]{8,}$/i,ay=/^[0-9a-z]+$/,ag=/^[0-9A-HJKMNP-TV-Z]{26}$/i,ax=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,av=/^[a-z0-9_-]{21}$/i,aw=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,ab=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,a_=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,ak=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,aS=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,aT=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,aE=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,aI=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,aC=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,aA="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",aR=RegExp(`^${aA}$`);function aN(e){let t="[0-5]\\d";e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`);let r=e.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${t})${r}`}class aO extends af{_parse(e){var t,r,s,n;let i;if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==r5.string){let t=this._getOrReturnCtx(e);return ar(t,{code:r9.invalid_type,expected:r5.string,received:t.parsedType}),as}let o=new aa;for(let l of this._def.checks)if("min"===l.kind)e.data.length<l.value&&(ar(i=this._getOrReturnCtx(e,i),{code:r9.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("max"===l.kind)e.data.length>l.value&&(ar(i=this._getOrReturnCtx(e,i),{code:r9.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!1,message:l.message}),o.dirty());else if("length"===l.kind){let t=e.data.length>l.value,r=e.data.length<l.value;(t||r)&&(i=this._getOrReturnCtx(e,i),t?ar(i,{code:r9.too_big,maximum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}):r&&ar(i,{code:r9.too_small,minimum:l.value,type:"string",inclusive:!0,exact:!0,message:l.message}),o.dirty())}else if("email"===l.kind)a_.test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{validation:"email",code:r9.invalid_string,message:l.message}),o.dirty());else if("emoji"===l.kind)a||(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a.test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{validation:"emoji",code:r9.invalid_string,message:l.message}),o.dirty());else if("uuid"===l.kind)ax.test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{validation:"uuid",code:r9.invalid_string,message:l.message}),o.dirty());else if("nanoid"===l.kind)av.test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{validation:"nanoid",code:r9.invalid_string,message:l.message}),o.dirty());else if("cuid"===l.kind)am.test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{validation:"cuid",code:r9.invalid_string,message:l.message}),o.dirty());else if("cuid2"===l.kind)ay.test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{validation:"cuid2",code:r9.invalid_string,message:l.message}),o.dirty());else if("ulid"===l.kind)ag.test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{validation:"ulid",code:r9.invalid_string,message:l.message}),o.dirty());else if("url"===l.kind)try{new URL(e.data)}catch{ar(i=this._getOrReturnCtx(e,i),{validation:"url",code:r9.invalid_string,message:l.message}),o.dirty()}else"regex"===l.kind?(l.regex.lastIndex=0,l.regex.test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{validation:"regex",code:r9.invalid_string,message:l.message}),o.dirty())):"trim"===l.kind?e.data=e.data.trim():"includes"===l.kind?e.data.includes(l.value,l.position)||(ar(i=this._getOrReturnCtx(e,i),{code:r9.invalid_string,validation:{includes:l.value,position:l.position},message:l.message}),o.dirty()):"toLowerCase"===l.kind?e.data=e.data.toLowerCase():"toUpperCase"===l.kind?e.data=e.data.toUpperCase():"startsWith"===l.kind?e.data.startsWith(l.value)||(ar(i=this._getOrReturnCtx(e,i),{code:r9.invalid_string,validation:{startsWith:l.value},message:l.message}),o.dirty()):"endsWith"===l.kind?e.data.endsWith(l.value)||(ar(i=this._getOrReturnCtx(e,i),{code:r9.invalid_string,validation:{endsWith:l.value},message:l.message}),o.dirty()):"datetime"===l.kind?(function(e){let t=`${aA}T${aN(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)})(l).test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{code:r9.invalid_string,validation:"datetime",message:l.message}),o.dirty()):"date"===l.kind?aR.test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{code:r9.invalid_string,validation:"date",message:l.message}),o.dirty()):"time"===l.kind?RegExp(`^${aN(l)}$`).test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{code:r9.invalid_string,validation:"time",message:l.message}),o.dirty()):"duration"===l.kind?ab.test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{validation:"duration",code:r9.invalid_string,message:l.message}),o.dirty()):"ip"===l.kind?(t=e.data,("v4"===(r=l.version)||!r)&&ak.test(t)||("v6"===r||!r)&&aT.test(t)||(ar(i=this._getOrReturnCtx(e,i),{validation:"ip",code:r9.invalid_string,message:l.message}),o.dirty())):"jwt"===l.kind?!function(e,t){if(!aw.test(e))return!1;try{let[r]=e.split("."),a=r.replace(/-/g,"+").replace(/_/g,"/").padEnd(r.length+(4-r.length%4)%4,"="),s=JSON.parse(atob(a));if("object"!=typeof s||null===s||"typ"in s&&s?.typ!=="JWT"||!s.alg||t&&s.alg!==t)return!1;return!0}catch{return!1}}(e.data,l.alg)&&(ar(i=this._getOrReturnCtx(e,i),{validation:"jwt",code:r9.invalid_string,message:l.message}),o.dirty()):"cidr"===l.kind?(s=e.data,("v4"===(n=l.version)||!n)&&aS.test(s)||("v6"===n||!n)&&aE.test(s)||(ar(i=this._getOrReturnCtx(e,i),{validation:"cidr",code:r9.invalid_string,message:l.message}),o.dirty())):"base64"===l.kind?aI.test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{validation:"base64",code:r9.invalid_string,message:l.message}),o.dirty()):"base64url"===l.kind?aC.test(e.data)||(ar(i=this._getOrReturnCtx(e,i),{validation:"base64url",code:r9.invalid_string,message:l.message}),o.dirty()):x.assertNever(l);return{status:o.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:r9.invalid_string,...w.errToObj(r)})}_addCheck(e){return new aO({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...w.errToObj(e)})}url(e){return this._addCheck({kind:"url",...w.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...w.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...w.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...w.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...w.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...w.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...w.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...w.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...w.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...w.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...w.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...w.errToObj(e)})}datetime(e){return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===e?.precision?null:e?.precision,offset:e?.offset??!1,local:e?.local??!1,...w.errToObj(e?.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===e?.precision?null:e?.precision,...w.errToObj(e?.message)})}duration(e){return this._addCheck({kind:"duration",...w.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...w.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:t?.position,...w.errToObj(t?.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...w.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...w.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...w.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...w.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...w.errToObj(t)})}nonempty(e){return this.min(1,w.errToObj(e))}trim(){return new aO({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new aO({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new aO({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isCIDR(){return!!this._def.checks.find(e=>"cidr"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get isBase64url(){return!!this._def.checks.find(e=>"base64url"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}aO.create=e=>new aO({checks:[],typeName:b.ZodString,coerce:e?.coerce??!1,...ah(e)});class aP extends af{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==r5.number){let t=this._getOrReturnCtx(e);return ar(t,{code:r9.invalid_type,expected:r5.number,received:t.parsedType}),as}let r=new aa;for(let a of this._def.checks)"int"===a.kind?x.isInteger(e.data)||(ar(t=this._getOrReturnCtx(e,t),{code:r9.invalid_type,expected:"integer",received:"float",message:a.message}),r.dirty()):"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(ar(t=this._getOrReturnCtx(e,t),{code:r9.too_small,minimum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(ar(t=this._getOrReturnCtx(e,t),{code:r9.too_big,maximum:a.value,type:"number",inclusive:a.inclusive,exact:!1,message:a.message}),r.dirty()):"multipleOf"===a.kind?0!==function(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,s=r>a?r:a;return Number.parseInt(e.toFixed(s).replace(".",""))%Number.parseInt(t.toFixed(s).replace(".",""))/10**s}(e.data,a.value)&&(ar(t=this._getOrReturnCtx(e,t),{code:r9.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):"finite"===a.kind?Number.isFinite(e.data)||(ar(t=this._getOrReturnCtx(e,t),{code:r9.not_finite,message:a.message}),r.dirty()):x.assertNever(a);return{status:r.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,w.toString(t))}gt(e,t){return this.setLimit("min",e,!1,w.toString(t))}lte(e,t){return this.setLimit("max",e,!0,w.toString(t))}lt(e,t){return this.setLimit("max",e,!1,w.toString(t))}setLimit(e,t,r,a){return new aP({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:w.toString(a)}]})}_addCheck(e){return new aP({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:w.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:w.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:w.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:w.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:w.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:w.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:w.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:w.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:w.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&x.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}}aP.create=e=>new aP({checks:[],typeName:b.ZodNumber,coerce:e?.coerce||!1,...ah(e)});class aU extends af{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==r5.bigint)return this._getInvalidInput(e);let r=new aa;for(let a of this._def.checks)"min"===a.kind?(a.inclusive?e.data<a.value:e.data<=a.value)&&(ar(t=this._getOrReturnCtx(e,t),{code:r9.too_small,type:"bigint",minimum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"max"===a.kind?(a.inclusive?e.data>a.value:e.data>=a.value)&&(ar(t=this._getOrReturnCtx(e,t),{code:r9.too_big,type:"bigint",maximum:a.value,inclusive:a.inclusive,message:a.message}),r.dirty()):"multipleOf"===a.kind?e.data%a.value!==BigInt(0)&&(ar(t=this._getOrReturnCtx(e,t),{code:r9.not_multiple_of,multipleOf:a.value,message:a.message}),r.dirty()):x.assertNever(a);return{status:r.value,value:e.data}}_getInvalidInput(e){let t=this._getOrReturnCtx(e);return ar(t,{code:r9.invalid_type,expected:r5.bigint,received:t.parsedType}),as}gte(e,t){return this.setLimit("min",e,!0,w.toString(t))}gt(e,t){return this.setLimit("min",e,!1,w.toString(t))}lte(e,t){return this.setLimit("max",e,!0,w.toString(t))}lt(e,t){return this.setLimit("max",e,!1,w.toString(t))}setLimit(e,t,r,a){return new aU({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:w.toString(a)}]})}_addCheck(e){return new aU({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:w.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:w.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:w.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:w.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:w.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}}aU.create=e=>new aU({checks:[],typeName:b.ZodBigInt,coerce:e?.coerce??!1,...ah(e)});class a$ extends af{_parse(e){if(this._def.coerce&&(e.data=!!e.data),this._getType(e)!==r5.boolean){let t=this._getOrReturnCtx(e);return ar(t,{code:r9.invalid_type,expected:r5.boolean,received:t.parsedType}),as}return ai(e.data)}}a$.create=e=>new a$({typeName:b.ZodBoolean,coerce:e?.coerce||!1,...ah(e)});class aj extends af{_parse(e){let t;if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==r5.date){let t=this._getOrReturnCtx(e);return ar(t,{code:r9.invalid_type,expected:r5.date,received:t.parsedType}),as}if(Number.isNaN(e.data.getTime()))return ar(this._getOrReturnCtx(e),{code:r9.invalid_date}),as;let r=new aa;for(let a of this._def.checks)"min"===a.kind?e.data.getTime()<a.value&&(ar(t=this._getOrReturnCtx(e,t),{code:r9.too_small,message:a.message,inclusive:!0,exact:!1,minimum:a.value,type:"date"}),r.dirty()):"max"===a.kind?e.data.getTime()>a.value&&(ar(t=this._getOrReturnCtx(e,t),{code:r9.too_big,message:a.message,inclusive:!0,exact:!1,maximum:a.value,type:"date"}),r.dirty()):x.assertNever(a);return{status:r.value,value:new Date(e.data.getTime())}}_addCheck(e){return new aj({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:w.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:w.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}}aj.create=e=>new aj({checks:[],coerce:e?.coerce||!1,typeName:b.ZodDate,...ah(e)});class aM extends af{_parse(e){if(this._getType(e)!==r5.symbol){let t=this._getOrReturnCtx(e);return ar(t,{code:r9.invalid_type,expected:r5.symbol,received:t.parsedType}),as}return ai(e.data)}}aM.create=e=>new aM({typeName:b.ZodSymbol,...ah(e)});class aB extends af{_parse(e){if(this._getType(e)!==r5.undefined){let t=this._getOrReturnCtx(e);return ar(t,{code:r9.invalid_type,expected:r5.undefined,received:t.parsedType}),as}return ai(e.data)}}aB.create=e=>new aB({typeName:b.ZodUndefined,...ah(e)});class aF extends af{_parse(e){if(this._getType(e)!==r5.null){let t=this._getOrReturnCtx(e);return ar(t,{code:r9.invalid_type,expected:r5.null,received:t.parsedType}),as}return ai(e.data)}}aF.create=e=>new aF({typeName:b.ZodNull,...ah(e)});class aq extends af{constructor(){super(...arguments),this._any=!0}_parse(e){return ai(e.data)}}aq.create=e=>new aq({typeName:b.ZodAny,...ah(e)});class aD extends af{constructor(){super(...arguments),this._unknown=!0}_parse(e){return ai(e.data)}}aD.create=e=>new aD({typeName:b.ZodUnknown,...ah(e)});class aL extends af{_parse(e){let t=this._getOrReturnCtx(e);return ar(t,{code:r9.invalid_type,expected:r5.never,received:t.parsedType}),as}}aL.create=e=>new aL({typeName:b.ZodNever,...ah(e)});class aH extends af{_parse(e){if(this._getType(e)!==r5.undefined){let t=this._getOrReturnCtx(e);return ar(t,{code:r9.invalid_type,expected:r5.void,received:t.parsedType}),as}return ai(e.data)}}aH.create=e=>new aH({typeName:b.ZodVoid,...ah(e)});class aW extends af{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==r5.array)return ar(t,{code:r9.invalid_type,expected:r5.array,received:t.parsedType}),as;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,s=t.data.length<a.exactLength.value;(e||s)&&(ar(t,{code:e?r9.too_big:r9.too_small,minimum:s?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(ar(t,{code:r9.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(ar(t,{code:r9.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new ad(t,e,t.path,r)))).then(e=>aa.mergeArray(r,e));let s=[...t.data].map((e,r)=>a.type._parseSync(new ad(t,e,t.path,r)));return aa.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new aW({...this._def,minLength:{value:e,message:w.toString(t)}})}max(e,t){return new aW({...this._def,maxLength:{value:e,message:w.toString(t)}})}length(e,t){return new aW({...this._def,exactLength:{value:e,message:w.toString(t)}})}nonempty(e){return this.min(1,e)}}aW.create=(e,t)=>new aW({type:e,minLength:null,maxLength:null,exactLength:null,typeName:b.ZodArray,...ah(t)});class az extends af{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=x.objectKeys(e);return this._cached={shape:e,keys:t},this._cached}_parse(e){if(this._getType(e)!==r5.object){let t=this._getOrReturnCtx(e);return ar(t,{code:r9.invalid_type,expected:r5.object,received:t.parsedType}),as}let{status:t,ctx:r}=this._processInputParams(e),{shape:a,keys:s}=this._getCached(),n=[];if(!(this._def.catchall instanceof aL&&"strip"===this._def.unknownKeys))for(let e in r.data)s.includes(e)||n.push(e);let i=[];for(let e of s){let t=a[e],s=r.data[e];i.push({key:{status:"valid",value:e},value:t._parse(new ad(r,s,r.path,e)),alwaysSet:e in r.data})}if(this._def.catchall instanceof aL){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of n)i.push({key:{status:"valid",value:e},value:{status:"valid",value:r.data[e]}});else if("strict"===e)n.length>0&&(ar(r,{code:r9.unrecognized_keys,keys:n}),t.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of n){let a=r.data[t];i.push({key:{status:"valid",value:t},value:e._parse(new ad(r,a,r.path,t)),alwaysSet:t in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of i){let r=await t.key,a=await t.value;e.push({key:r,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>aa.mergeObjectSync(t,e)):aa.mergeObjectSync(t,i)}get shape(){return this._def.shape()}strict(e){return w.errToObj,new az({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{let a=this._def.errorMap?.(t,r).message??r.defaultError;return"unrecognized_keys"===t.code?{message:w.errToObj(e).message??a}:{message:a}}}:{}})}strip(){return new az({...this._def,unknownKeys:"strip"})}passthrough(){return new az({...this._def,unknownKeys:"passthrough"})}extend(e){return new az({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new az({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:b.ZodObject})}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new az({...this._def,catchall:e})}pick(e){let t={};for(let r of x.objectKeys(e))e[r]&&this.shape[r]&&(t[r]=this.shape[r]);return new az({...this._def,shape:()=>t})}omit(e){let t={};for(let r of x.objectKeys(this.shape))e[r]||(t[r]=this.shape[r]);return new az({...this._def,shape:()=>t})}deepPartial(){return function e(t){if(t instanceof az){let r={};for(let a in t.shape){let s=t.shape[a];r[a]=a9.create(e(s))}return new az({...t._def,shape:()=>r})}return t instanceof aW?new aW({...t._def,type:e(t.element)}):t instanceof a9?a9.create(e(t.unwrap())):t instanceof a7?a7.create(e(t.unwrap())):t instanceof aG?aG.create(t.items.map(t=>e(t))):t}(this)}partial(e){let t={};for(let r of x.objectKeys(this.shape)){let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}return new az({...this._def,shape:()=>t})}required(e){let t={};for(let r of x.objectKeys(this.shape))if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r];for(;e instanceof a9;)e=e._def.innerType;t[r]=e}return new az({...this._def,shape:()=>t})}keyof(){return a4(x.objectKeys(this.shape))}}az.create=(e,t)=>new az({shape:()=>e,unknownKeys:"strip",catchall:aL.create(),typeName:b.ZodObject,...ah(t)}),az.strictCreate=(e,t)=>new az({shape:()=>e,unknownKeys:"strict",catchall:aL.create(),typeName:b.ZodObject,...ah(t)}),az.lazycreate=(e,t)=>new az({shape:e,unknownKeys:"strip",catchall:aL.create(),typeName:b.ZodObject,...ah(t)});class aJ extends af{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(function(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new r7(e.ctx.common.issues));return ar(t,{code:r9.invalid_union,unionErrors:r}),as});{let e;let a=[];for(let s of r){let r={...t,common:{...t.common,issues:[]},parent:null},n=s._parseSync({data:t.data,path:t.path,parent:r});if("valid"===n.status)return n;"dirty"!==n.status||e||(e={result:n,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let s=a.map(e=>new r7(e));return ar(t,{code:r9.invalid_union,unionErrors:s}),as}}get options(){return this._def.options}}aJ.create=(e,t)=>new aJ({options:e,typeName:b.ZodUnion,...ah(t)});let aZ=e=>{if(e instanceof a1)return aZ(e.schema);if(e instanceof a3)return aZ(e.innerType());if(e instanceof a2)return[e.value];if(e instanceof a8)return e.options;if(e instanceof a6)return x.objectValues(e.enum);if(e instanceof se)return aZ(e._def.innerType);if(e instanceof aB)return[void 0];else if(e instanceof aF)return[null];else if(e instanceof a9)return[void 0,...aZ(e.unwrap())];else if(e instanceof a7)return[null,...aZ(e.unwrap())];else if(e instanceof sa)return aZ(e.unwrap());else if(e instanceof sn)return aZ(e.unwrap());else if(e instanceof st)return aZ(e._def.innerType);else return[]};class aK extends af{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==r5.object)return ar(t,{code:r9.invalid_type,expected:r5.object,received:t.parsedType}),as;let r=this.discriminator,a=t.data[r],s=this.optionsMap.get(a);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(ar(t,{code:r9.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),as)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let r of t){let t=aZ(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let s of t){if(a.has(s))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(s)}`);a.set(s,r)}}return new aK({typeName:b.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...ah(r)})}}class aV extends af{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=(e,a)=>{if(ao(e)||ao(a))return as;let s=function e(t,r){let a=r3(t),s=r3(r);if(t===r)return{valid:!0,data:t};if(a===r5.object&&s===r5.object){let a=x.objectKeys(r),s=x.objectKeys(t).filter(e=>-1!==a.indexOf(e)),n={...t,...r};for(let a of s){let s=e(t[a],r[a]);if(!s.valid)return{valid:!1};n[a]=s.data}return{valid:!0,data:n}}if(a===r5.array&&s===r5.array){if(t.length!==r.length)return{valid:!1};let a=[];for(let s=0;s<t.length;s++){let n=e(t[s],r[s]);if(!n.valid)return{valid:!1};a.push(n.data)}return{valid:!0,data:a}}return a===r5.date&&s===r5.date&&+t==+r?{valid:!0,data:t}:{valid:!1}}(e.value,a.value);return s.valid?((al(e)||al(a))&&t.dirty(),{status:t.value,value:s.data}):(ar(r,{code:r9.invalid_intersection_types}),as)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>a(e,t)):a(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}}aV.create=(e,t,r)=>new aV({left:e,right:t,typeName:b.ZodIntersection,...ah(r)});class aG extends af{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==r5.array)return ar(r,{code:r9.invalid_type,expected:r5.array,received:r.parsedType}),as;if(r.data.length<this._def.items.length)return ar(r,{code:r9.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),as;!this._def.rest&&r.data.length>this._def.items.length&&(ar(r,{code:r9.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let a=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new ad(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(a).then(e=>aa.mergeArray(t,e)):aa.mergeArray(t,a)}get items(){return this._def.items}rest(e){return new aG({...this._def,rest:e})}}aG.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new aG({items:e,typeName:b.ZodTuple,rest:null,...ah(t)})};class aQ extends af{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==r5.object)return ar(r,{code:r9.invalid_type,expected:r5.object,received:r.parsedType}),as;let a=[],s=this._def.keyType,n=this._def.valueType;for(let e in r.data)a.push({key:s._parse(new ad(r,e,r.path,e)),value:n._parse(new ad(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?aa.mergeObjectAsync(t,a):aa.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new aQ(t instanceof af?{keyType:e,valueType:t,typeName:b.ZodRecord,...ah(r)}:{keyType:aO.create(),valueType:e,typeName:b.ZodRecord,...ah(t)})}}class aY extends af{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==r5.map)return ar(r,{code:r9.invalid_type,expected:r5.map,received:r.parsedType}),as;let a=this._def.keyType,s=this._def.valueType,n=[...r.data.entries()].map(([e,t],n)=>({key:a._parse(new ad(r,e,r.path,[n,"key"])),value:s._parse(new ad(r,t,r.path,[n,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of n){let a=await r.key,s=await r.value;if("aborted"===a.status||"aborted"===s.status)return as;("dirty"===a.status||"dirty"===s.status)&&t.dirty(),e.set(a.value,s.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of n){let a=r.key,s=r.value;if("aborted"===a.status||"aborted"===s.status)return as;("dirty"===a.status||"dirty"===s.status)&&t.dirty(),e.set(a.value,s.value)}return{status:t.value,value:e}}}}aY.create=(e,t,r)=>new aY({valueType:t,keyType:e,typeName:b.ZodMap,...ah(r)});class aX extends af{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==r5.set)return ar(r,{code:r9.invalid_type,expected:r5.set,received:r.parsedType}),as;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(ar(r,{code:r9.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(ar(r,{code:r9.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let s=this._def.valueType;function n(e){let r=new Set;for(let a of e){if("aborted"===a.status)return as;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let i=[...r.data.values()].map((e,t)=>s._parse(new ad(r,e,r.path,t)));return r.common.async?Promise.all(i).then(e=>n(e)):n(i)}min(e,t){return new aX({...this._def,minSize:{value:e,message:w.toString(t)}})}max(e,t){return new aX({...this._def,maxSize:{value:e,message:w.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}}aX.create=(e,t)=>new aX({valueType:e,minSize:null,maxSize:null,typeName:b.ZodSet,...ah(t)});class a0 extends af{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==r5.function)return ar(t,{code:r9.invalid_type,expected:r5.function,received:t.parsedType}),as;function r(e,r){return at({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ae,ae].filter(e=>!!e),issueData:{code:r9.invalid_arguments,argumentsError:r}})}function a(e,r){return at({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,ae,ae].filter(e=>!!e),issueData:{code:r9.invalid_return_type,returnTypeError:r}})}let s={errorMap:t.common.contextualErrorMap},n=t.data;if(this._def.returns instanceof a5){let e=this;return ai(async function(...t){let i=new r7([]),o=await e._def.args.parseAsync(t,s).catch(e=>{throw i.addIssue(r(t,e)),i}),l=await Reflect.apply(n,this,o);return await e._def.returns._def.type.parseAsync(l,s).catch(e=>{throw i.addIssue(a(l,e)),i})})}{let e=this;return ai(function(...t){let i=e._def.args.safeParse(t,s);if(!i.success)throw new r7([r(t,i.error)]);let o=Reflect.apply(n,this,i.data),l=e._def.returns.safeParse(o,s);if(!l.success)throw new r7([a(o,l.error)]);return l.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new a0({...this._def,args:aG.create(e).rest(aD.create())})}returns(e){return new a0({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,t,r){return new a0({args:e||aG.create([]).rest(aD.create()),returns:t||aD.create(),typeName:b.ZodFunction,...ah(r)})}}class a1 extends af{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e);return this._def.getter()._parse({data:t.data,path:t.path,parent:t})}}a1.create=(e,t)=>new a1({getter:e,typeName:b.ZodLazy,...ah(t)});class a2 extends af{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return ar(t,{received:t.data,code:r9.invalid_literal,expected:this._def.value}),as}return{status:"valid",value:e.data}}get value(){return this._def.value}}function a4(e,t){return new a8({values:e,typeName:b.ZodEnum,...ah(t)})}a2.create=(e,t)=>new a2({value:e,typeName:b.ZodLiteral,...ah(t)});class a8 extends af{_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return ar(t,{expected:x.joinValues(r),received:t.parsedType,code:r9.invalid_type}),as}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return ar(t,{received:t.data,code:r9.invalid_enum_value,options:r}),as}return ai(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return a8.create(e,{...this._def,...t})}exclude(e,t=this._def){return a8.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}}a8.create=a4;class a6 extends af{_parse(e){let t=x.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==r5.string&&r.parsedType!==r5.number){let e=x.objectValues(t);return ar(r,{expected:x.joinValues(e),received:r.parsedType,code:r9.invalid_type}),as}if(this._cache||(this._cache=new Set(x.getValidEnumValues(this._def.values))),!this._cache.has(e.data)){let e=x.objectValues(t);return ar(r,{received:r.data,code:r9.invalid_enum_value,options:e}),as}return ai(e.data)}get enum(){return this._def.values}}a6.create=(e,t)=>new a6({values:e,typeName:b.ZodNativeEnum,...ah(t)});class a5 extends af{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);return t.parsedType!==r5.promise&&!1===t.common.async?(ar(t,{code:r9.invalid_type,expected:r5.promise,received:t.parsedType}),as):ai((t.parsedType===r5.promise?t.data:Promise.resolve(t.data)).then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}}a5.create=(e,t)=>new a5({type:e,typeName:b.ZodPromise,...ah(t)});class a3 extends af{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===b.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,s={addIssue:e=>{ar(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(s.addIssue=s.addIssue.bind(s),"preprocess"===a.type){let e=a.transform(r.data,s);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return as;let a=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===a.status?as:"dirty"===a.status||"dirty"===t.value?an(a.value):a});{if("aborted"===t.value)return as;let a=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===a.status?as:"dirty"===a.status||"dirty"===t.value?an(a.value):a}}if("refinement"===a.type){let e=e=>{let t=a.refinement(e,s);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(r=>"aborted"===r.status?as:("dirty"===r.status&&t.dirty(),e(r.value).then(()=>({status:t.value,value:r.value}))));{let a=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===a.status?as:("dirty"===a.status&&t.dirty(),e(a.value),{status:t.value,value:a.value})}}if("transform"===a.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>au(e)?Promise.resolve(a.transform(e.value,s)).then(e=>({status:t.value,value:e})):as);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!au(e))return as;let n=a.transform(e.value,s);if(n instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:n}}}x.assertNever(a)}}a3.create=(e,t,r)=>new a3({schema:e,typeName:b.ZodEffects,effect:t,...ah(r)}),a3.createWithPreprocess=(e,t,r)=>new a3({schema:t,effect:{type:"preprocess",transform:e},typeName:b.ZodEffects,...ah(r)});class a9 extends af{_parse(e){return this._getType(e)===r5.undefined?ai(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}a9.create=(e,t)=>new a9({innerType:e,typeName:b.ZodOptional,...ah(t)});class a7 extends af{_parse(e){return this._getType(e)===r5.null?ai(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}}a7.create=(e,t)=>new a7({innerType:e,typeName:b.ZodNullable,...ah(t)});class se extends af{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===r5.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}}se.create=(e,t)=>new se({innerType:e,typeName:b.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...ah(t)});class st extends af{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return ac(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new r7(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new r7(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}}st.create=(e,t)=>new st({innerType:e,typeName:b.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...ah(t)});class sr extends af{_parse(e){if(this._getType(e)!==r5.nan){let t=this._getOrReturnCtx(e);return ar(t,{code:r9.invalid_type,expected:r5.nan,received:t.parsedType}),as}return{status:"valid",value:e.data}}}sr.create=e=>new sr({typeName:b.ZodNaN,...ah(e)}),Symbol("zod_brand");class sa extends af{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}}class ss extends af{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?as:"dirty"===e.status?(t.dirty(),an(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})})();{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?as:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ss({in:e,out:t,typeName:b.ZodPipeline})}}class sn extends af{_parse(e){let t=this._def.innerType._parse(e),r=e=>(au(e)&&(e.value=Object.freeze(e.value)),e);return ac(t)?t.then(e=>r(e)):r(t)}unwrap(){return this._def.innerType}}function si(e,t){let r="function"==typeof e?e(t):"string"==typeof e?{message:e}:e;return"string"==typeof r?{message:r}:r}function so(e,t={},r){return e?aq.create().superRefine((a,s)=>{let n=e(a);if(n instanceof Promise)return n.then(e=>{if(!e){let e=si(t,a),n=e.fatal??r??!0;s.addIssue({code:"custom",...e,fatal:n})}});if(!n){let e=si(t,a),n=e.fatal??r??!0;s.addIssue({code:"custom",...e,fatal:n})}}):aq.create()}sn.create=(e,t)=>new sn({innerType:e,typeName:b.ZodReadonly,...ah(t)}),az.lazycreate,function(e){e.ZodString="ZodString",e.ZodNumber="ZodNumber",e.ZodNaN="ZodNaN",e.ZodBigInt="ZodBigInt",e.ZodBoolean="ZodBoolean",e.ZodDate="ZodDate",e.ZodSymbol="ZodSymbol",e.ZodUndefined="ZodUndefined",e.ZodNull="ZodNull",e.ZodAny="ZodAny",e.ZodUnknown="ZodUnknown",e.ZodNever="ZodNever",e.ZodVoid="ZodVoid",e.ZodArray="ZodArray",e.ZodObject="ZodObject",e.ZodUnion="ZodUnion",e.ZodDiscriminatedUnion="ZodDiscriminatedUnion",e.ZodIntersection="ZodIntersection",e.ZodTuple="ZodTuple",e.ZodRecord="ZodRecord",e.ZodMap="ZodMap",e.ZodSet="ZodSet",e.ZodFunction="ZodFunction",e.ZodLazy="ZodLazy",e.ZodLiteral="ZodLiteral",e.ZodEnum="ZodEnum",e.ZodEffects="ZodEffects",e.ZodNativeEnum="ZodNativeEnum",e.ZodOptional="ZodOptional",e.ZodNullable="ZodNullable",e.ZodDefault="ZodDefault",e.ZodCatch="ZodCatch",e.ZodPromise="ZodPromise",e.ZodBranded="ZodBranded",e.ZodPipeline="ZodPipeline",e.ZodReadonly="ZodReadonly"}(b||(b={}));let sl=(e,t={message:`Input not instance of ${e.name}`})=>so(t=>t instanceof e,t),su=aO.create,sc=aP.create;sr.create,aU.create;let sd=a$.create;aj.create,aM.create,aB.create;let sp=aF.create,sh=aq.create,sf=aD.create;aL.create,aH.create;let sm=aW.create,sy=az.create;az.strictCreate;let sg=aJ.create,sx=aK.create;aV.create,aG.create;let sv=aQ.create;aY.create,aX.create,a0.create;let sw=a1.create,sb=a2.create,s_=a8.create;a6.create,a5.create,a3.create;let sk=a9.create;a7.create,a3.createWithPreprocess,ss.create;let sS=Symbol("Let zodToJsonSchema decide on which parser to use"),sT={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},sE=e=>"string"==typeof e?{...sT,name:e}:{...sT,...e},sI=e=>{let t=sE(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};function sC(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function sA(e,t,r,a,s){e[t]=r,sC(e,t,a,s)}function sR(e,t){return sK(e.type._def,t)}let sN=(e,t)=>sK(e.innerType._def,t),sO=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let a of e.checks)switch(a.kind){case"min":sA(r,"minimum",a.value,a.message,t);break;case"max":sA(r,"maximum",a.value,a.message,t)}return r},sP=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e,sU={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(void 0===s&&(s=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),s),ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function s$(e,t){let r={type:"string"};if(e.checks)for(let a of e.checks)switch(a.kind){case"min":sA(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":sA(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":sB(r,"email",a.message,t);break;case"format:idn-email":sB(r,"idn-email",a.message,t);break;case"pattern:zod":sF(r,sU.email,a.message,t)}break;case"url":sB(r,"uri",a.message,t);break;case"uuid":sB(r,"uuid",a.message,t);break;case"regex":sF(r,a.regex,a.message,t);break;case"cuid":sF(r,sU.cuid,a.message,t);break;case"cuid2":sF(r,sU.cuid2,a.message,t);break;case"startsWith":sF(r,RegExp(`^${sj(a.value,t)}`),a.message,t);break;case"endsWith":sF(r,RegExp(`${sj(a.value,t)}$`),a.message,t);break;case"datetime":sB(r,"date-time",a.message,t);break;case"date":sB(r,"date",a.message,t);break;case"time":sB(r,"time",a.message,t);break;case"duration":sB(r,"duration",a.message,t);break;case"length":sA(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t),sA(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":sF(r,RegExp(sj(a.value,t)),a.message,t);break;case"ip":"v6"!==a.version&&sB(r,"ipv4",a.message,t),"v4"!==a.version&&sB(r,"ipv6",a.message,t);break;case"base64url":sF(r,sU.base64url,a.message,t);break;case"jwt":sF(r,sU.jwt,a.message,t);break;case"cidr":"v6"!==a.version&&sF(r,sU.ipv4Cidr,a.message,t),"v4"!==a.version&&sF(r,sU.ipv6Cidr,a.message,t);break;case"emoji":sF(r,sU.emoji(),a.message,t);break;case"ulid":sF(r,sU.ulid,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":sB(r,"binary",a.message,t);break;case"contentEncoding:base64":sA(r,"contentEncoding","base64",a.message,t);break;case"pattern:zod":sF(r,sU.base64,a.message,t)}break;case"nanoid":sF(r,sU.nanoid,a.message,t)}return r}function sj(e,t){return"escape"===t.patternStrategy?function(e){let t="";for(let r=0;r<e.length;r++)sM.has(e[r])||(t+="\\"),t+=e[r];return t}(e):e}let sM=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function sB(e,t,r,a){e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):sA(e,"format",t,r,a)}function sF(e,t,r,a){e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:sq(t,a),...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):sA(e,"pattern",sq(t,a),r,a)}function sq(e,t){if(!t.applyRegexFlags||!e.flags)return e.source;let r={i:e.flags.includes("i"),m:e.flags.includes("m"),s:e.flags.includes("s")},a=r.i?e.source.toLowerCase():e.source,s="",n=!1,i=!1,o=!1;for(let e=0;e<a.length;e++){if(n){s+=a[e],n=!1;continue}if(r.i){if(i){if(a[e].match(/[a-z]/)){o?(s+=a[e],s+=`${a[e-2]}-${a[e]}`.toUpperCase(),o=!1):"-"===a[e+1]&&a[e+2]?.match(/[a-z]/)?(s+=a[e],o=!0):s+=`${a[e]}${a[e].toUpperCase()}`;continue}}else if(a[e].match(/[a-z]/)){s+=`[${a[e]}${a[e].toUpperCase()}]`;continue}}if(r.m){if("^"===a[e]){s+=`(^|(?<=[\r
]))`;continue}if("$"===a[e]){s+=`($|(?=[\r
]))`;continue}}if(r.s&&"."===a[e]){s+=i?`${a[e]}\r
`:`[${a[e]}\r
]`;continue}s+=a[e],"\\"===a[e]?n=!0:i&&"]"===a[e]?i=!1:i||"["!==a[e]||(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${t.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),e.source}return s}function sD(e,t){if("openAi"===t.target&&console.warn("Warning: OpenAI may not support records in schemas! Try an array of key-value pairs instead."),"openApi3"===t.target&&e.keyType?._def.typeName===b.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>({...r,[a]:sK(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??{}}),{}),additionalProperties:t.rejectedAdditionalProperties};let r={type:"object",additionalProperties:sK(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??t.allowedAdditionalProperties};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===b.ZodString&&e.keyType._def.checks?.length){let{type:a,...s}=s$(e.keyType._def,t);return{...r,propertyNames:s}}if(e.keyType?._def.typeName===b.ZodEnum)return{...r,propertyNames:{enum:e.keyType._def.values}};if(e.keyType?._def.typeName===b.ZodBranded&&e.keyType._def.type._def.typeName===b.ZodString&&e.keyType._def.type._def.checks?.length){let{type:a,...s}=sR(e.keyType._def,t);return{...r,propertyNames:s}}return r}let sL={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"},sH=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>sK(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0},sW=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return sK(e.innerType._def,t);let r=sK(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},sz=(e,t)=>{if("input"===t.pipeStrategy)return sK(e.in._def,t);if("output"===t.pipeStrategy)return sK(e.out._def,t);let r=sK(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=sK(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(e=>void 0!==e)}},sJ=(e,t)=>sK(e.innerType._def,t),sZ=(e,t,r)=>{switch(t){case b.ZodString:return s$(e,r);case b.ZodNumber:return function(e,t){let r={type:"number"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"int":r.type="integer",sC(r,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?sA(r,"minimum",a.value,a.message,t):sA(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),sA(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?sA(r,"maximum",a.value,a.message,t):sA(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),sA(r,"maximum",a.value,a.message,t));break;case"multipleOf":sA(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case b.ZodObject:return function(e,t){let r="openAi"===t.target,a={type:"object",properties:{}},s=[],n=e.shape();for(let e in n){let i=n[e];if(void 0===i||void 0===i._def)continue;let o=function(e){try{return e.isOptional()}catch{return!0}}(i);o&&r&&(i instanceof a9&&(i=i._def.innerType),i.isNullable()||(i=i.nullable()),o=!1);let l=sK(i._def,{...t,currentPath:[...t.currentPath,"properties",e],propertyPath:[...t.currentPath,"properties",e]});void 0!==l&&(a.properties[e]=l,o||s.push(e))}s.length&&(a.required=s);let i=function(e,t){if("ZodNever"!==e.catchall._def.typeName)return sK(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]});switch(e.unknownKeys){case"passthrough":return t.allowedAdditionalProperties;case"strict":return t.rejectedAdditionalProperties;case"strip":return"strict"===t.removeAdditionalStrategy?t.allowedAdditionalProperties:t.rejectedAdditionalProperties}}(e,t);return void 0!==i&&(a.additionalProperties=i),a}(e,r);case b.ZodBigInt:return function(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?sA(r,"minimum",a.value,a.message,t):sA(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),sA(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?sA(r,"maximum",a.value,a.message,t):sA(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),sA(r,"maximum",a.value,a.message,t));break;case"multipleOf":sA(r,"multipleOf",a.value,a.message,t)}return r}(e,r);case b.ZodBoolean:return{type:"boolean"};case b.ZodDate:return function e(t,r,a){let s=a??r.dateStrategy;if(Array.isArray(s))return{anyOf:s.map((a,s)=>e(t,r,a))};switch(s){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return sO(t,r)}}(e,r);case b.ZodUndefined:return{not:{}};case b.ZodNull:return"openApi3"===r.target?{enum:["null"],nullable:!0}:{type:"null"};case b.ZodArray:return function(e,t){let r={type:"array"};return e.type?._def&&e.type?._def?.typeName!==b.ZodAny&&(r.items=sK(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&sA(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&sA(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(sA(r,"minItems",e.exactLength.value,e.exactLength.message,t),sA(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}(e,r);case b.ZodUnion:case b.ZodDiscriminatedUnion:return function(e,t){if("openApi3"===t.target)return sH(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in sL&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=sL[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return sH(e,t)}(e,r);case b.ZodIntersection:return function(e,t){let r=[sK(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),sK(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),a="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,s=[];return r.forEach(e=>{if(sP(e))s.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...a}=e;t=a}else a=void 0;s.push(t)}}),s.length?{allOf:s,...a}:void 0}(e,r);case b.ZodTuple:return function(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>sK(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:sK(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>sK(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}(e,r);case b.ZodRecord:return sD(e,r);case b.ZodLiteral:return function(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}(e,r);case b.ZodEnum:return{type:"string",enum:Array.from(e.values)};case b.ZodNativeEnum:return function(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]).map(e=>t[e]),a=Array.from(new Set(r.map(e=>typeof e)));return{type:1===a.length?"string"===a[0]?"string":"number":["string","number"],enum:r}}(e);case b.ZodNullable:return function(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:sL[e.innerType._def.typeName],nullable:!0}:{type:[sL[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=sK(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=sK(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}(e,r);case b.ZodOptional:return sW(e,r);case b.ZodMap:return function(e,t){return"record"===t.mapStrategy?sD(e,t):{type:"array",maxItems:125,items:{type:"array",items:[sK(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},sK(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{}],minItems:2,maxItems:2}}}(e,r);case b.ZodSet:return function(e,t){let r={type:"array",uniqueItems:!0,items:sK(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]})};return e.minSize&&sA(r,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&sA(r,"maxItems",e.maxSize.value,e.maxSize.message,t),r}(e,r);case b.ZodLazy:return()=>e.getter()._def;case b.ZodPromise:return sK(e.type._def,r);case b.ZodNaN:case b.ZodNever:return{not:{}};case b.ZodEffects:return function(e,t){return"input"===t.effectStrategy?sK(e.schema._def,t):{}}(e,r);case b.ZodAny:case b.ZodUnknown:return{};case b.ZodDefault:return function(e,t){return{...sK(e.innerType._def,t),default:e.defaultValue()}}(e,r);case b.ZodBranded:return sR(e,r);case b.ZodReadonly:return sJ(e,r);case b.ZodCatch:return sN(e,r);case b.ZodPipeline:return sz(e,r);case b.ZodFunction:case b.ZodVoid:case b.ZodSymbol:default:return}};function sK(e,t,r=!1){let a=t.seen.get(e);if(t.override){let s=t.override?.(e,t,a,r);if(s!==sS)return s}if(a&&!r){let e=sV(a,t);if(void 0!==e)return e}let s={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,s);let n=sZ(e,e.typeName,t),i="function"==typeof n?sK(n(),t):n;if(i&&sQ(e,t,i),t.postProcess){let r=t.postProcess(i,e,t);return s.jsonSchema=i,r}return s.jsonSchema=i,i}let sV=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:sG(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},sG=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},sQ=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),sY=(e,t)=>{let r=sI(t),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,a])=>({...e,[t]:sK(a._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}}),{}):void 0,s="string"==typeof t?t:t?.nameStrategy==="title"?void 0:t?.name,n=sK(e._def,void 0===s?r:{...r,currentPath:[...r.basePath,r.definitionPath,s]},!1)??{},i="object"==typeof t&&void 0!==t.name&&"title"===t.nameStrategy?t.name:void 0;void 0!==i&&(n.title=i);let o=void 0===s?a?{...n,[r.definitionPath]:a}:n:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,s].join("/"),[r.definitionPath]:{...a,[s]:n}};return"jsonSchema7"===r.target?o.$schema="http://json-schema.org/draft-07/schema#":("jsonSchema2019-09"===r.target||"openAi"===r.target)&&(o.$schema="https://json-schema.org/draft/2019-09/schema#"),"openAi"===r.target&&("anyOf"in o||"oneOf"in o||"allOf"in o||"type"in o&&Array.isArray(o.type))&&console.warn("Warning: OpenAI may not support schemas with unions as roots! Try wrapping it in an object property."),o};var sX={code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},s0={code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},s1={code:"4",name:"assistant_message",parse:e=>{if(null==e||"object"!=typeof e||!("id"in e)||!("role"in e)||!("content"in e)||"string"!=typeof e.id||"string"!=typeof e.role||"assistant"!==e.role||!Array.isArray(e.content)||!e.content.every(e=>null!=e&&"object"==typeof e&&"type"in e&&"text"===e.type&&"text"in e&&null!=e.text&&"object"==typeof e.text&&"value"in e.text&&"string"==typeof e.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:e}}},s2={code:"5",name:"assistant_control_data",parse:e=>{if(null==e||"object"!=typeof e||!("threadId"in e)||!("messageId"in e)||"string"!=typeof e.threadId||"string"!=typeof e.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:e.threadId,messageId:e.messageId}}}},s4={code:"6",name:"data_message",parse:e=>{if(null==e||"object"!=typeof e||!("role"in e)||!("data"in e)||"string"!=typeof e.role||"data"!==e.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:e}}},s8=[sX,s0,s1,s2,s4];sX.code,s0.code,s1.code,s2.code,s4.code,sX.name,sX.code,s0.name,s0.code,s1.name,s1.code,s2.name,s2.code,s4.name,s4.code,s8.map(e=>e.code);var s6=[{code:"0",name:"text",parse:e=>{if("string"!=typeof e)throw Error('"text" parts expect a string value.');return{type:"text",value:e}}},{code:"2",name:"data",parse:e=>{if(!Array.isArray(e))throw Error('"data" parts expect an array value.');return{type:"data",value:e}}},{code:"3",name:"error",parse:e=>{if("string"!=typeof e)throw Error('"error" parts expect a string value.');return{type:"error",value:e}}},{code:"8",name:"message_annotations",parse:e=>{if(!Array.isArray(e))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:e}}},{code:"9",name:"tool_call",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName||!("args"in e)||"object"!=typeof e.args)throw Error('"tool_call" parts expect an object with a "toolCallId", "toolName", and "args" property.');return{type:"tool_call",value:e}}},{code:"a",name:"tool_result",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("result"in e))throw Error('"tool_result" parts expect an object with a "toolCallId" and a "result" property.');return{type:"tool_result",value:e}}},{code:"b",name:"tool_call_streaming_start",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("toolName"in e)||"string"!=typeof e.toolName)throw Error('"tool_call_streaming_start" parts expect an object with a "toolCallId" and "toolName" property.');return{type:"tool_call_streaming_start",value:e}}},{code:"c",name:"tool_call_delta",parse:e=>{if(null==e||"object"!=typeof e||!("toolCallId"in e)||"string"!=typeof e.toolCallId||!("argsTextDelta"in e)||"string"!=typeof e.argsTextDelta)throw Error('"tool_call_delta" parts expect an object with a "toolCallId" and "argsTextDelta" property.');return{type:"tool_call_delta",value:e}}},{code:"d",name:"finish_message",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_message" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),{type:"finish_message",value:t}}},{code:"e",name:"finish_step",parse:e=>{if(null==e||"object"!=typeof e||!("finishReason"in e)||"string"!=typeof e.finishReason)throw Error('"finish_step" parts expect an object with a "finishReason" property.');let t={finishReason:e.finishReason,isContinued:!1};return"usage"in e&&null!=e.usage&&"object"==typeof e.usage&&"promptTokens"in e.usage&&"completionTokens"in e.usage&&(t.usage={promptTokens:"number"==typeof e.usage.promptTokens?e.usage.promptTokens:Number.NaN,completionTokens:"number"==typeof e.usage.completionTokens?e.usage.completionTokens:Number.NaN}),"isContinued"in e&&"boolean"==typeof e.isContinued&&(t.isContinued=e.isContinued),{type:"finish_step",value:t}}},{code:"f",name:"start_step",parse:e=>{if(null==e||"object"!=typeof e||!("messageId"in e)||"string"!=typeof e.messageId)throw Error('"start_step" parts expect an object with an "id" property.');return{type:"start_step",value:{messageId:e.messageId}}}},{code:"g",name:"reasoning",parse:e=>{if("string"!=typeof e)throw Error('"reasoning" parts expect a string value.');return{type:"reasoning",value:e}}},{code:"h",name:"source",parse:e=>{if(null==e||"object"!=typeof e)throw Error('"source" parts expect a Source object.');return{type:"source",value:e}}},{code:"i",name:"redacted_reasoning",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data)throw Error('"redacted_reasoning" parts expect an object with a "data" property.');return{type:"redacted_reasoning",value:{data:e.data}}}},{code:"j",name:"reasoning_signature",parse:e=>{if(null==e||"object"!=typeof e||!("signature"in e)||"string"!=typeof e.signature)throw Error('"reasoning_signature" parts expect an object with a "signature" property.');return{type:"reasoning_signature",value:{signature:e.signature}}}},{code:"k",name:"file",parse:e=>{if(null==e||"object"!=typeof e||!("data"in e)||"string"!=typeof e.data||!("mimeType"in e)||"string"!=typeof e.mimeType)throw Error('"file" parts expect an object with a "data" and "mimeType" property.');return{type:"file",value:e}}}],s5=Object.fromEntries(s6.map(e=>[e.code,e]));Object.fromEntries(s6.map(e=>[e.name,e.code]));var s3=s6.map(e=>e.code),s9=e=>{let t=e.indexOf(":");if(-1===t)throw Error("Failed to parse stream string. No separator found.");let r=e.slice(0,t);if(!s3.includes(r))throw Error(`Failed to parse stream string. Invalid code ${r}.`);let a=JSON.parse(e.slice(t+1));return s5[r].parse(a)};function s7(e,t){let r=s6.find(t=>t.name===e);if(!r)throw Error(`Invalid stream part type: ${e}`);return`${r.code}:${JSON.stringify(t)}
`}var ne=Symbol.for("vercel.ai.schema");function nt(e){return"object"==typeof e&&null!==e&&ne in e&&!0===e[ne]&&"jsonSchema"in e&&"validate"in e?e:function(e,{validate:t}={}){return{[ne]:!0,_type:void 0,[rL]:!0,jsonSchema:e,validate:t}}(sY(e,{$refStrategy:"none",target:"jsonSchema7"}),{validate:t=>{let r=e.safeParse(t);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}var nr=Object.defineProperty,na=(e,t)=>{for(var r in t)nr(e,r,{get:t[r],enumerable:!0})};function ns(e,{contentType:t,dataStreamVersion:r}){let a=new Headers(null!=e?e:{});return a.has("Content-Type")||a.set("Content-Type",t),void 0!==r&&a.set("X-Vercel-AI-Data-Stream",r),a}var nn="AI_InvalidArgumentError",ni=`vercel.ai.error.${nn}`,no=Symbol.for(ni),nl=class extends tQ{constructor({parameter:e,value:t,message:r}){super({name:nn,message:`Invalid argument for parameter ${e}: ${r}`}),this[_]=!0,this.parameter=e,this.value=t}static isInstance(e){return tQ.hasMarker(e,ni)}};_=no;var nu="AI_RetryError",nc=`vercel.ai.error.${nu}`,nd=Symbol.for(nc),np=class extends tQ{constructor({message:e,reason:t,errors:r}){super({name:nu,message:e}),this[k]=!0,this.reason=t,this.errors=r,this.lastError=r[r.length-1]}static isInstance(e){return tQ.hasMarker(e,nc)}};k=nd;var nh=({maxRetries:e=2,initialDelayInMs:t=2e3,backoffFactor:r=2}={})=>async a=>nf(a,{maxRetries:e,delayInMs:t,backoffFactor:r});async function nf(e,{maxRetries:t,delayInMs:r,backoffFactor:a},s=[]){try{return await e()}catch(l){if(rD(l)||0===t)throw l;let n=null==l?"unknown error":"string"==typeof l?l:l instanceof Error?l.message:JSON.stringify(l),i=[...s,l],o=i.length;if(o>t)throw new np({message:`Failed after ${o} attempts. Last error: ${n}`,reason:"maxRetriesExceeded",errors:i});if(l instanceof Error&&t1.isInstance(l)&&!0===l.isRetryable&&o<=t)return await rM(r),nf(e,{maxRetries:t,delayInMs:a*r,backoffFactor:a},i);if(1===o)throw l;throw new np({message:`Failed after ${o} attempts with non-retryable error: '${n}'`,reason:"errorNotRetryable",errors:i})}}function nm({operationId:e,telemetry:t}){return{"operation.name":`${e}${(null==t?void 0:t.functionId)!=null?` ${t.functionId}`:""}`,"resource.name":null==t?void 0:t.functionId,"ai.operationId":e,"ai.telemetry.functionId":null==t?void 0:t.functionId}}var ny={startSpan:()=>ng,startActiveSpan:(e,t,r,a)=>"function"==typeof t?t(ng):"function"==typeof r?r(ng):"function"==typeof a?a(ng):void 0},ng={spanContext:()=>nx,setAttribute(){return this},setAttributes(){return this},addEvent(){return this},addLink(){return this},addLinks(){return this},setStatus(){return this},updateName(){return this},end(){return this},isRecording:()=>!1,recordException(){return this}},nx={traceId:"",spanId:"",traceFlags:0};function nv({name:e,tracer:t,attributes:r,fn:a,endWhenDone:s=!0}){return t.startActiveSpan(e,{attributes:r},async e=>{try{let t=await a(e);return s&&e.end(),t}catch(t){try{t instanceof Error?(e.recordException({name:t.name,message:t.message,stack:t.stack}),e.setStatus({code:r6.s.ERROR,message:t.message})):e.setStatus({code:r6.s.ERROR})}finally{e.end()}throw t}})}function nw({telemetry:e,attributes:t}){return(null==e?void 0:e.isEnabled)!==!0?{}:Object.entries(t).reduce((t,[r,a])=>{if(void 0===a)return t;if("object"==typeof a&&"input"in a&&"function"==typeof a.input){if((null==e?void 0:e.recordInputs)===!1)return t;let s=a.input();return void 0===s?t:{...t,[r]:s}}if("object"==typeof a&&"output"in a&&"function"==typeof a.output){if((null==e?void 0:e.recordOutputs)===!1)return t;let s=a.output();return void 0===s?t:{...t,[r]:s}}return{...t,[r]:a}},{})}Symbol.for("vercel.ai.error.AI_NoImageGeneratedError");var nb=class{constructor({data:e,mimeType:t}){let r=e instanceof Uint8Array;this.base64Data=r?void 0:e,this.uint8ArrayData=r?e:void 0,this.mimeType=t}get base64(){return null==this.base64Data&&(this.base64Data=r4(this.uint8ArrayData)),this.base64Data}get uint8Array(){return null==this.uint8ArrayData&&(this.uint8ArrayData=r2(this.base64Data)),this.uint8ArrayData}},n_=[{mimeType:"image/gif",bytesPrefix:[71,73,70],base64Prefix:"R0lG"},{mimeType:"image/png",bytesPrefix:[137,80,78,71],base64Prefix:"iVBORw"},{mimeType:"image/jpeg",bytesPrefix:[255,216],base64Prefix:"/9j/"},{mimeType:"image/webp",bytesPrefix:[82,73,70,70],base64Prefix:"UklGRg"},{mimeType:"image/bmp",bytesPrefix:[66,77],base64Prefix:"Qk"},{mimeType:"image/tiff",bytesPrefix:[73,73,42,0],base64Prefix:"SUkqAA"},{mimeType:"image/tiff",bytesPrefix:[77,77,0,42],base64Prefix:"TU0AKg"},{mimeType:"image/avif",bytesPrefix:[0,0,0,32,102,116,121,112,97,118,105,102],base64Prefix:"AAAAIGZ0eXBhdmlm"},{mimeType:"image/heic",bytesPrefix:[0,0,0,32,102,116,121,112,104,101,105,99],base64Prefix:"AAAAIGZ0eXBoZWlj"}],nk=e=>{let t="string"==typeof e?r2(e):e,r=(127&t[6])<<21|(127&t[7])<<14|(127&t[8])<<7|127&t[9];return t.slice(r+10)},nS="AI_NoObjectGeneratedError",nT=`vercel.ai.error.${nS}`,nE=Symbol.for(nT),nI=class extends tQ{constructor({message:e="No object generated.",cause:t,text:r,response:a,usage:s,finishReason:n}){super({name:nS,message:e,cause:t}),this[T]=!0,this.text=r,this.response=a,this.usage=s,this.finishReason=n}static isInstance(e){return tQ.hasMarker(e,nT)}};T=nE;var nC="AI_DownloadError",nA=`vercel.ai.error.${nC}`,nR=Symbol.for(nA),nN=class extends tQ{constructor({url:e,statusCode:t,statusText:r,cause:a,message:s=null==a?`Failed to download ${e}: ${t} ${r}`:`Failed to download ${e}: ${a}`}){super({name:nC,message:s,cause:a}),this[E]=!0,this.url=e,this.statusCode=t,this.statusText=r}static isInstance(e){return tQ.hasMarker(e,nA)}};async function nO({url:e}){var t;let r=e.toString();try{let e=await fetch(r);if(!e.ok)throw new nN({url:r,statusCode:e.status,statusText:e.statusText});return{data:new Uint8Array(await e.arrayBuffer()),mimeType:null!=(t=e.headers.get("content-type"))?t:void 0}}catch(e){if(nN.isInstance(e))throw e;throw new nN({url:r,cause:e})}}E=nR;var nP="AI_InvalidDataContentError",nU=`vercel.ai.error.${nP}`,n$=Symbol.for(nU),nj=class extends tQ{constructor({content:e,cause:t,message:r=`Invalid data content. Expected a base64 string, Uint8Array, ArrayBuffer, or Buffer, but got ${typeof e}.`}){super({name:nP,message:r,cause:t}),this[I]=!0,this.content=e}static isInstance(e){return tQ.hasMarker(e,nU)}};I=n$;var nM=sg([su(),sl(Uint8Array),sl(ArrayBuffer),so(e=>{var t,r;return null!=(r=null==(t=globalThis.Buffer)?void 0:t.isBuffer(e))&&r},{message:"Must be a Buffer"})]);function nB(e){return"string"==typeof e?e:e instanceof ArrayBuffer?r4(new Uint8Array(e)):r4(e)}function nF(e){if(e instanceof Uint8Array)return e;if("string"==typeof e)try{return r2(e)}catch(t){throw new nj({message:"Invalid data content. Content string is not a base64-encoded media.",content:e,cause:t})}if(e instanceof ArrayBuffer)return new Uint8Array(e);throw new nj({content:e})}var nq="AI_InvalidMessageRoleError",nD=`vercel.ai.error.${nq}`,nL=Symbol.for(nD),nH=class extends tQ{constructor({role:e,message:t=`Invalid message role: '${e}'. Must be one of: "system", "user", "assistant", "tool".`}){super({name:nq,message:t}),this[C]=!0,this.role=e}static isInstance(e){return tQ.hasMarker(e,nD)}};async function nW({prompt:e,modelSupportsImageUrls:t=!0,modelSupportsUrl:r=()=>!1,downloadImplementation:a=nO}){let s=await nz(e.messages,a,t,r);return[...null!=e.system?[{role:"system",content:e.system}]:[],...e.messages.map(e=>(function(e,t){var r,a,s,n,i,o;let l=e.role;switch(l){case"system":return{role:"system",content:e.content,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};case"user":if("string"==typeof e.content)return{role:"user",content:[{type:"text",text:e.content}],providerMetadata:null!=(a=e.providerOptions)?a:e.experimental_providerMetadata};return{role:"user",content:e.content.map(e=>(function(e,t){var r,a,s,n;let i,o,l;if("text"===e.type)return{type:"text",text:e.text,providerMetadata:null!=(r=e.providerOptions)?r:e.experimental_providerMetadata};let u=e.mimeType,c=e.type;switch(c){case"image":i=e.image;break;case"file":i=e.data;break;default:throw Error(`Unsupported part type: ${c}`)}try{o="string"==typeof i?new URL(i):i}catch(e){o=i}if(o instanceof URL){if("data:"===o.protocol){let{mimeType:e,base64Content:t}=function(e){try{let[t,r]=e.split(",");return{mimeType:t.split(";")[0].split(":")[1],base64Content:r}}catch(e){return{mimeType:void 0,base64Content:void 0}}}(o.toString());if(null==e||null==t)throw Error(`Invalid data URL format in part ${c}`);u=e,l=nF(t)}else{let e=t[o.toString()];e?(l=e.data,null!=u||(u=e.mimeType)):l=o}}else l=nF(o);switch(c){case"image":return l instanceof Uint8Array&&(u=null!=(a=function({data:e,signatures:t}){let r="string"==typeof e&&e.startsWith("SUQz")||"string"!=typeof e&&e.length>10&&73===e[0]&&68===e[1]&&51===e[2]?nk(e):e;for(let e of t)if("string"==typeof r?r.startsWith(e.base64Prefix):r.length>=e.bytesPrefix.length&&e.bytesPrefix.every((e,t)=>r[t]===e))return e.mimeType}({data:l,signatures:n_}))?a:u),{type:"image",image:l,mimeType:u,providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata};case"file":if(null==u)throw Error("Mime type is missing for file part");return{type:"file",data:l instanceof Uint8Array?nB(l):l,filename:e.filename,mimeType:u,providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata}}})(e,t)).filter(e=>"text"!==e.type||""!==e.text),providerMetadata:null!=(s=e.providerOptions)?s:e.experimental_providerMetadata};case"assistant":if("string"==typeof e.content)return{role:"assistant",content:[{type:"text",text:e.content}],providerMetadata:null!=(n=e.providerOptions)?n:e.experimental_providerMetadata};return{role:"assistant",content:e.content.filter(e=>"text"!==e.type||""!==e.text).map(e=>{var t;let r=null!=(t=e.providerOptions)?t:e.experimental_providerMetadata;switch(e.type){case"file":return{type:"file",data:e.data instanceof URL?e.data:nB(e.data),filename:e.filename,mimeType:e.mimeType,providerMetadata:r};case"reasoning":return{type:"reasoning",text:e.text,signature:e.signature,providerMetadata:r};case"redacted-reasoning":return{type:"redacted-reasoning",data:e.data,providerMetadata:r};case"text":return{type:"text",text:e.text,providerMetadata:r};case"tool-call":return{type:"tool-call",toolCallId:e.toolCallId,toolName:e.toolName,args:e.args,providerMetadata:r}}}),providerMetadata:null!=(i=e.providerOptions)?i:e.experimental_providerMetadata};case"tool":return{role:"tool",content:e.content.map(e=>{var t;return{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result,content:e.experimental_content,isError:e.isError,providerMetadata:null!=(t=e.providerOptions)?t:e.experimental_providerMetadata}}),providerMetadata:null!=(o=e.providerOptions)?o:e.experimental_providerMetadata};default:throw new nH({role:l})}})(e,s))]}async function nz(e,t,r,a){let s=e.filter(e=>"user"===e.role).map(e=>e.content).filter(e=>Array.isArray(e)).flat().filter(e=>"image"===e.type||"file"===e.type).filter(e=>!("image"===e.type&&!0===r)).map(e=>"image"===e.type?e.image:e.data).map(e=>"string"==typeof e&&(e.startsWith("http:")||e.startsWith("https:"))?new URL(e):e).filter(e=>e instanceof URL).filter(e=>!a(e));return Object.fromEntries((await Promise.all(s.map(async e=>({url:e,data:await t({url:e})})))).map(({url:e,data:t})=>[e.toString(),t]))}function nJ(e){var t,r,a;let s=[];for(let n of e){let e;try{e=new URL(n.url)}catch(e){throw Error(`Invalid URL: ${n.url}`)}switch(e.protocol){case"http:":case"https:":if(null==(t=n.contentType)?void 0:t.startsWith("image/"))s.push({type:"image",image:e});else{if(!n.contentType)throw Error("If the attachment is not an image, it must specify a content type");s.push({type:"file",data:e,mimeType:n.contentType})}break;case"data:":{let e,t,i;try{[e,t]=n.url.split(","),i=e.split(";")[0].split(":")[1]}catch(e){throw Error(`Error processing data URL: ${n.url}`)}if(null==i||null==t)throw Error(`Invalid data URL format: ${n.url}`);if(null==(r=n.contentType)?void 0:r.startsWith("image/"))s.push({type:"image",image:nF(t)});else if(null==(a=n.contentType)?void 0:a.startsWith("text/"))s.push({type:"text",text:function(e){try{return new TextDecoder().decode(e)}catch(e){throw Error("Error decoding Uint8Array to text")}}(nF(t))});else{if(!n.contentType)throw Error("If the attachment is not an image or text, it must specify a content type");s.push({type:"file",data:t,mimeType:n.contentType})}break}default:throw Error(`Unsupported URL protocol: ${e.protocol}`)}}return s}C=nL;var nZ="AI_MessageConversionError",nK=`vercel.ai.error.${nZ}`,nV=Symbol.for(nK),nG=class extends tQ{constructor({originalMessage:e,message:t}){super({name:nZ,message:t}),this[A]=!0,this.originalMessage=e}static isInstance(e){return tQ.hasMarker(e,nK)}};A=nV;var nQ=sw(()=>sg([sp(),su(),sc(),sd(),sv(su(),nQ),sm(nQ)])),nY=sv(su(),sv(su(),nQ)),nX=sm(sg([sy({type:sb("text"),text:su()}),sy({type:sb("image"),data:su(),mimeType:su().optional()})])),n0=sy({type:sb("text"),text:su(),providerOptions:nY.optional(),experimental_providerMetadata:nY.optional()}),n1=sy({type:sb("image"),image:sg([nM,sl(URL)]),mimeType:su().optional(),providerOptions:nY.optional(),experimental_providerMetadata:nY.optional()}),n2=sy({type:sb("file"),data:sg([nM,sl(URL)]),filename:su().optional(),mimeType:su(),providerOptions:nY.optional(),experimental_providerMetadata:nY.optional()}),n4=sy({type:sb("reasoning"),text:su(),providerOptions:nY.optional(),experimental_providerMetadata:nY.optional()}),n8=sy({type:sb("redacted-reasoning"),data:su(),providerOptions:nY.optional(),experimental_providerMetadata:nY.optional()}),n6=sy({type:sb("tool-call"),toolCallId:su(),toolName:su(),args:sf(),providerOptions:nY.optional(),experimental_providerMetadata:nY.optional()}),n5=sy({type:sb("tool-result"),toolCallId:su(),toolName:su(),result:sf(),content:nX.optional(),isError:sd().optional(),providerOptions:nY.optional(),experimental_providerMetadata:nY.optional()}),n3=sy({role:sb("system"),content:su(),providerOptions:nY.optional(),experimental_providerMetadata:nY.optional()}),n9=sy({role:sb("user"),content:sg([su(),sm(sg([n0,n1,n2]))]),providerOptions:nY.optional(),experimental_providerMetadata:nY.optional()}),n7=sy({role:sb("assistant"),content:sg([su(),sm(sg([n0,n2,n4,n8,n6]))]),providerOptions:nY.optional(),experimental_providerMetadata:nY.optional()}),ie=sg([n3,n9,n7,sy({role:sb("tool"),content:sm(n5),providerOptions:nY.optional(),experimental_providerMetadata:nY.optional()})]);function it(e){return"object"==typeof e&&null!==e&&("function"===e.role||"data"===e.role||"toolInvocations"in e||"parts"in e||"experimental_attachments"in e)?"has-ui-specific-parts":"object"==typeof e&&null!==e&&"content"in e&&(Array.isArray(e.content)||"experimental_providerMetadata"in e||"providerOptions"in e)?"has-core-specific-parts":"object"==typeof e&&null!==e&&"role"in e&&"content"in e&&"string"==typeof e.content&&["system","user","assistant","tool"].includes(e.role)?"message":"other"}function ir(e){return"image"===e.type?{...e,image:e.image instanceof Uint8Array?nB(e.image):e.image}:e}rF({prefix:"aiobj",size:24});function ia(){let e,t;return{promise:new Promise((r,a)=>{e=r,t=a}),resolve:e,reject:t}}rF({prefix:"aiobj",size:24});var is="AI_NoOutputSpecifiedError",ii=`vercel.ai.error.${is}`,io=Symbol.for(ii),il=class extends tQ{constructor({message:e="No output specified."}={}){super({name:is,message:e}),this[R]=!0}static isInstance(e){return tQ.hasMarker(e,ii)}};R=io;var iu="AI_ToolExecutionError",ic=`vercel.ai.error.${iu}`,id=Symbol.for(ic),ip=class extends tQ{constructor({toolArgs:e,toolName:t,toolCallId:r,cause:a,message:s=`Error executing tool ${t}: ${t5(a)}`}){super({name:iu,message:s,cause:a}),this[N]=!0,this.toolArgs=e,this.toolName=t,this.toolCallId=r}static isInstance(e){return tQ.hasMarker(e,ic)}};N=id;var ih=/^([\s\S]*?)(\s+)(\S*)$/,im="AI_InvalidToolArgumentsError",iy=`vercel.ai.error.${im}`,ig=Symbol.for(iy),ix=class extends tQ{constructor({toolArgs:e,toolName:t,cause:r,message:a=`Invalid arguments for tool ${t}: ${t5(r)}`}){super({name:im,message:a,cause:r}),this[O]=!0,this.toolArgs=e,this.toolName=t}static isInstance(e){return tQ.hasMarker(e,iy)}};O=ig;var iv="AI_NoSuchToolError",iw=`vercel.ai.error.${iv}`,ib=Symbol.for(iw),i_=class extends tQ{constructor({toolName:e,availableTools:t,message:r=`Model tried to call unavailable tool '${e}'. ${void 0===t?"No tools are available.":`Available tools: ${t.join(", ")}.`}`}){super({name:iv,message:r}),this[P]=!0,this.toolName=e,this.availableTools=t}static isInstance(e){return tQ.hasMarker(e,iw)}};P=ib;var ik="AI_ToolCallRepairError",iS=`vercel.ai.error.${ik}`,iT=Symbol.for(iS),iE=class extends tQ{constructor({cause:e,originalError:t,message:r=`Error repairing tool call: ${t5(e)}`}){super({name:ik,message:r,cause:e}),this[U]=!0,this.originalError=t}static isInstance(e){return tQ.hasMarker(e,iS)}};async function iI({toolCall:e,tools:t,repairToolCall:r,system:a,messages:s}){if(null==t)throw new i_({toolName:e.toolName});try{return await iC({toolCall:e,tools:t})}catch(i){if(null==r||!(i_.isInstance(i)||ix.isInstance(i)))throw i;let n=null;try{n=await r({toolCall:e,tools:t,parameterSchema:({toolName:e})=>nt(t[e].parameters).jsonSchema,system:a,messages:s,error:i})}catch(e){throw new iE({cause:e,originalError:i})}if(null==n)throw i;return await iC({toolCall:n,tools:t})}}async function iC({toolCall:e,tools:t}){let r=e.toolName,a=t[r];if(null==a)throw new i_({toolName:e.toolName,availableTools:Object.keys(t)});let s=nt(a.parameters),n=""===e.args.trim()?rH({value:{},schema:s}):rW({text:e.args,schema:s});if(!1===n.success)throw new ix({toolName:r,toolArgs:e.args,cause:n.error});return{type:"tool-call",toolCallId:e.toolCallId,toolName:r,args:n.value}}function iA(e){let t=e.filter(e=>"text"===e.type).map(e=>e.text).join("");return t.length>0?t:void 0}U=iT;var iR=rF({prefix:"aitxt",size:24}),iN=rF({prefix:"msg",size:24});async function iO({model:e,tools:t,toolChoice:r,system:a,prompt:s,messages:n,maxRetries:i,abortSignal:o,headers:l,maxSteps:u=1,experimental_generateMessageId:c=iN,experimental_output:d,experimental_continueSteps:p=!1,experimental_telemetry:h,experimental_providerMetadata:f,providerOptions:m=f,experimental_activeTools:y,experimental_prepareStep:g,experimental_repairToolCall:x,_internal:{generateId:v=iR,currentDate:w=()=>new Date}={},onStepFinish:b,..._}){var k;if(u<1)throw new nl({parameter:"maxSteps",value:u,message:"maxSteps must be at least 1"});let{maxRetries:S,retry:T}=function({maxRetries:e}){if(null!=e){if(!Number.isInteger(e))throw new nl({parameter:"maxRetries",value:e,message:"maxRetries must be an integer"});if(e<0)throw new nl({parameter:"maxRetries",value:e,message:"maxRetries must be >= 0"})}let t=null!=e?e:2;return{maxRetries:t,retry:nh({maxRetries:t})}}({maxRetries:i}),E=function({model:e,settings:t,telemetry:r,headers:a}){var s;return{"ai.model.provider":e.provider,"ai.model.id":e.modelId,...Object.entries(t).reduce((e,[t,r])=>(e[`ai.settings.${t}`]=r,e),{}),...Object.entries(null!=(s=null==r?void 0:r.metadata)?s:{}).reduce((e,[t,r])=>(e[`ai.telemetry.metadata.${t}`]=r,e),{}),...Object.entries(null!=a?a:{}).reduce((e,[t,r])=>(void 0!==r&&(e[`ai.request.headers.${t}`]=r),e),{})}}({model:e,telemetry:h,headers:l,settings:{..._,maxRetries:S}}),I=function({prompt:e,tools:t}){if(null==e.prompt&&null==e.messages)throw new rs({prompt:e,message:"prompt or messages must be defined"});if(null!=e.prompt&&null!=e.messages)throw new rs({prompt:e,message:"prompt and messages cannot be defined at the same time"});if(null!=e.system&&"string"!=typeof e.system)throw new rs({prompt:e,message:"system must be a string"});if(null!=e.prompt){if("string"!=typeof e.prompt)throw new rs({prompt:e,message:"prompt must be a string"});return{type:"prompt",system:e.system,messages:[{role:"user",content:e.prompt}]}}if(null!=e.messages){let r="ui-messages"===function(e){if(!Array.isArray(e))throw new rs({prompt:e,message:`messages must be an array of CoreMessage or UIMessage
Received non-array value: ${JSON.stringify(e)}`,cause:e});if(0===e.length)return"messages";let t=e.map(it);if(t.some(e=>"has-ui-specific-parts"===e))return"ui-messages";let r=t.findIndex(e=>"has-core-specific-parts"!==e&&"message"!==e);if(-1===r)return"messages";throw new rs({prompt:e,message:`messages must be an array of CoreMessage or UIMessage
Received message of type: "${t[r]}" at index ${r}
messages[${r}]: ${JSON.stringify(e[r])}`,cause:e})}(e.messages)?function(e,t){var r,a;let s=null!=(r=null==t?void 0:t.tools)?r:{},n=[];for(let t=0;t<e.length;t++){let r=e[t],i=t===e.length-1,{role:o,content:l,experimental_attachments:u}=r;switch(o){case"system":n.push({role:"system",content:l});break;case"user":if(null==r.parts)n.push({role:"user",content:u?[{type:"text",text:l},...nJ(u)]:l});else{let e=r.parts.filter(e=>"text"===e.type).map(e=>({type:"text",text:e.text}));n.push({role:"user",content:u?[...e,...nJ(u)]:e})}break;case"assistant":{if(null!=r.parts){let e=function(){let e=[];for(let t of o)switch(t.type){case"file":case"text":e.push(t);break;case"reasoning":for(let r of t.details)switch(r.type){case"text":e.push({type:"reasoning",text:r.text,signature:r.signature});break;case"redacted":e.push({type:"redacted-reasoning",data:r.data})}break;case"tool-invocation":e.push({type:"tool-call",toolCallId:t.toolInvocation.toolCallId,toolName:t.toolInvocation.toolName,args:t.toolInvocation.args});break;default:throw Error(`Unsupported part: ${t}`)}n.push({role:"assistant",content:e});let a=o.filter(e=>"tool-invocation"===e.type).map(e=>e.toolInvocation);a.length>0&&n.push({role:"tool",content:a.map(e=>{if(!("result"in e))throw new nG({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:a,result:n}=e,i=s[a];return(null==i?void 0:i.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:a,result:i.experimental_toToolResultContent(n),experimental_content:i.experimental_toToolResultContent(n)}:{type:"tool-result",toolCallId:t,toolName:a,result:n}})}),o=[],i=!1,t++},t=0,i=!1,o=[];for(let s of r.parts)switch(s.type){case"text":i&&e(),o.push(s);break;case"file":case"reasoning":o.push(s);break;case"tool-invocation":(null!=(a=s.toolInvocation.step)?a:0)!==t&&e(),o.push(s),i=!0}e();break}let e=r.toolInvocations;if(null==e||0===e.length){n.push({role:"assistant",content:l});break}let t=e.reduce((e,t)=>{var r;return Math.max(e,null!=(r=t.step)?r:0)},0);for(let a=0;a<=t;a++){let t=e.filter(e=>{var t;return(null!=(t=e.step)?t:0)===a});0!==t.length&&(n.push({role:"assistant",content:[...i&&l&&0===a?[{type:"text",text:l}]:[],...t.map(({toolCallId:e,toolName:t,args:r})=>({type:"tool-call",toolCallId:e,toolName:t,args:r}))]}),n.push({role:"tool",content:t.map(e=>{if(!("result"in e))throw new nG({originalMessage:r,message:"ToolInvocation must have a result: "+JSON.stringify(e)});let{toolCallId:t,toolName:a,result:n}=e,i=s[a];return(null==i?void 0:i.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:t,toolName:a,result:i.experimental_toToolResultContent(n),experimental_content:i.experimental_toToolResultContent(n)}:{type:"tool-result",toolCallId:t,toolName:a,result:n}})}))}l&&!i&&n.push({role:"assistant",content:l});break}case"data":break;default:throw new nG({originalMessage:r,message:`Unsupported role: ${o}`})}}return n}(e.messages,{tools:t}):e.messages;if(0===r.length)throw new rs({prompt:e,message:"messages must not be empty"});let a=rH({value:r,schema:sm(ie)});if(!a.success)throw new rs({prompt:e,message:`message must be a CoreMessage or a UI message
Validation error: ${a.error.message}`,cause:a.error});return{type:"messages",messages:r,system:e.system}}throw Error("unreachable")}({prompt:{system:null!=(k=null==d?void 0:d.injectIntoSystemPrompt({system:a,model:e}))?k:a,prompt:s,messages:n},tools:t}),C=function({isEnabled:e=!1,tracer:t}={}){return e?t||r8.u.getTracer("ai"):ny}(h);return nv({name:"ai.generateText",attributes:nw({telemetry:h,attributes:{...nm({operationId:"ai.generateText",telemetry:h}),...E,"ai.model.provider":e.provider,"ai.model.id":e.modelId,"ai.prompt":{input:()=>JSON.stringify({system:a,prompt:s,messages:n})},"ai.settings.maxSteps":u}}),tracer:C,fn:async s=>{var n,i,f,k,S,A,R,N,O,P,U,$,j,M,B,F;let q;let D=function({maxTokens:e,temperature:t,topP:r,topK:a,presencePenalty:s,frequencyPenalty:n,stopSequences:i,seed:o}){if(null!=e){if(!Number.isInteger(e))throw new nl({parameter:"maxTokens",value:e,message:"maxTokens must be an integer"});if(e<1)throw new nl({parameter:"maxTokens",value:e,message:"maxTokens must be >= 1"})}if(null!=t&&"number"!=typeof t)throw new nl({parameter:"temperature",value:t,message:"temperature must be a number"});if(null!=r&&"number"!=typeof r)throw new nl({parameter:"topP",value:r,message:"topP must be a number"});if(null!=a&&"number"!=typeof a)throw new nl({parameter:"topK",value:a,message:"topK must be a number"});if(null!=s&&"number"!=typeof s)throw new nl({parameter:"presencePenalty",value:s,message:"presencePenalty must be a number"});if(null!=n&&"number"!=typeof n)throw new nl({parameter:"frequencyPenalty",value:n,message:"frequencyPenalty must be a number"});if(null!=o&&!Number.isInteger(o))throw new nl({parameter:"seed",value:o,message:"seed must be an integer"});return{maxTokens:e,temperature:null!=t?t:0,topP:r,topK:a,presencePenalty:s,frequencyPenalty:n,stopSequences:null!=i&&i.length>0?i:void 0,seed:o}}(_),L=[],H=[],W=[],z=0,J=[],Z="",K=[],V=[],G={completionTokens:0,promptTokens:0,totalTokens:0},Q="initial";do{let s=0===z?I.type:"messages",$=[...I.messages,...J],j=await (null==g?void 0:g({model:e,steps:V,maxSteps:u,stepNumber:z})),M=null!=(n=null==j?void 0:j.toolChoice)?n:r,Y=null!=(i=null==j?void 0:j.experimental_activeTools)?i:y,X=null!=(f=null==j?void 0:j.model)?f:e,ee=await nW({prompt:{type:s,system:I.system,messages:$},modelSupportsImageUrls:X.supportsImageUrls,modelSupportsUrl:null==(k=X.supportsUrl)?void 0:k.bind(X)}),et={type:"regular",...function({tools:e,toolChoice:t,activeTools:r}){return null!=e&&Object.keys(e).length>0?{tools:(null!=r?Object.entries(e).filter(([e])=>r.includes(e)):Object.entries(e)).map(([e,t])=>{let r=t.type;switch(r){case void 0:case"function":return{type:"function",name:e,description:t.description,parameters:nt(t.parameters).jsonSchema};case"provider-defined":return{type:"provider-defined",name:e,id:t.id,args:t.args};default:throw Error(`Unsupported tool type: ${r}`)}}),toolChoice:null==t?{type:"auto"}:"string"==typeof t?{type:t}:{type:"tool",toolName:t.toolName}}:{tools:void 0,toolChoice:void 0}}({tools:t,toolChoice:M,activeTools:Y})};q=await T(()=>nv({name:"ai.generateText.doGenerate",attributes:nw({telemetry:h,attributes:{...nm({operationId:"ai.generateText.doGenerate",telemetry:h}),...E,"ai.model.provider":X.provider,"ai.model.id":X.modelId,"ai.prompt.format":{input:()=>s},"ai.prompt.messages":{input:()=>JSON.stringify(ee.map(e=>({...e,content:"string"==typeof e.content?e.content:e.content.map(ir)})))},"ai.prompt.tools":{input:()=>{var e;return null==(e=et.tools)?void 0:e.map(e=>JSON.stringify(e))}},"ai.prompt.toolChoice":{input:()=>null!=et.toolChoice?JSON.stringify(et.toolChoice):void 0},"gen_ai.system":X.provider,"gen_ai.request.model":X.modelId,"gen_ai.request.frequency_penalty":_.frequencyPenalty,"gen_ai.request.max_tokens":_.maxTokens,"gen_ai.request.presence_penalty":_.presencePenalty,"gen_ai.request.stop_sequences":_.stopSequences,"gen_ai.request.temperature":_.temperature,"gen_ai.request.top_k":_.topK,"gen_ai.request.top_p":_.topP}}),tracer:C,fn:async t=>{var r,a,n,i,u,c;let p=await X.doGenerate({mode:et,...D,inputFormat:s,responseFormat:null==d?void 0:d.responseFormat({model:e}),prompt:ee,providerMetadata:m,abortSignal:o,headers:l}),f={id:null!=(a=null==(r=p.response)?void 0:r.id)?a:v(),timestamp:null!=(i=null==(n=p.response)?void 0:n.timestamp)?i:w(),modelId:null!=(c=null==(u=p.response)?void 0:u.modelId)?c:X.modelId};return t.setAttributes(nw({telemetry:h,attributes:{"ai.response.finishReason":p.finishReason,"ai.response.text":{output:()=>p.text},"ai.response.toolCalls":{output:()=>JSON.stringify(p.toolCalls)},"ai.response.id":f.id,"ai.response.model":f.modelId,"ai.response.timestamp":f.timestamp.toISOString(),"ai.usage.promptTokens":p.usage.promptTokens,"ai.usage.completionTokens":p.usage.completionTokens,"gen_ai.response.finish_reasons":[p.finishReason],"gen_ai.response.id":f.id,"gen_ai.response.model":f.modelId,"gen_ai.usage.input_tokens":p.usage.promptTokens,"gen_ai.usage.output_tokens":p.usage.completionTokens}})),{...p,response:f}}})),L=await Promise.all((null!=(S=q.toolCalls)?S:[]).map(e=>iI({toolCall:e,tools:t,repairToolCall:x,system:a,messages:$}))),H=null==t?[]:await iP({toolCalls:L,tools:t,tracer:C,telemetry:h,messages:$,abortSignal:o});let er=function({promptTokens:e,completionTokens:t}){return{promptTokens:e,completionTokens:t,totalTokens:e+t}}(q.usage);B=G,F=er,G={promptTokens:B.promptTokens+F.promptTokens,completionTokens:B.completionTokens+F.completionTokens,totalTokens:B.totalTokens+F.totalTokens};let ea="done";++z<u&&(p&&"length"===q.finishReason&&0===L.length?ea="continue":L.length>0&&H.length===L.length&&(ea="tool-result"));let es=null!=(A=q.text)?A:"",en="continue"===Q&&Z.trimEnd()!==Z?es.trimStart():es,ei="continue"===ea?function(e){let t=function(e){let t=e.match(ih);return t?{prefix:t[1],whitespace:t[2],suffix:t[3]}:void 0}(e);return t?t.prefix+t.whitespace:e}(en):en;if(Z="continue"===ea||"continue"===Q?Z+ei:ei,W=i$(q.reasoning),K.push(...null!=(R=q.sources)?R:[]),"continue"===Q){let e=J[J.length-1];"string"==typeof e.content?e.content+=ei:e.content.push({text:ei,type:"text"})}else J.push(...function({text:e="",files:t,reasoning:r,tools:a,toolCalls:s,toolResults:n,messageId:i,generateMessageId:o}){let l=[],u=[];return r.length>0&&u.push(...r.map(e=>"text"===e.type?{...e,type:"reasoning"}:{...e,type:"redacted-reasoning"})),t.length>0&&u.push(...t.map(e=>({type:"file",data:e.base64,mimeType:e.mimeType}))),e.length>0&&u.push({type:"text",text:e}),s.length>0&&u.push(...s),u.length>0&&l.push({role:"assistant",content:u,id:i}),n.length>0&&l.push({role:"tool",id:o(),content:n.map(e=>{let t=a[e.toolName];return(null==t?void 0:t.experimental_toToolResultContent)!=null?{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:t.experimental_toToolResultContent(e.result),experimental_content:t.experimental_toToolResultContent(e.result)}:{type:"tool-result",toolCallId:e.toolCallId,toolName:e.toolName,result:e.result}})}),l}({text:Z,files:ij(q.files),reasoning:i$(q.reasoning),tools:null!=t?t:{},toolCalls:L,toolResults:H,messageId:c(),generateMessageId:c}));let eo={stepType:Q,text:ei,reasoning:iA(W),reasoningDetails:W,files:ij(q.files),sources:null!=(N=q.sources)?N:[],toolCalls:L,toolResults:H,finishReason:q.finishReason,usage:er,warnings:q.warnings,logprobs:q.logprobs,request:null!=(O=q.request)?O:{},response:{...q.response,headers:null==(P=q.rawResponse)?void 0:P.headers,body:null==(U=q.rawResponse)?void 0:U.body,messages:structuredClone(J)},providerMetadata:q.providerMetadata,experimental_providerMetadata:q.providerMetadata,isContinued:"continue"===ea};V.push(eo),await (null==b?void 0:b(eo)),Q=ea}while("done"!==Q);return s.setAttributes(nw({telemetry:h,attributes:{"ai.response.finishReason":q.finishReason,"ai.response.text":{output:()=>q.text},"ai.response.toolCalls":{output:()=>JSON.stringify(q.toolCalls)},"ai.usage.promptTokens":q.usage.promptTokens,"ai.usage.completionTokens":q.usage.completionTokens}})),new iU({text:Z,files:ij(q.files),reasoning:iA(W),reasoningDetails:W,sources:K,outputResolver:()=>{if(null==d)throw new il;return d.parseOutput({text:Z},{response:q.response,usage:G,finishReason:q.finishReason})},toolCalls:L,toolResults:H,finishReason:q.finishReason,usage:G,warnings:q.warnings,request:null!=($=q.request)?$:{},response:{...q.response,headers:null==(j=q.rawResponse)?void 0:j.headers,body:null==(M=q.rawResponse)?void 0:M.body,messages:J},logprobs:q.logprobs,steps:V,providerMetadata:q.providerMetadata})}})}async function iP({toolCalls:e,tools:t,tracer:r,telemetry:a,messages:s,abortSignal:n}){return(await Promise.all(e.map(async({toolCallId:e,toolName:i,args:o})=>{let l=t[i];if((null==l?void 0:l.execute)==null)return;let u=await nv({name:"ai.toolCall",attributes:nw({telemetry:a,attributes:{...nm({operationId:"ai.toolCall",telemetry:a}),"ai.toolCall.name":i,"ai.toolCall.id":e,"ai.toolCall.args":{output:()=>JSON.stringify(o)}}}),tracer:r,fn:async t=>{try{let r=await l.execute(o,{toolCallId:e,messages:s,abortSignal:n});try{t.setAttributes(nw({telemetry:a,attributes:{"ai.toolCall.result":{output:()=>JSON.stringify(r)}}}))}catch(e){}return r}catch(t){throw new ip({toolCallId:e,toolName:i,toolArgs:o,cause:t})}}});return{type:"tool-result",toolCallId:e,toolName:i,args:o,result:u}}))).filter(e=>null!=e)}var iU=class{constructor(e){this.text=e.text,this.files=e.files,this.reasoning=e.reasoning,this.reasoningDetails=e.reasoningDetails,this.toolCalls=e.toolCalls,this.toolResults=e.toolResults,this.finishReason=e.finishReason,this.usage=e.usage,this.warnings=e.warnings,this.request=e.request,this.response=e.response,this.steps=e.steps,this.experimental_providerMetadata=e.providerMetadata,this.providerMetadata=e.providerMetadata,this.logprobs=e.logprobs,this.outputResolver=e.outputResolver,this.sources=e.sources}get experimental_output(){return this.outputResolver()}};function i$(e){return null==e?[]:"string"==typeof e?[{type:"text",text:e}]:e}function ij(e){var t;return null!=(t=null==e?void 0:e.map(e=>new nb(e)))?t:[]}na({},{object:()=>iH,text:()=>iL});var iM="AI_InvalidStreamPartError",iB=`vercel.ai.error.${iM}`;$=Symbol.for(iB);var iF="vercel.ai.error.AI_MCPClientError",iq=Symbol.for(iF),iD=class extends tQ{constructor({name:e="MCPClientError",message:t,cause:r}){super({name:e,message:t,cause:r}),this[j]=!0}static isInstance(e){return tQ.hasMarker(e,iF)}};j=iq;var iL=()=>({type:"text",responseFormat:()=>({type:"text"}),injectIntoSystemPrompt:({system:e})=>e,parsePartial:({text:e})=>({partial:e}),parseOutput:({text:e})=>e}),iH=({schema:e})=>{let t=nt(e);return{type:"object",responseFormat:({model:e})=>({type:"json",schema:e.supportsStructuredOutputs?t.jsonSchema:void 0}),injectIntoSystemPrompt:({system:e,model:r})=>r.supportsStructuredOutputs?e:function({prompt:e,schema:t,schemaPrefix:r=null!=t?"JSON schema:":void 0,schemaSuffix:a=null!=t?"You MUST answer with a JSON object that matches the JSON schema above.":"You MUST answer with JSON."}){return[null!=e&&e.length>0?e:void 0,null!=e&&e.length>0?"":void 0,r,null!=t?JSON.stringify(t):void 0,a].filter(e=>null!=e).join("\n")}({prompt:e,schema:t.jsonSchema}),parsePartial({text:e}){let t=function(e){if(void 0===e)return{value:void 0,state:"undefined-input"};let t=rW({text:e});return t.success?{value:t.value,state:"successful-parse"}:(t=rW({text:function(e){let t=["ROOT"],r=-1,a=null;function s(e,s,n){switch(e){case'"':r=s,t.pop(),t.push(n),t.push("INSIDE_STRING");break;case"f":case"t":case"n":r=s,a=s,t.pop(),t.push(n),t.push("INSIDE_LITERAL");break;case"-":t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=s,t.pop(),t.push(n),t.push("INSIDE_NUMBER");break;case"{":r=s,t.pop(),t.push(n),t.push("INSIDE_OBJECT_START");break;case"[":r=s,t.pop(),t.push(n),t.push("INSIDE_ARRAY_START")}}function n(e,a){switch(e){case",":t.pop(),t.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":r=a,t.pop()}}function i(e,a){switch(e){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=a,t.pop()}}for(let o=0;o<e.length;o++){let l=e[o];switch(t[t.length-1]){case"ROOT":s(l,o,"FINISH");break;case"INSIDE_OBJECT_START":switch(l){case'"':t.pop(),t.push("INSIDE_OBJECT_KEY");break;case"}":r=o,t.pop()}break;case"INSIDE_OBJECT_AFTER_COMMA":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_KEY"));break;case"INSIDE_OBJECT_KEY":'"'===l&&(t.pop(),t.push("INSIDE_OBJECT_AFTER_KEY"));break;case"INSIDE_OBJECT_AFTER_KEY":":"===l&&(t.pop(),t.push("INSIDE_OBJECT_BEFORE_VALUE"));break;case"INSIDE_OBJECT_BEFORE_VALUE":s(l,o,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(l,o);break;case"INSIDE_STRING":switch(l){case'"':t.pop(),r=o;break;case"\\":t.push("INSIDE_STRING_ESCAPE");break;default:r=o}break;case"INSIDE_ARRAY_START":"]"===l?(r=o,t.pop()):(r=o,s(l,o,"INSIDE_ARRAY_AFTER_VALUE"));break;case"INSIDE_ARRAY_AFTER_VALUE":switch(l){case",":t.pop(),t.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":r=o,t.pop();break;default:r=o}break;case"INSIDE_ARRAY_AFTER_COMMA":s(l,o,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":t.pop(),r=o;break;case"INSIDE_NUMBER":switch(l){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":r=o;break;case"e":case"E":case"-":case".":break;case",":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(l,o);break;case"}":t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]&&n(l,o);break;case"]":t.pop(),"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o);break;default:t.pop()}break;case"INSIDE_LITERAL":{let s=e.substring(a,o+1);"false".startsWith(s)||"true".startsWith(s)||"null".startsWith(s)?r=o:(t.pop(),"INSIDE_OBJECT_AFTER_VALUE"===t[t.length-1]?n(l,o):"INSIDE_ARRAY_AFTER_VALUE"===t[t.length-1]&&i(l,o))}}}let o=e.slice(0,r+1);for(let r=t.length-1;r>=0;r--)switch(t[r]){case"INSIDE_STRING":o+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":o+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":o+="]";break;case"INSIDE_LITERAL":{let t=e.substring(a,e.length);"true".startsWith(t)?o+="true".slice(t.length):"false".startsWith(t)?o+="false".slice(t.length):"null".startsWith(t)&&(o+="null".slice(t.length))}}return o}(e)})).success?{value:t.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"}}(e);switch(t.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:t.value};default:{let e=t.state;throw Error(`Unsupported parse state: ${e}`)}}},parseOutput({text:e},r){let a=rW({text:e});if(!a.success)throw new nI({message:"No object generated: could not parse the response.",cause:a.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});let s=rH({value:a.value,schema:t});if(!s.success)throw new nI({message:"No object generated: response did not match schema.",cause:s.error,text:e,response:r.response,usage:r.usage,finishReason:r.finishReason});return s.value}}};function iW(e,t){let r,a;let s=e.getReader(),n=t.getReader(),i=!1,o=!1;async function l(e){try{null==r&&(r=s.read());let t=await r;r=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}async function u(e){try{null==a&&(a=n.read());let t=await a;a=void 0,t.done?e.close():e.enqueue(t.value)}catch(t){e.error(t)}}return new ReadableStream({async pull(e){try{if(i){await u(e);return}if(o){await l(e);return}null==r&&(r=s.read()),null==a&&(a=n.read());let{result:t,reader:c}=await Promise.race([r.then(e=>({result:e,reader:s})),a.then(e=>({result:e,reader:n}))]);t.done||e.enqueue(t.value),c===s?(r=void 0,t.done&&(await u(e),i=!0)):(a=void 0,t.done&&(o=!0,await l(e)))}catch(t){e.error(t)}},cancel(){s.cancel(),n.cancel()}})}rF({prefix:"aitxt",size:24}),rF({prefix:"msg",size:24});var iz="AI_NoSuchProviderError",iJ=`vercel.ai.error.${iz}`;M=Symbol.for(iJ);var iZ=sy({name:su(),version:su()}).passthrough(),iK=sy({_meta:sk(sy({}).passthrough())}).passthrough(),iV=sy({method:su(),params:sk(iK)}),iG=sy({experimental:sk(sy({}).passthrough()),logging:sk(sy({}).passthrough()),prompts:sk(sy({listChanged:sk(sd())}).passthrough()),resources:sk(sy({subscribe:sk(sd()),listChanged:sk(sd())}).passthrough()),tools:sk(sy({listChanged:sk(sd())}).passthrough())}).passthrough(),iQ=(iK.extend({protocolVersion:su(),capabilities:iG,serverInfo:iZ,instructions:sk(su())}),iK.extend({nextCursor:sk(su())})),iY=sy({name:su(),description:sk(su()),inputSchema:sy({type:sb("object"),properties:sk(sy({}).passthrough())}).passthrough()}).passthrough(),iX=(iQ.extend({tools:sm(iY)}),sy({type:sb("text"),text:su()}).passthrough()),i0=sy({type:sb("image"),data:su().base64(),mimeType:su()}).passthrough(),i1=sy({uri:su(),mimeType:sk(su())}).passthrough(),i2=i1.extend({text:su()}),i4=i1.extend({blob:su().base64()}),i8=sy({type:sb("resource"),resource:sg([i2,i4])}).passthrough(),i6=(iK.extend({content:sm(sg([iX,i0,i8])),isError:sd().default(!1).optional()}).or(iK.extend({toolResult:sf()})),sy({jsonrpc:sb("2.0"),id:sg([su(),sc().int()])}).merge(iV).strict()),i5=sy({jsonrpc:sb("2.0"),id:sg([su(),sc().int()]),result:iK}).strict(),i3=sy({jsonrpc:sb("2.0"),id:sg([su(),sc().int()]),error:sy({code:sc().int(),message:su(),data:sk(sf())})}).strict(),i9=sg([i6,sy({jsonrpc:sb("2.0")}).merge(sy({method:su(),params:sk(iK)})).strict(),i5,i3]);function i7(e={}){let t=new TextEncoder,r="";return new TransformStream({async start(){e.onStart&&await e.onStart()},async transform(a,s){s.enqueue(t.encode(a)),r+=a,e.onToken&&await e.onToken(a),e.onText&&"string"==typeof a&&await e.onText(a)},async flush(){e.onCompletion&&await e.onCompletion(r),e.onFinal&&await e.onFinal(r)}})}function oe(e,t){return e.pipeThrough(new TransformStream({transform:async(e,t)=>{var r;if("string"==typeof e){t.enqueue(e);return}if("event"in e){"on_chat_model_stream"===e.event&&os(null==(r=e.data)?void 0:r.chunk,t);return}os(e,t)}})).pipeThrough(i7(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(s7("text",e))}}))}function ot(e,t){return oe(e,t).pipeThrough(new TextEncoderStream)}function or(e,t){var r;let a=oe(e,null==t?void 0:t.callbacks).pipeThrough(new TextEncoderStream),s=null==t?void 0:t.data,n=null==t?void 0:t.init;return new Response(s?iW(s.stream,a):a,{status:null!=(r=null==n?void 0:n.status)?r:200,statusText:null==n?void 0:n.statusText,headers:ns(null==n?void 0:n.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function oa(e,t){t.dataStream.merge(oe(e,t.callbacks))}function os(e,t){if("string"==typeof e.content)t.enqueue(e.content);else for(let r of e.content)"text"===r.type&&t.enqueue(r.text)}function on(e,t){var r;let a;let s=(a=!0,e=>(a&&(e=e.trimStart())&&(a=!1),e));return(r=e[Symbol.asyncIterator](),new ReadableStream({async pull(e){try{let{value:t,done:a}=await r.next();a?e.close():e.enqueue(t)}catch(t){e.error(t)}},cancel(){}})).pipeThrough(new TransformStream({async transform(e,t){t.enqueue(s(e.delta))}})).pipeThrough(i7(t)).pipeThrough(new TextDecoderStream).pipeThrough(new TransformStream({transform:async(e,t)=>{t.enqueue(s7("text",e))}}))}function oi(e,t){return on(e,t).pipeThrough(new TextEncoderStream)}function oo(e,t={}){var r;let{init:a,data:s,callbacks:n}=t,i=on(e,n).pipeThrough(new TextEncoderStream);return new Response(s?iW(s.stream,i):i,{status:null!=(r=null==a?void 0:a.status)?r:200,statusText:null==a?void 0:a.statusText,headers:ns(null==a?void 0:a.headers,{contentType:"text/plain; charset=utf-8",dataStreamVersion:"v1"})})}function ol(e,t){t.dataStream.merge(on(e,t.callbacks))}function ou(e){var t,r;return null!=(r=null==(t=null==e?void 0:e.content)?void 0:t.map(({token:e,logprob:t,top_logprobs:r})=>({token:e,logprob:t,topLogprobs:r?r.map(({token:e,logprob:t})=>({token:e,logprob:t})):[]})))?r:void 0}function oc(e){switch(e){case"stop":return"stop";case"length":return"length";case"content_filter":return"content-filter";case"function_call":case"tool_calls":return"tool-calls";default:return"unknown"}}na({},{mergeIntoDataStream:()=>oa,toDataStream:()=>ot,toDataStreamResponse:()=>or}),na({},{mergeIntoDataStream:()=>ol,toDataStream:()=>oi,toDataStreamResponse:()=>oo});var od=sy({error:sy({message:su(),type:su().nullish(),param:sh().nullish(),code:sg([su(),sc()]).nullish()})}),op=(({errorSchema:e,errorToMessage:t,isRetryable:r})=>async({response:a,url:s,requestBodyValues:n})=>{let i=await a.text(),o=rB(a);if(""===i.trim())return{responseHeaders:o,value:new t1({message:a.statusText,url:s,requestBodyValues:n,statusCode:a.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(a)})};try{let l=function({text:e,schema:t}){try{let r=r$.parse(e);if(null==t)return r;return function({value:e,schema:t}){let r=rH({value:e,schema:t});if(!r.success)throw rC.wrap({value:e,cause:r.error});return r.value}({value:r,schema:t})}catch(t){if(rp.isInstance(t)||rC.isInstance(t))throw t;throw new rp({text:e,cause:t})}}({text:i,schema:e});return{responseHeaders:o,value:new t1({message:t(l),url:s,requestBodyValues:n,statusCode:a.status,responseHeaders:o,responseBody:i,data:l,isRetryable:null==r?void 0:r(a,l)})}}catch(e){return{responseHeaders:o,value:new t1({message:a.statusText,url:s,requestBodyValues:n,statusCode:a.status,responseHeaders:o,responseBody:i,isRetryable:null==r?void 0:r(a)})}}})({errorSchema:od,errorToMessage:e=>e.error.message});function oh({id:e,model:t,created:r}){return{id:null!=e?e:void 0,modelId:null!=t?t:void 0,timestamp:null!=r?new Date(1e3*r):void 0}}var of=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get supportsStructuredOutputs(){var e;return null!=(e=this.settings.structuredOutputs)?e:ox(this.modelId)}get defaultObjectGenerationMode(){return this.modelId.startsWith("gpt-4o-audio-preview")?"tool":this.supportsStructuredOutputs?"json":"tool"}get provider(){return this.config.provider}get supportsImageUrls(){return!this.settings.downloadImages}getArgs({mode:e,prompt:t,maxTokens:r,temperature:a,topP:s,topK:n,frequencyPenalty:i,presencePenalty:o,stopSequences:l,responseFormat:u,seed:c,providerMetadata:d}){var p,h,f,m,y,g,x,v,w,b,_;let k=e.type,S=[];null!=n&&S.push({type:"unsupported-setting",setting:"topK"}),(null==u?void 0:u.type)!=="json"||null==u.schema||this.supportsStructuredOutputs||S.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format schema is only supported with structuredOutputs"});let T=this.settings.useLegacyFunctionCalling;if(T&&!0===this.settings.parallelToolCalls)throw new rO({functionality:"useLegacyFunctionCalling with parallelToolCalls"});if(T&&this.supportsStructuredOutputs)throw new rO({functionality:"structuredOutputs with useLegacyFunctionCalling"});let{messages:E,warnings:I}=function({prompt:e,useLegacyFunctionCalling:t=!1,systemMessageMode:r="system"}){let a=[],s=[];for(let{role:n,content:i}of e)switch(n){case"system":switch(r){case"system":a.push({role:"system",content:i});break;case"developer":a.push({role:"developer",content:i});break;case"remove":s.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${r}`)}break;case"user":if(1===i.length&&"text"===i[0].type){a.push({role:"user",content:i[0].text});break}a.push({role:"user",content:i.map((e,t)=>{var r,a,s,n;switch(e.type){case"text":return{type:"text",text:e.text};case"image":return{type:"image_url",image_url:{url:e.image instanceof URL?e.image.toString():`data:${null!=(r=e.mimeType)?r:"image/jpeg"};base64,${r4(e.image)}`,detail:null==(s=null==(a=e.providerMetadata)?void 0:a.openai)?void 0:s.imageDetail}};case"file":if(e.data instanceof URL)throw new rO({functionality:"'File content parts with URL data' functionality not supported."});switch(e.mimeType){case"audio/wav":return{type:"input_audio",input_audio:{data:e.data,format:"wav"}};case"audio/mp3":case"audio/mpeg":return{type:"input_audio",input_audio:{data:e.data,format:"mp3"}};case"application/pdf":return{type:"file",file:{filename:null!=(n=e.filename)?n:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${e.data}`}};default:throw new rO({functionality:`File content part type ${e.mimeType} in user messages`})}}})});break;case"assistant":{let e="",r=[];for(let t of i)switch(t.type){case"text":e+=t.text;break;case"tool-call":r.push({id:t.toolCallId,type:"function",function:{name:t.toolName,arguments:JSON.stringify(t.args)}})}if(t){if(r.length>1)throw new rO({functionality:"useLegacyFunctionCalling with multiple tool calls in one message"});a.push({role:"assistant",content:e,function_call:r.length>0?r[0].function:void 0})}else a.push({role:"assistant",content:e,tool_calls:r.length>0?r:void 0});break}case"tool":for(let e of i)t?a.push({role:"function",name:e.toolName,content:JSON.stringify(e.result)}):a.push({role:"tool",tool_call_id:e.toolCallId,content:JSON.stringify(e.result)});break;default:throw Error(`Unsupported role: ${n}`)}return{messages:a,warnings:s}}({prompt:t,useLegacyFunctionCalling:T,systemMessageMode:ox(w=this.modelId)?null!=(_=null==(b=ov[w])?void 0:b.systemMessageMode)?_:"developer":"system"});S.push(...I);let C={model:this.modelId,logit_bias:this.settings.logitBias,logprobs:!0===this.settings.logprobs||"number"==typeof this.settings.logprobs||void 0,top_logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,user:this.settings.user,parallel_tool_calls:this.settings.parallelToolCalls,max_tokens:r,temperature:a,top_p:s,frequency_penalty:i,presence_penalty:o,response_format:(null==u?void 0:u.type)==="json"?this.supportsStructuredOutputs&&null!=u.schema?{type:"json_schema",json_schema:{schema:u.schema,strict:!0,name:null!=(p=u.name)?p:"response",description:u.description}}:{type:"json_object"}:void 0,stop:l,seed:c,max_completion_tokens:null==(h=null==d?void 0:d.openai)?void 0:h.maxCompletionTokens,store:null==(f=null==d?void 0:d.openai)?void 0:f.store,metadata:null==(m=null==d?void 0:d.openai)?void 0:m.metadata,prediction:null==(y=null==d?void 0:d.openai)?void 0:y.prediction,reasoning_effort:null!=(x=null==(g=null==d?void 0:d.openai)?void 0:g.reasoningEffort)?x:this.settings.reasoningEffort,messages:E};switch(ox(this.modelId)?(null!=C.temperature&&(C.temperature=void 0,S.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=C.top_p&&(C.top_p=void 0,S.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"})),null!=C.frequency_penalty&&(C.frequency_penalty=void 0,S.push({type:"unsupported-setting",setting:"frequencyPenalty",details:"frequencyPenalty is not supported for reasoning models"})),null!=C.presence_penalty&&(C.presence_penalty=void 0,S.push({type:"unsupported-setting",setting:"presencePenalty",details:"presencePenalty is not supported for reasoning models"})),null!=C.logit_bias&&(C.logit_bias=void 0,S.push({type:"other",message:"logitBias is not supported for reasoning models"})),null!=C.logprobs&&(C.logprobs=void 0,S.push({type:"other",message:"logprobs is not supported for reasoning models"})),null!=C.top_logprobs&&(C.top_logprobs=void 0,S.push({type:"other",message:"topLogprobs is not supported for reasoning models"})),null!=C.max_tokens&&(null==C.max_completion_tokens&&(C.max_completion_tokens=C.max_tokens),C.max_tokens=void 0)):(this.modelId.startsWith("gpt-4o-search-preview")||this.modelId.startsWith("gpt-4o-mini-search-preview"))&&null!=C.temperature&&(C.temperature=void 0,S.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for the search preview models and has been removed."})),k){case"regular":{let{tools:t,tool_choice:r,functions:a,function_call:s,toolWarnings:n}=function({mode:e,useLegacyFunctionCalling:t=!1,structuredOutputs:r}){var a;let s=(null==(a=e.tools)?void 0:a.length)?e.tools:void 0,n=[];if(null==s)return{tools:void 0,tool_choice:void 0,toolWarnings:n};let i=e.toolChoice;if(t){let e=[];for(let t of s)"provider-defined"===t.type?n.push({type:"unsupported-tool",tool:t}):e.push({name:t.name,description:t.description,parameters:t.parameters});if(null==i)return{functions:e,function_call:void 0,toolWarnings:n};switch(i.type){case"auto":case"none":case void 0:return{functions:e,function_call:void 0,toolWarnings:n};case"required":throw new rO({functionality:"useLegacyFunctionCalling and toolChoice: required"});default:return{functions:e,function_call:{name:i.toolName},toolWarnings:n}}}let o=[];for(let e of s)"provider-defined"===e.type?n.push({type:"unsupported-tool",tool:e}):o.push({type:"function",function:{name:e.name,description:e.description,parameters:e.parameters,strict:!!r||void 0}});if(null==i)return{tools:o,tool_choice:void 0,toolWarnings:n};let l=i.type;switch(l){case"auto":case"none":case"required":return{tools:o,tool_choice:l,toolWarnings:n};case"tool":return{tools:o,tool_choice:{type:"function",function:{name:i.toolName}},toolWarnings:n};default:throw new rO({functionality:`Unsupported tool choice type: ${l}`})}}({mode:e,useLegacyFunctionCalling:T,structuredOutputs:this.supportsStructuredOutputs});return{args:{...C,tools:t,tool_choice:r,functions:a,function_call:s},warnings:[...S,...n]}}case"object-json":return{args:{...C,response_format:this.supportsStructuredOutputs&&null!=e.schema?{type:"json_schema",json_schema:{schema:e.schema,strict:!0,name:null!=(v=e.name)?v:"response",description:e.description}}:{type:"json_object"}},warnings:S};case"object-tool":return{args:T?{...C,function_call:{name:e.tool.name},functions:[{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters}]}:{...C,tool_choice:{type:"function",function:{name:e.tool.name}},tools:[{type:"function",function:{name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:!!this.supportsStructuredOutputs||void 0}}]},warnings:S};default:throw Error(`Unsupported type: ${k}`)}}async doGenerate(e){var t,r,a,s,n,i,o,l;let{args:u,warnings:c}=this.getArgs(e),{responseHeaders:d,value:p,rawValue:h}=await rK({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:rj(this.config.headers(),e.headers),body:u,failedResponseHandler:op,successfulResponseHandler:rY(oy),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:f,...m}=u,y=p.choices[0],g=null==(t=p.usage)?void 0:t.completion_tokens_details,x=null==(r=p.usage)?void 0:r.prompt_tokens_details,v={openai:{}};return(null==g?void 0:g.reasoning_tokens)!=null&&(v.openai.reasoningTokens=null==g?void 0:g.reasoning_tokens),(null==g?void 0:g.accepted_prediction_tokens)!=null&&(v.openai.acceptedPredictionTokens=null==g?void 0:g.accepted_prediction_tokens),(null==g?void 0:g.rejected_prediction_tokens)!=null&&(v.openai.rejectedPredictionTokens=null==g?void 0:g.rejected_prediction_tokens),(null==x?void 0:x.cached_tokens)!=null&&(v.openai.cachedPromptTokens=null==x?void 0:x.cached_tokens),{text:null!=(a=y.message.content)?a:void 0,toolCalls:this.settings.useLegacyFunctionCalling&&y.message.function_call?[{toolCallType:"function",toolCallId:rq(),toolName:y.message.function_call.name,args:y.message.function_call.arguments}]:null==(s=y.message.tool_calls)?void 0:s.map(e=>{var t;return{toolCallType:"function",toolCallId:null!=(t=e.id)?t:rq(),toolName:e.function.name,args:e.function.arguments}}),finishReason:oc(y.finish_reason),usage:{promptTokens:null!=(i=null==(n=p.usage)?void 0:n.prompt_tokens)?i:NaN,completionTokens:null!=(l=null==(o=p.usage)?void 0:o.completion_tokens)?l:NaN},rawCall:{rawPrompt:f,rawSettings:m},rawResponse:{headers:d,body:h},request:{body:JSON.stringify(u)},response:oh(p),warnings:c,logprobs:ou(y.logprobs),providerMetadata:v}}async doStream(e){let t;if(this.settings.simulateStreaming){let t=await this.doGenerate(e);return{stream:new ReadableStream({start(e){if(e.enqueue({type:"response-metadata",...t.response}),t.text&&e.enqueue({type:"text-delta",textDelta:t.text}),t.toolCalls)for(let r of t.toolCalls)e.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:r.toolCallId,toolName:r.toolName,argsTextDelta:r.args}),e.enqueue({type:"tool-call",...r});e.enqueue({type:"finish",finishReason:t.finishReason,usage:t.usage,logprobs:t.logprobs,providerMetadata:t.providerMetadata}),e.close()}}),rawCall:t.rawCall,rawResponse:t.rawResponse,warnings:t.warnings}}let{args:r,warnings:a}=this.getArgs(e),s={...r,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:n,value:i}=await rK({url:this.config.url({path:"/chat/completions",modelId:this.modelId}),headers:rj(this.config.headers(),e.headers),body:s,failedResponseHandler:op,successfulResponseHandler:rQ(og),abortSignal:e.abortSignal,fetch:this.config.fetch}),{messages:o,...l}=r,u=[],c="unknown",d={promptTokens:void 0,completionTokens:void 0},p=!0,{useLegacyFunctionCalling:h}=this.settings,f={openai:{}};return{stream:i.pipeThrough(new TransformStream({transform(e,r){var a,s,n,i,o,l,m,y,g,x,v,w;if(!e.success){c="error",r.enqueue({type:"error",error:e.error});return}let b=e.value;if("error"in b){c="error",r.enqueue({type:"error",error:b.error});return}if(p&&(p=!1,r.enqueue({type:"response-metadata",...oh(b)})),null!=b.usage){let{prompt_tokens:e,completion_tokens:t,prompt_tokens_details:r,completion_tokens_details:a}=b.usage;d={promptTokens:null!=e?e:void 0,completionTokens:null!=t?t:void 0},(null==a?void 0:a.reasoning_tokens)!=null&&(f.openai.reasoningTokens=null==a?void 0:a.reasoning_tokens),(null==a?void 0:a.accepted_prediction_tokens)!=null&&(f.openai.acceptedPredictionTokens=null==a?void 0:a.accepted_prediction_tokens),(null==a?void 0:a.rejected_prediction_tokens)!=null&&(f.openai.rejectedPredictionTokens=null==a?void 0:a.rejected_prediction_tokens),(null==r?void 0:r.cached_tokens)!=null&&(f.openai.cachedPromptTokens=null==r?void 0:r.cached_tokens)}let _=b.choices[0];if((null==_?void 0:_.finish_reason)!=null&&(c=oc(_.finish_reason)),(null==_?void 0:_.delta)==null)return;let k=_.delta;null!=k.content&&r.enqueue({type:"text-delta",textDelta:k.content});let S=ou(null==_?void 0:_.logprobs);(null==S?void 0:S.length)&&(void 0===t&&(t=[]),t.push(...S));let T=h&&null!=k.function_call?[{type:"function",id:rq(),function:k.function_call,index:0}]:k.tool_calls;if(null!=T)for(let e of T){let t=e.index;if(null==u[t]){if("function"!==e.type)throw new rl({data:e,message:"Expected 'function' type."});if(null==e.id)throw new rl({data:e,message:"Expected 'id' to be a string."});if((null==(a=e.function)?void 0:a.name)==null)throw new rl({data:e,message:"Expected 'function.name' to be a string."});u[t]={id:e.id,type:"function",function:{name:e.function.name,arguments:null!=(s=e.function.arguments)?s:""},hasFinished:!1};let l=u[t];(null==(n=l.function)?void 0:n.name)!=null&&(null==(i=l.function)?void 0:i.arguments)!=null&&(l.function.arguments.length>0&&r.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:l.id,toolName:l.function.name,argsTextDelta:l.function.arguments}),rz(l.function.arguments)&&(r.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(o=l.id)?o:rq(),toolName:l.function.name,args:l.function.arguments}),l.hasFinished=!0));continue}let c=u[t];!c.hasFinished&&((null==(l=e.function)?void 0:l.arguments)!=null&&(c.function.arguments+=null!=(y=null==(m=e.function)?void 0:m.arguments)?y:""),r.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:c.id,toolName:c.function.name,argsTextDelta:null!=(g=e.function.arguments)?g:""}),(null==(x=c.function)?void 0:x.name)!=null&&(null==(v=c.function)?void 0:v.arguments)!=null&&rz(c.function.arguments)&&(r.enqueue({type:"tool-call",toolCallType:"function",toolCallId:null!=(w=c.id)?w:rq(),toolName:c.function.name,args:c.function.arguments}),c.hasFinished=!0))}},flush(e){var r,a;e.enqueue({type:"finish",finishReason:c,logprobs:t,usage:{promptTokens:null!=(r=d.promptTokens)?r:NaN,completionTokens:null!=(a=d.completionTokens)?a:NaN},...null!=f?{providerMetadata:f}:{}})}})),rawCall:{rawPrompt:o,rawSettings:l},rawResponse:{headers:n},request:{body:JSON.stringify(s)},warnings:a}}},om=sy({prompt_tokens:sc().nullish(),completion_tokens:sc().nullish(),prompt_tokens_details:sy({cached_tokens:sc().nullish()}).nullish(),completion_tokens_details:sy({reasoning_tokens:sc().nullish(),accepted_prediction_tokens:sc().nullish(),rejected_prediction_tokens:sc().nullish()}).nullish()}).nullish(),oy=sy({id:su().nullish(),created:sc().nullish(),model:su().nullish(),choices:sm(sy({message:sy({role:sb("assistant").nullish(),content:su().nullish(),function_call:sy({arguments:su(),name:su()}).nullish(),tool_calls:sm(sy({id:su().nullish(),type:sb("function"),function:sy({name:su(),arguments:su()})})).nullish()}),index:sc(),logprobs:sy({content:sm(sy({token:su(),logprob:sc(),top_logprobs:sm(sy({token:su(),logprob:sc()}))})).nullable()}).nullish(),finish_reason:su().nullish()})),usage:om}),og=sg([sy({id:su().nullish(),created:sc().nullish(),model:su().nullish(),choices:sm(sy({delta:sy({role:s_(["assistant"]).nullish(),content:su().nullish(),function_call:sy({name:su().optional(),arguments:su().optional()}).nullish(),tool_calls:sm(sy({index:sc(),id:su().nullish(),type:sb("function").nullish(),function:sy({name:su().nullish(),arguments:su().nullish()})})).nullish()}).nullish(),logprobs:sy({content:sm(sy({token:su(),logprob:sc(),top_logprobs:sm(sy({token:su(),logprob:sc()}))})).nullable()}).nullish(),finish_reason:su().nullish(),index:sc()})),usage:om}),od]);function ox(e){return e.startsWith("o")}var ov={"o1-mini":{systemMessageMode:"remove"},"o1-mini-2024-09-12":{systemMessageMode:"remove"},"o1-preview":{systemMessageMode:"remove"},"o1-preview-2024-09-12":{systemMessageMode:"remove"},o3:{systemMessageMode:"developer"},"o3-2025-04-16":{systemMessageMode:"developer"},"o3-mini":{systemMessageMode:"developer"},"o3-mini-2025-01-31":{systemMessageMode:"developer"},"o4-mini":{systemMessageMode:"developer"},"o4-mini-2025-04-16":{systemMessageMode:"developer"}};function ow(e){return null==e?void 0:e.tokens.map((t,r)=>({token:t,logprob:e.token_logprobs[r],topLogprobs:e.top_logprobs?Object.entries(e.top_logprobs[r]).map(([e,t])=>({token:e,logprob:t})):[]}))}var ob=class{constructor(e,t,r){this.specificationVersion="v1",this.defaultObjectGenerationMode=void 0,this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}getArgs({mode:e,inputFormat:t,prompt:r,maxTokens:a,temperature:s,topP:n,topK:i,frequencyPenalty:o,presencePenalty:l,stopSequences:u,responseFormat:c,seed:d}){var p;let h=e.type,f=[];null!=i&&f.push({type:"unsupported-setting",setting:"topK"}),null!=c&&"text"!==c.type&&f.push({type:"unsupported-setting",setting:"responseFormat",details:"JSON response format is not supported."});let{prompt:m,stopSequences:y}=function({prompt:e,inputFormat:t,user:r="user",assistant:a="assistant"}){if("prompt"===t&&1===e.length&&"user"===e[0].role&&1===e[0].content.length&&"text"===e[0].content[0].type)return{prompt:e[0].content[0].text};let s="";for(let{role:t,content:n}of("system"===e[0].role&&(s+=`${e[0].content}

`,e=e.slice(1)),e))switch(t){case"system":throw new rs({message:"Unexpected system message in prompt: ${content}",prompt:e});case"user":{let e=n.map(e=>{switch(e.type){case"text":return e.text;case"image":throw new rO({functionality:"images"})}}).join("");s+=`${r}:
${e}

`;break}case"assistant":{let e=n.map(e=>{switch(e.type){case"text":return e.text;case"tool-call":throw new rO({functionality:"tool-call messages"})}}).join("");s+=`${a}:
${e}

`;break}case"tool":throw new rO({functionality:"tool messages"});default:throw Error(`Unsupported role: ${t}`)}return{prompt:s+=`${a}:
`,stopSequences:[`
${r}:`]}}({prompt:r,inputFormat:t}),g=[...null!=y?y:[],...null!=u?u:[]],x={model:this.modelId,echo:this.settings.echo,logit_bias:this.settings.logitBias,logprobs:"number"==typeof this.settings.logprobs?this.settings.logprobs:"boolean"==typeof this.settings.logprobs&&this.settings.logprobs?0:void 0,suffix:this.settings.suffix,user:this.settings.user,max_tokens:a,temperature:s,top_p:n,frequency_penalty:o,presence_penalty:l,seed:d,prompt:m,stop:g.length>0?g:void 0};switch(h){case"regular":if(null==(p=e.tools)?void 0:p.length)throw new rO({functionality:"tools"});if(e.toolChoice)throw new rO({functionality:"toolChoice"});return{args:x,warnings:f};case"object-json":throw new rO({functionality:"object-json mode"});case"object-tool":throw new rO({functionality:"object-tool mode"});default:throw Error(`Unsupported type: ${h}`)}}async doGenerate(e){let{args:t,warnings:r}=this.getArgs(e),{responseHeaders:a,value:s,rawValue:n}=await rK({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:rj(this.config.headers(),e.headers),body:t,failedResponseHandler:op,successfulResponseHandler:rY(o_),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:i,...o}=t,l=s.choices[0];return{text:l.text,usage:{promptTokens:s.usage.prompt_tokens,completionTokens:s.usage.completion_tokens},finishReason:oc(l.finish_reason),logprobs:ow(l.logprobs),rawCall:{rawPrompt:i,rawSettings:o},rawResponse:{headers:a,body:n},response:oh(s),warnings:r,request:{body:JSON.stringify(t)}}}async doStream(e){let t;let{args:r,warnings:a}=this.getArgs(e),s={...r,stream:!0,stream_options:"strict"===this.config.compatibility?{include_usage:!0}:void 0},{responseHeaders:n,value:i}=await rK({url:this.config.url({path:"/completions",modelId:this.modelId}),headers:rj(this.config.headers(),e.headers),body:s,failedResponseHandler:op,successfulResponseHandler:rQ(ok),abortSignal:e.abortSignal,fetch:this.config.fetch}),{prompt:o,...l}=r,u="unknown",c={promptTokens:Number.NaN,completionTokens:Number.NaN},d=!0;return{stream:i.pipeThrough(new TransformStream({transform(e,r){if(!e.success){u="error",r.enqueue({type:"error",error:e.error});return}let a=e.value;if("error"in a){u="error",r.enqueue({type:"error",error:a.error});return}d&&(d=!1,r.enqueue({type:"response-metadata",...oh(a)})),null!=a.usage&&(c={promptTokens:a.usage.prompt_tokens,completionTokens:a.usage.completion_tokens});let s=a.choices[0];(null==s?void 0:s.finish_reason)!=null&&(u=oc(s.finish_reason)),(null==s?void 0:s.text)!=null&&r.enqueue({type:"text-delta",textDelta:s.text});let n=ow(null==s?void 0:s.logprobs);(null==n?void 0:n.length)&&(void 0===t&&(t=[]),t.push(...n))},flush(e){e.enqueue({type:"finish",finishReason:u,logprobs:t,usage:c})}})),rawCall:{rawPrompt:o,rawSettings:l},rawResponse:{headers:n},warnings:a,request:{body:JSON.stringify(s)}}}},o_=sy({id:su().nullish(),created:sc().nullish(),model:su().nullish(),choices:sm(sy({text:su(),finish_reason:su(),logprobs:sy({tokens:sm(su()),token_logprobs:sm(sc()),top_logprobs:sm(sv(su(),sc())).nullable()}).nullish()})),usage:sy({prompt_tokens:sc(),completion_tokens:sc()})}),ok=sg([sy({id:su().nullish(),created:sc().nullish(),model:su().nullish(),choices:sm(sy({text:su(),finish_reason:su().nullish(),index:sc(),logprobs:sy({tokens:sm(su()),token_logprobs:sm(sc()),top_logprobs:sm(sv(su(),sc())).nullable()}).nullish()})),usage:sy({prompt_tokens:sc(),completion_tokens:sc()}).nullish()}),od]),oS=class{constructor(e,t,r){this.specificationVersion="v1",this.modelId=e,this.settings=t,this.config=r}get provider(){return this.config.provider}get maxEmbeddingsPerCall(){var e;return null!=(e=this.settings.maxEmbeddingsPerCall)?e:2048}get supportsParallelCalls(){var e;return null==(e=this.settings.supportsParallelCalls)||e}async doEmbed({values:e,headers:t,abortSignal:r}){if(e.length>this.maxEmbeddingsPerCall)throw new rS({provider:this.provider,modelId:this.modelId,maxEmbeddingsPerCall:this.maxEmbeddingsPerCall,values:e});let{responseHeaders:a,value:s}=await rK({url:this.config.url({path:"/embeddings",modelId:this.modelId}),headers:rj(this.config.headers(),t),body:{model:this.modelId,input:e,encoding_format:"float",dimensions:this.settings.dimensions,user:this.settings.user},failedResponseHandler:op,successfulResponseHandler:rY(oT),abortSignal:r,fetch:this.config.fetch});return{embeddings:s.data.map(e=>e.embedding),usage:s.usage?{tokens:s.usage.prompt_tokens}:void 0,rawResponse:{headers:a}}}},oT=sy({data:sm(sy({embedding:sm(sc())})),usage:sy({prompt_tokens:sc()}).nullish()}),oE={"dall-e-3":1,"dall-e-2":10,"gpt-image-1":10},oI=new Set(["gpt-image-1"]),oC=class{constructor(e,t,r){this.modelId=e,this.settings=t,this.config=r,this.specificationVersion="v1"}get maxImagesPerCall(){var e,t;return null!=(t=null!=(e=this.settings.maxImagesPerCall)?e:oE[this.modelId])?t:1}get provider(){return this.config.provider}async doGenerate({prompt:e,n:t,size:r,aspectRatio:a,seed:s,providerOptions:n,headers:i,abortSignal:o}){var l,u,c,d;let p=[];null!=a&&p.push({type:"unsupported-setting",setting:"aspectRatio",details:"This model does not support aspect ratio. Use `size` instead."}),null!=s&&p.push({type:"unsupported-setting",setting:"seed"});let h=null!=(c=null==(u=null==(l=this.config._internal)?void 0:l.currentDate)?void 0:u.call(l))?c:new Date,{value:f,responseHeaders:m}=await rK({url:this.config.url({path:"/images/generations",modelId:this.modelId}),headers:rj(this.config.headers(),i),body:{model:this.modelId,prompt:e,n:t,size:r,...null!=(d=n.openai)?d:{},...oI.has(this.modelId)?{}:{response_format:"b64_json"}},failedResponseHandler:op,successfulResponseHandler:rY(oA),abortSignal:o,fetch:this.config.fetch});return{images:f.data.map(e=>e.b64_json),warnings:p,response:{timestamp:h,modelId:this.modelId,headers:m}}}},oA=sy({data:sm(sy({b64_json:su()}))}),oR=sy({include:sm(su()).nullish(),language:su().nullish(),prompt:su().nullish(),temperature:sc().min(0).max(1).nullish().default(0),timestampGranularities:sm(s_(["word","segment"])).nullish().default(["segment"])}),oN={afrikaans:"af",arabic:"ar",armenian:"hy",azerbaijani:"az",belarusian:"be",bosnian:"bs",bulgarian:"bg",catalan:"ca",chinese:"zh",croatian:"hr",czech:"cs",danish:"da",dutch:"nl",english:"en",estonian:"et",finnish:"fi",french:"fr",galician:"gl",german:"de",greek:"el",hebrew:"he",hindi:"hi",hungarian:"hu",icelandic:"is",indonesian:"id",italian:"it",japanese:"ja",kannada:"kn",kazakh:"kk",korean:"ko",latvian:"lv",lithuanian:"lt",macedonian:"mk",malay:"ms",marathi:"mr",maori:"mi",nepali:"ne",norwegian:"no",persian:"fa",polish:"pl",portuguese:"pt",romanian:"ro",russian:"ru",serbian:"sr",slovak:"sk",slovenian:"sl",spanish:"es",swahili:"sw",swedish:"sv",tagalog:"tl",tamil:"ta",thai:"th",turkish:"tr",ukrainian:"uk",urdu:"ur",vietnamese:"vi",welsh:"cy"},oO=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({audio:e,mediaType:t,providerOptions:r}){var a,s,n,i,o;let l=rJ({provider:"openai",providerOptions:r,schema:oR}),u=new FormData,c=e instanceof Uint8Array?new Blob([e]):new Blob([r2(e)]);if(u.append("model",this.modelId),u.append("file",new File([c],"audio",{type:t})),l){let e={include:null!=(a=l.include)?a:void 0,language:null!=(s=l.language)?s:void 0,prompt:null!=(n=l.prompt)?n:void 0,temperature:null!=(i=l.temperature)?i:void 0,timestamp_granularities:null!=(o=l.timestampGranularities)?o:void 0};for(let t in e){let r=e[t];void 0!==r&&u.append(t,String(r))}}return{formData:u,warnings:[]}}async doGenerate(e){var t,r,a,s,n,i;let o=null!=(a=null==(r=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:r.call(t))?a:new Date,{formData:l,warnings:u}=this.getArgs(e),{value:c,responseHeaders:d,rawValue:p}=await rV({url:this.config.url({path:"/audio/transcriptions",modelId:this.modelId}),headers:rj(this.config.headers(),e.headers),formData:l,failedResponseHandler:op,successfulResponseHandler:rY(oP),abortSignal:e.abortSignal,fetch:this.config.fetch}),h=null!=c.language&&c.language in oN?oN[c.language]:void 0;return{text:c.text,segments:null!=(n=null==(s=c.words)?void 0:s.map(e=>({text:e.word,startSecond:e.start,endSecond:e.end})))?n:[],language:h,durationInSeconds:null!=(i=c.duration)?i:void 0,warnings:u,response:{timestamp:o,modelId:this.modelId,headers:d,body:p}}}},oP=sy({text:su(),language:su().nullish(),duration:sc().nullish(),words:sm(sy({word:su(),start:sc(),end:sc()})).nullish()});function oU({finishReason:e,hasToolCalls:t}){switch(e){case void 0:case null:return t?"tool-calls":"stop";case"max_output_tokens":return"length";case"content_filter":return"content-filter";default:return t?"tool-calls":"unknown"}}var o$=class{constructor(e,t){this.specificationVersion="v1",this.defaultObjectGenerationMode="json",this.supportsStructuredOutputs=!0,this.modelId=e,this.config=t}get provider(){return this.config.provider}getArgs({mode:e,maxTokens:t,temperature:r,stopSequences:a,topP:s,topK:n,presencePenalty:i,frequencyPenalty:o,seed:l,prompt:u,providerMetadata:c,responseFormat:d}){var p,h,f,m;let y=[],g=(m=this.modelId).startsWith("o")?m.startsWith("o1-mini")||m.startsWith("o1-preview")?{isReasoningModel:!0,systemMessageMode:"remove",requiredAutoTruncation:!1}:{isReasoningModel:!0,systemMessageMode:"developer",requiredAutoTruncation:!1}:{isReasoningModel:!1,systemMessageMode:"system",requiredAutoTruncation:!1},x=e.type;null!=n&&y.push({type:"unsupported-setting",setting:"topK"}),null!=l&&y.push({type:"unsupported-setting",setting:"seed"}),null!=i&&y.push({type:"unsupported-setting",setting:"presencePenalty"}),null!=o&&y.push({type:"unsupported-setting",setting:"frequencyPenalty"}),null!=a&&y.push({type:"unsupported-setting",setting:"stopSequences"});let{messages:v,warnings:w}=function({prompt:e,systemMessageMode:t}){let r=[],a=[];for(let{role:s,content:n}of e)switch(s){case"system":switch(t){case"system":r.push({role:"system",content:n});break;case"developer":r.push({role:"developer",content:n});break;case"remove":a.push({type:"other",message:"system messages are removed for this model"});break;default:throw Error(`Unsupported system message mode: ${t}`)}break;case"user":r.push({role:"user",content:n.map((e,t)=>{var r,a,s,n;switch(e.type){case"text":return{type:"input_text",text:e.text};case"image":return{type:"input_image",image_url:e.image instanceof URL?e.image.toString():`data:${null!=(r=e.mimeType)?r:"image/jpeg"};base64,${r4(e.image)}`,detail:null==(s=null==(a=e.providerMetadata)?void 0:a.openai)?void 0:s.imageDetail};case"file":if(e.data instanceof URL)throw new rO({functionality:"File URLs in user messages"});if("application/pdf"===e.mimeType)return{type:"input_file",filename:null!=(n=e.filename)?n:`part-${t}.pdf`,file_data:`data:application/pdf;base64,${e.data}`};throw new rO({functionality:"Only PDF files are supported in user messages"})}})});break;case"assistant":for(let e of n)switch(e.type){case"text":r.push({role:"assistant",content:[{type:"output_text",text:e.text}]});break;case"tool-call":r.push({type:"function_call",call_id:e.toolCallId,name:e.toolName,arguments:JSON.stringify(e.args)})}break;case"tool":for(let e of n)r.push({type:"function_call_output",call_id:e.toolCallId,output:JSON.stringify(e.result)});break;default:throw Error(`Unsupported role: ${s}`)}return{messages:r,warnings:a}}({prompt:u,systemMessageMode:g.systemMessageMode});y.push(...w);let b=rJ({provider:"openai",providerOptions:c,schema:oB}),_=null==(p=null==b?void 0:b.strictSchemas)||p,k={model:this.modelId,input:v,temperature:r,top_p:s,max_output_tokens:t,...(null==d?void 0:d.type)==="json"&&{text:{format:null!=d.schema?{type:"json_schema",strict:_,name:null!=(h=d.name)?h:"response",description:d.description,schema:d.schema}:{type:"json_object"}}},metadata:null==b?void 0:b.metadata,parallel_tool_calls:null==b?void 0:b.parallelToolCalls,previous_response_id:null==b?void 0:b.previousResponseId,store:null==b?void 0:b.store,user:null==b?void 0:b.user,instructions:null==b?void 0:b.instructions,...g.isReasoningModel&&((null==b?void 0:b.reasoningEffort)!=null||(null==b?void 0:b.reasoningSummary)!=null)&&{reasoning:{...(null==b?void 0:b.reasoningEffort)!=null&&{effort:b.reasoningEffort},...(null==b?void 0:b.reasoningSummary)!=null&&{summary:b.reasoningSummary}}},...g.requiredAutoTruncation&&{truncation:"auto"}};switch(g.isReasoningModel&&(null!=k.temperature&&(k.temperature=void 0,y.push({type:"unsupported-setting",setting:"temperature",details:"temperature is not supported for reasoning models"})),null!=k.top_p&&(k.top_p=void 0,y.push({type:"unsupported-setting",setting:"topP",details:"topP is not supported for reasoning models"}))),x){case"regular":{let{tools:t,tool_choice:r,toolWarnings:a}=function({mode:e,strict:t}){var r;let a=(null==(r=e.tools)?void 0:r.length)?e.tools:void 0,s=[];if(null==a)return{tools:void 0,tool_choice:void 0,toolWarnings:s};let n=e.toolChoice,i=[];for(let e of a)switch(e.type){case"function":i.push({type:"function",name:e.name,description:e.description,parameters:e.parameters,strict:!!t||void 0});break;case"provider-defined":"openai.web_search_preview"===e.id?i.push({type:"web_search_preview",search_context_size:e.args.searchContextSize,user_location:e.args.userLocation}):s.push({type:"unsupported-tool",tool:e});break;default:s.push({type:"unsupported-tool",tool:e})}if(null==n)return{tools:i,tool_choice:void 0,toolWarnings:s};let o=n.type;switch(o){case"auto":case"none":case"required":return{tools:i,tool_choice:o,toolWarnings:s};case"tool":if("web_search_preview"===n.toolName)return{tools:i,tool_choice:{type:"web_search_preview"},toolWarnings:s};return{tools:i,tool_choice:{type:"function",name:n.toolName},toolWarnings:s};default:throw new rO({functionality:`Unsupported tool choice type: ${o}`})}}({mode:e,strict:_});return{args:{...k,tools:t,tool_choice:r},warnings:[...y,...a]}}case"object-json":return{args:{...k,text:{format:null!=e.schema?{type:"json_schema",strict:_,name:null!=(f=e.name)?f:"response",description:e.description,schema:e.schema}:{type:"json_object"}}},warnings:y};case"object-tool":return{args:{...k,tool_choice:{type:"function",name:e.tool.name},tools:[{type:"function",name:e.tool.name,description:e.tool.description,parameters:e.tool.parameters,strict:_}]},warnings:y};default:throw Error(`Unsupported type: ${x}`)}}async doGenerate(e){var t,r,a,s,n,i,o;let{args:l,warnings:u}=this.getArgs(e),{responseHeaders:c,value:d,rawValue:p}=await rK({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:rj(this.config.headers(),e.headers),body:l,failedResponseHandler:op,successfulResponseHandler:rY(sy({id:su(),created_at:sc(),model:su(),output:sm(sx("type",[sy({type:sb("message"),role:sb("assistant"),content:sm(sy({type:sb("output_text"),text:su(),annotations:sm(sy({type:sb("url_citation"),start_index:sc(),end_index:sc(),url:su(),title:su()}))}))}),sy({type:sb("function_call"),call_id:su(),name:su(),arguments:su()}),sy({type:sb("web_search_call")}),sy({type:sb("computer_call")}),sy({type:sb("reasoning"),summary:sm(sy({type:sb("summary_text"),text:su()}))})])),incomplete_details:sy({reason:su()}).nullable(),usage:oj})),abortSignal:e.abortSignal,fetch:this.config.fetch}),h=d.output.filter(e=>"message"===e.type).flatMap(e=>e.content).filter(e=>"output_text"===e.type),f=d.output.filter(e=>"function_call"===e.type).map(e=>({toolCallType:"function",toolCallId:e.call_id,toolName:e.name,args:e.arguments})),m=null!=(r=null==(t=d.output.find(e=>"reasoning"===e.type))?void 0:t.summary)?r:null;return{text:h.map(e=>e.text).join("\n"),sources:h.flatMap(e=>e.annotations.map(e=>{var t,r,a;return{sourceType:"url",id:null!=(a=null==(r=(t=this.config).generateId)?void 0:r.call(t))?a:rq(),url:e.url,title:e.title}})),finishReason:oU({finishReason:null==(a=d.incomplete_details)?void 0:a.reason,hasToolCalls:f.length>0}),toolCalls:f.length>0?f:void 0,reasoning:m?m.map(e=>({type:"text",text:e.text})):void 0,usage:{promptTokens:d.usage.input_tokens,completionTokens:d.usage.output_tokens},rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:c,body:p},request:{body:JSON.stringify(l)},response:{id:d.id,timestamp:new Date(1e3*d.created_at),modelId:d.model},providerMetadata:{openai:{responseId:d.id,cachedPromptTokens:null!=(n=null==(s=d.usage.input_tokens_details)?void 0:s.cached_tokens)?n:null,reasoningTokens:null!=(o=null==(i=d.usage.output_tokens_details)?void 0:i.reasoning_tokens)?o:null}},warnings:u}}async doStream(e){let{args:t,warnings:r}=this.getArgs(e),{responseHeaders:a,value:s}=await rK({url:this.config.url({path:"/responses",modelId:this.modelId}),headers:rj(this.config.headers(),e.headers),body:{...t,stream:!0},failedResponseHandler:op,successfulResponseHandler:rQ(oM),abortSignal:e.abortSignal,fetch:this.config.fetch}),n=this,i="unknown",o=NaN,l=NaN,u=null,c=null,d=null,p={},h=!1;return{stream:s.pipeThrough(new TransformStream({transform(e,t){var r,a,s,f,m,y,g,x;if(!e.success){i="error",t.enqueue({type:"error",error:e.error});return}let v=e.value;if("response.output_item.added"===v.type)"function_call"===v.item.type&&(p[v.output_index]={toolName:v.item.name,toolCallId:v.item.call_id},t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:v.item.call_id,toolName:v.item.name,argsTextDelta:v.item.arguments}));else if("response.function_call_arguments.delta"===v.type){let e=p[v.output_index];null!=e&&t.enqueue({type:"tool-call-delta",toolCallType:"function",toolCallId:e.toolCallId,toolName:e.toolName,argsTextDelta:v.delta})}else"response.created"===v.type?(d=v.response.id,t.enqueue({type:"response-metadata",id:v.response.id,timestamp:new Date(1e3*v.response.created_at),modelId:v.response.model})):"response.output_text.delta"===v.type?t.enqueue({type:"text-delta",textDelta:v.delta}):"response.reasoning_summary_text.delta"===v.type?t.enqueue({type:"reasoning",textDelta:v.delta}):"response.output_item.done"===v.type&&"function_call"===v.item.type?(p[v.output_index]=void 0,h=!0,t.enqueue({type:"tool-call",toolCallType:"function",toolCallId:v.item.call_id,toolName:v.item.name,args:v.item.arguments})):"response.completed"===v.type||"response.incomplete"===v.type?(i=oU({finishReason:null==(r=v.response.incomplete_details)?void 0:r.reason,hasToolCalls:h}),o=v.response.usage.input_tokens,l=v.response.usage.output_tokens,u=null!=(s=null==(a=v.response.usage.input_tokens_details)?void 0:a.cached_tokens)?s:u,c=null!=(m=null==(f=v.response.usage.output_tokens_details)?void 0:f.reasoning_tokens)?m:c):"response.output_text.annotation.added"===v.type&&t.enqueue({type:"source",source:{sourceType:"url",id:null!=(x=null==(g=(y=n.config).generateId)?void 0:g.call(y))?x:rq(),url:v.annotation.url,title:v.annotation.title}})},flush(e){e.enqueue({type:"finish",finishReason:i,usage:{promptTokens:o,completionTokens:l},...(null!=u||null!=c)&&{providerMetadata:{openai:{responseId:d,cachedPromptTokens:u,reasoningTokens:c}}}})}})),rawCall:{rawPrompt:void 0,rawSettings:{}},rawResponse:{headers:a},request:{body:JSON.stringify(t)},warnings:r}}},oj=sy({input_tokens:sc(),input_tokens_details:sy({cached_tokens:sc().nullish()}).nullish(),output_tokens:sc(),output_tokens_details:sy({reasoning_tokens:sc().nullish()}).nullish()}),oM=sg([sy({type:sb("response.output_text.delta"),delta:su()}),sy({type:s_(["response.completed","response.incomplete"]),response:sy({incomplete_details:sy({reason:su()}).nullish(),usage:oj})}),sy({type:sb("response.created"),response:sy({id:su(),created_at:sc(),model:su()})}),sy({type:sb("response.output_item.done"),output_index:sc(),item:sx("type",[sy({type:sb("message")}),sy({type:sb("function_call"),id:su(),call_id:su(),name:su(),arguments:su(),status:sb("completed")})])}),sy({type:sb("response.function_call_arguments.delta"),item_id:su(),output_index:sc(),delta:su()}),sy({type:sb("response.output_item.added"),output_index:sc(),item:sx("type",[sy({type:sb("message")}),sy({type:sb("function_call"),id:su(),call_id:su(),name:su(),arguments:su()})])}),sy({type:sb("response.output_text.annotation.added"),annotation:sy({type:sb("url_citation"),url:su(),title:su()})}),sy({type:sb("response.reasoning_summary_text.delta"),item_id:su(),output_index:sc(),summary_index:sc(),delta:su()}),sy({type:su()}).passthrough()]),oB=sy({metadata:sh().nullish(),parallelToolCalls:sd().nullish(),previousResponseId:su().nullish(),store:sd().nullish(),user:su().nullish(),reasoningEffort:su().nullish(),strictSchemas:sd().nullish(),instructions:su().nullish(),reasoningSummary:su().nullish()}),oF=sy({}),oq={webSearchPreview:function({searchContextSize:e,userLocation:t}={}){return{type:"provider-defined",id:"openai.web_search_preview",args:{searchContextSize:e,userLocation:t},parameters:oF}}},oD=sy({instructions:su().nullish(),speed:sc().min(.25).max(4).default(1).nullish()}),oL=class{constructor(e,t){this.modelId=e,this.config=t,this.specificationVersion="v1"}get provider(){return this.config.provider}getArgs({text:e,voice:t="alloy",outputFormat:r="mp3",speed:a,instructions:s,providerOptions:n}){let i=[],o=rJ({provider:"openai",providerOptions:n,schema:oD}),l={model:this.modelId,input:e,voice:t,response_format:"mp3",speed:a,instructions:s};if(r&&(["mp3","opus","aac","flac","wav","pcm"].includes(r)?l.response_format=r:i.push({type:"unsupported-setting",setting:"outputFormat",details:`Unsupported output format: ${r}. Using mp3 instead.`})),o){let e={};for(let t in e){let r=e[t];void 0!==r&&(l[t]=r)}}return{requestBody:l,warnings:i}}async doGenerate(e){var t,r,a;let s=null!=(a=null==(r=null==(t=this.config._internal)?void 0:t.currentDate)?void 0:r.call(t))?a:new Date,{requestBody:n,warnings:i}=this.getArgs(e),{value:o,responseHeaders:l,rawValue:u}=await rK({url:this.config.url({path:"/audio/speech",modelId:this.modelId}),headers:rj(this.config.headers(),e.headers),body:n,failedResponseHandler:op,successfulResponseHandler:rX(),abortSignal:e.abortSignal,fetch:this.config.fetch});return{audio:o,warnings:i,request:{body:JSON.stringify(n)},response:{timestamp:s,modelId:this.modelId,headers:l,body:u}}}};function oH(e={}){var t,r,a,s;let n=null!=(t=null==(s=e.baseURL)?void 0:s.replace(/\/$/,""))?t:"https://api.openai.com/v1",i=null!=(r=e.compatibility)?r:"compatible",o=null!=(a=e.name)?a:"openai",l=()=>({Authorization:`Bearer ${function({apiKey:e,environmentVariableName:t,apiKeyParameterName:r="apiKey",description:a}){if("string"==typeof e)return e;if(null!=e)throw new ry({message:`${a} API key must be a string.`});if("undefined"==typeof process)throw new ry({message:`${a} API key is missing. Pass it using the '${r}' parameter. Environment variables is not supported in this environment.`});if(null==(e=process.env[t]))throw new ry({message:`${a} API key is missing. Pass it using the '${r}' parameter or the ${t} environment variable.`});if("string"!=typeof e)throw new ry({message:`${a} API key must be a string. The value of the ${t} environment variable is not a string.`});return e}({apiKey:e.apiKey,environmentVariableName:"OPENAI_API_KEY",description:"OpenAI"})}`,"OpenAI-Organization":e.organization,"OpenAI-Project":e.project,...e.headers}),u=(t,r={})=>new of(t,r,{provider:`${o}.chat`,url:({path:e})=>`${n}${e}`,headers:l,compatibility:i,fetch:e.fetch}),c=(t,r={})=>new ob(t,r,{provider:`${o}.completion`,url:({path:e})=>`${n}${e}`,headers:l,compatibility:i,fetch:e.fetch}),d=(t,r={})=>new oS(t,r,{provider:`${o}.embedding`,url:({path:e})=>`${n}${e}`,headers:l,fetch:e.fetch}),p=(t,r={})=>new oC(t,r,{provider:`${o}.image`,url:({path:e})=>`${n}${e}`,headers:l,fetch:e.fetch}),h=t=>new oO(t,{provider:`${o}.transcription`,url:({path:e})=>`${n}${e}`,headers:l,fetch:e.fetch}),f=t=>new oL(t,{provider:`${o}.speech`,url:({path:e})=>`${n}${e}`,headers:l,fetch:e.fetch}),m=(e,t)=>{if(new.target)throw Error("The OpenAI model function cannot be called with the new keyword.");return"gpt-3.5-turbo-instruct"===e?c(e,t):u(e,t)},y=function(e,t){return m(e,t)};return y.languageModel=m,y.chat=u,y.completion=c,y.responses=t=>new o$(t,{provider:`${o}.responses`,url:({path:e})=>`${n}${e}`,headers:l,fetch:e.fetch}),y.embedding=d,y.textEmbedding=d,y.textEmbeddingModel=d,y.image=p,y.imageModel=p,y.transcription=h,y.transcriptionModel=h,y.speech=f,y.speechModel=f,y.tools=oq,y}oH({compatibility:"strict"}),Object.create,Object.getOwnPropertyDescriptor,Object.getOwnPropertyNames,Object.getPrototypeOf,Object.prototype.hasOwnProperty;var oW="Upstash-Workflow-RunId",oz="Upstash-Workflow-Init",oJ="Upstash-Workflow-Url",oZ="Upstash-Workflow-Is-Failure",oK="Upstash-Feature-Set",oV="Upstash-Workflow-Invoke-Count",oG="Upstash-Workflow-Sdk-Version",oQ="@upstash/workflow@v0.2.14",oY=class extends tr{constructor(e){super(e),this.name="WorkflowError"}},oX=class extends Error{stepInfo;stepName;cancelWorkflow;constructor(e,t,r=!1){super(`This is an Upstash Workflow error thrown after a step executes. It is expected to be raised. Make sure that you await for each step. Also, if you are using try/catch blocks, you should not wrap context.run/sleep/sleepUntil/call methods with try/catch. Aborting workflow after executing step '${e}'.`),this.name="WorkflowAbort",this.stepName=e,this.stepInfo=t,this.cancelWorkflow=r}},o0=e=>e instanceof Error?{error:e.name,message:e.message}:{error:"Error",message:`An error occured while executing workflow: '${"string"==typeof e?e:JSON.stringify(e)}'`},o1=["Initial","Run","SleepFor","SleepUntil","Call","Wait","Notify","Invoke"],o2="upstash-agent-name",o4=`You are an agent orchestrating other AI Agents.

These other agents have tools available to them.

Given a prompt, utilize these agents to address requests.

Don't always call all the agents provided to you at the same time. You can call one and use it's response to call another.

Avoid calling the same agent twice in one turn. Instead, prefer to call it once but provide everything
you need from that agent.
`,o8=async(e,t,...r)=>{let[a,s]=r;try{let r=s?.headers?Object.fromEntries(new Headers(s.headers).entries()):{},n=s?.body?JSON.parse(s.body):void 0,i=r[o2],o=i?`Call Agent ${i}`:"Call Agent",l=await e.call(o,{url:a.toString(),method:s?.method,headers:r,body:n,timeout:t?.timeout,retries:t?.retries,flowControl:t?.flowControl}),u=new Headers(Object.entries(l.header).reduce((e,[t,r])=>(e[t]=r.join(", "),e),{}));return new Response(JSON.stringify(l.body),{status:l.status,headers:u})}catch(e){if(e instanceof Error&&"WorkflowAbort"===e.name)throw e;throw console.error("Error in fetch implementation:",e),e}},o6=({context:e,provider:t,providerParams:r,agentCallParams:a})=>t({fetch:(...t)=>o8(e,a,...t),...r}),o5=({context:e,tools:t})=>Object.fromEntries(Object.entries(t).map(t=>{let[r,a]=t,s=!("executeAsStep"in a)||a.executeAsStep,n=o3(a),i=n.execute;return i&&s&&(n.execute=(...t)=>e.run(`Run tool ${r}`,()=>i(...t))),[r,n]})),o3=e=>"invoke"in e?o9(e):e,o9=e=>({description:e.description,parameters:e.schema,execute:async(...t)=>e.invoke(...t)}),o7=(e,t)=>{if(!t)throw new oY("You can only call workflow which has a workflowId");return e.replace(/[^/]+$/,t)},le=async(e,t,r)=>await e.request({path:["v2","notify",t],method:"POST",body:"string"==typeof r?r:JSON.stringify(r)}),lt=async(e,t)=>await e.request({path:["v2","waiters",t],method:"GET"}),lr=async(e,t)=>(await e.request({path:["v2","workflows","runs",`${t}?cancel=true`],method:"DELETE",parseResponseAsJson:!1}),!0),la=async(e,t,r,a)=>{try{let s=await e.request({path:["v2","workflows","runs",t],parseResponseAsJson:!0});if(!r)return await a?.log("INFO","ENDPOINT_START",{message:`Pulled ${s.length} steps from QStashand returned them without filtering with messageId.`}),{steps:s,workflowRunEnded:!1};{let e=s.findIndex(e=>e.messageId===r);if(-1===e)return{steps:[],workflowRunEnded:!1};let t=s.slice(0,e+1);return await a?.log("INFO","ENDPOINT_START",{message:`Pulled ${s.length} steps from QStash and filtered them to ${t.length} using messageId.`}),{steps:t,workflowRunEnded:!1}}}catch(e){if(e instanceof tr&&404===e.status)return await a?.log("WARN","ENDPOINT_START",{message:"Couldn't fetch workflow run steps. This can happen if the workflow run succesfully ends before some callback is executed.",error:e}),{steps:void 0,workflowRunEnded:!0};throw e}},ls="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789-_";function ln(e){return`wfr_${e??Array.from({length:21}).map(()=>ls[Math.floor(Math.random()*ls.length)]).join("")}`}function li(e){let t=atob(e);try{let e=Uint8Array.from(t,e=>e.codePointAt(0));return new TextDecoder().decode(e)}catch(r){return console.warn(`Upstash Qstash: Failed while decoding base64 "${e}". Decoding with atob and returning it instead. ${r}`),t}}var lo={withStackTrace:!1},ll=(e,t,r=lo)=>({data:t.isOk()?{type:"Ok",value:t.value}:{type:"Err",value:t.error},message:e,stack:r.withStackTrace?Error().stack:void 0});function lu(e,t,r,a){return new(r||(r=Promise))(function(t,s){function n(e){try{o(a.next(e))}catch(e){s(e)}}function i(e){try{o(a.throw(e))}catch(e){s(e)}}function o(e){var a;e.done?t(e.value):((a=e.value)instanceof r?a:new r(function(e){e(a)})).then(n,i)}o((a=a.apply(e,[])).next())})}function lc(e){return this instanceof lc?(this.v=e,this):new lc(e)}var ld=class e{constructor(e){this._promise=e}static fromSafePromise(t){return new e(t.then(e=>new lv(e)))}static fromPromise(t,r){return new e(t.then(e=>new lv(e)).catch(e=>new lw(r(e))))}static fromThrowable(t,r){return(...a)=>new e(lu(this,void 0,void 0,function*(){try{return new lv((yield t(...a)))}catch(e){return new lw(r?r(e):e)}}))}static combine(e){return lf(e)}static combineWithAllErrors(e){return ly(e)}map(t){return new e(this._promise.then(e=>lu(this,void 0,void 0,function*(){return e.isErr()?new lw(e.error):new lv((yield t(e.value)))})))}andThrough(t){return new e(this._promise.then(e=>lu(this,void 0,void 0,function*(){if(e.isErr())return new lw(e.error);let r=yield t(e.value);return r.isErr()?new lw(r.error):new lv(e.value)})))}andTee(t){return new e(this._promise.then(e=>lu(this,void 0,void 0,function*(){if(e.isErr())return new lw(e.error);try{yield t(e.value)}catch(e){}return new lv(e.value)})))}mapErr(t){return new e(this._promise.then(e=>lu(this,void 0,void 0,function*(){return e.isOk()?new lv(e.value):new lw((yield t(e.error)))})))}andThen(t){return new e(this._promise.then(r=>{if(r.isErr())return new lw(r.error);let a=t(r.value);return a instanceof e?a._promise:a}))}orElse(t){return new e(this._promise.then(e=>lu(this,void 0,void 0,function*(){return e.isErr()?t(e.error):new lv(e.value)})))}match(e,t){return this._promise.then(r=>r.match(e,t))}unwrapOr(e){return this._promise.then(t=>t.unwrapOr(e))}safeUnwrap(){return function(e,t,r){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var a,s=r.apply(e,t||[]),n=[];return a={},i("next"),i("throw"),i("return"),a[Symbol.asyncIterator]=function(){return this},a;function i(e){s[e]&&(a[e]=function(t){return new Promise(function(r,a){n.push([e,t,r,a])>1||o(e,t)})})}function o(e,t){try{var r;(r=s[e](t)).value instanceof lc?Promise.resolve(r.value.v).then(l,u):c(n[0][2],r)}catch(e){c(n[0][3],e)}}function l(e){o("next",e)}function u(e){o("throw",e)}function c(e,t){e(t),n.shift(),n.length&&o(n[0][0],n[0][1])}}(this,arguments,function*(){return yield lc((yield lc((yield*function(e){var t,r;return t={},a("next"),a("throw",function(e){throw e}),a("return"),t[Symbol.iterator]=function(){return this},t;function a(a,s){t[a]=e[a]?function(t){return(r=!r)?{value:lc(e[a](t)),done:"return"===a}:s?s(t):t}:s}}(function(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,r=e[Symbol.asyncIterator];return r?r.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,r=t&&e[t],a=0;if(r)return r.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&a>=e.length&&(e=void 0),{value:e&&e[a++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},a("next"),a("throw"),a("return"),t[Symbol.asyncIterator]=function(){return this},t);function a(r){t[r]=e[r]&&function(t){return new Promise(function(a,s){(function(e,t,r,a){Promise.resolve(a).then(function(t){e({value:t,done:r})},t)})(a,s,(t=e[r](t)).done,t.value)})}}}((yield lc(this._promise.then(e=>e.safeUnwrap())))))))))})}then(e,t){return this._promise.then(e,t)}},lp=e=>new ld(Promise.resolve(new lw(e)));ld.fromPromise,ld.fromSafePromise,ld.fromThrowable;var lh=e=>{let t=lg([]);for(let r of e){if(r.isErr()){t=lx(r.error);break}t.map(e=>e.push(r.value))}return t},lf=e=>ld.fromSafePromise(Promise.all(e)).andThen(lh),lm=e=>{let t=lg([]);for(let r of e)r.isErr()&&t.isErr()?t.error.push(r.error):r.isErr()&&t.isOk()?t=lx([r.error]):r.isOk()&&t.isOk()&&t.value.push(r.value);return t},ly=e=>ld.fromSafePromise(Promise.all(e)).andThen(lm);!function(e){e.fromThrowable=function(e,t){return(...r)=>{try{let t=e(...r);return lg(t)}catch(e){return lx(t?t(e):e)}}},e.combine=function(e){return lh(e)},e.combineWithAllErrors=function(e){return lm(e)}}(B||(B={}));var lg=e=>new lv(e);function lx(e){return new lw(e)}var lv=class{constructor(e){this.value=e}isOk(){return!0}isErr(){return!this.isOk()}map(e){return lg(e(this.value))}mapErr(e){return lg(this.value)}andThen(e){return e(this.value)}andThrough(e){return e(this.value).map(e=>this.value)}andTee(e){try{e(this.value)}catch(e){}return lg(this.value)}orElse(e){return lg(this.value)}asyncAndThen(e){return e(this.value)}asyncAndThrough(e){return e(this.value).map(()=>this.value)}asyncMap(e){return ld.fromSafePromise(e(this.value))}unwrapOr(e){return this.value}match(e,t){return e(this.value)}safeUnwrap(){let e=this.value;return function*(){return e}()}_unsafeUnwrap(e){return this.value}_unsafeUnwrapErr(e){throw ll("Called `_unsafeUnwrapErr` on an Ok",this,e)}},lw=class{constructor(e){this.error=e}isOk(){return!1}isErr(){return!this.isOk()}map(e){return lx(this.error)}mapErr(e){return lx(e(this.error))}andThrough(e){return lx(this.error)}andTee(e){return lx(this.error)}andThen(e){return lx(this.error)}orElse(e){return e(this.error)}asyncAndThen(e){return lp(this.error)}asyncAndThrough(e){return lp(this.error)}asyncMap(e){return lp(this.error)}unwrapOr(e){return e}match(e,t){return t(this.error)}safeUnwrap(){let e=this.error;return function*(){throw yield lx(e),Error("Do not use this generator out of `safeTry`")}()}_unsafeUnwrap(e){throw ll("Called `_unsafeUnwrap` on an Err",this,e)}_unsafeUnwrapErr(e){return this.error}};B.fromThrowable;var lb=async e=>{let t=Array.isArray(e)?e:[e],r=t[0].workflowContext.qstashClient,a=t.map(({workflowContext:e,useJSONContent:t,telemetry:r,invokeCount:a,delay:s})=>{let{headers:n}=lF({initHeaderValue:"true",workflowConfig:{workflowRunId:e.workflowRunId,workflowUrl:e.url,failureUrl:e.failureUrl,retries:e.retries,telemetry:r,flowControl:e.flowControl,useJSONContent:t??!1},invokeCount:a??0,userHeaders:e.headers});return e.headers.get("content-type")&&(n["content-type"]=e.headers.get("content-type")),t&&(n["content-type"]="application/json"),{headers:n,method:"POST",body:"string"==typeof e.requestPayload?e.requestPayload:JSON.stringify(e.requestPayload),url:e.url,delay:s}});try{let e=await r.batch(a),s=[];for(let r=0;r<e.length;r++){let n=e[r],i=t[r];n.deduplicated?(await i.debug?.log("WARN","SUBMIT_FIRST_INVOCATION",{message:`Workflow run ${i.workflowContext.workflowRunId} already exists. A new one isn't created.`,headers:a[r].headers,requestPayload:i.workflowContext.requestPayload,url:i.workflowContext.url,messageId:n.messageId}),s.push("workflow-run-already-exists")):(await i.debug?.log("SUBMIT","SUBMIT_FIRST_INVOCATION",{headers:a[r].headers,requestPayload:i.workflowContext.requestPayload,url:i.workflowContext.url,messageId:n.messageId}),s.push("success"))}if(s.some(e=>"workflow-run-already-exists"===e))return lg("workflow-run-already-exists");return lg("success")}catch(e){return lx(e)}},l_=async({onCleanup:e,onStep:t,onCancel:r,debug:a})=>{try{let r=await t();return await e(r),lg("workflow-finished")}catch(e){if(e instanceof tr&&400===e.status)return await a?.log("WARN","RESPONSE_WORKFLOW",{message:"tried to append to a cancelled workflow. exiting without publishing.",name:e.name,errorMessage:e.message}),lg("workflow-was-finished");if(!(e instanceof oX))return lx(e);if(e.cancelWorkflow)return await r(),lg("workflow-finished");return lg("step-finished")}},lk=async(e,t,r,a=!1)=>{await r?.log("SUBMIT","SUBMIT_CLEANUP",{deletedWorkflowRunId:e.workflowRunId}),await e.qstashClient.http.request({path:["v2","workflows","runs",`${e.workflowRunId}?cancel=${a}`],method:"DELETE",parseResponseAsJson:!1,body:JSON.stringify(t)}),await r?.log("SUBMIT","SUBMIT_CLEANUP",`workflow run ${e.workflowRunId} deleted.`)},lS=e=>{let t=new Headers;for(let[r,a]of e.entries()){let e=r.toLowerCase();e.startsWith("upstash-workflow-")||e.startsWith("x-vercel-")||e.startsWith("x-forwarded-")||"cf-connecting-ip"===e||"cdn-loop"===e||"cf-ew-via"===e||"cf-ray"===e||"render-proxy-ttl"===e||t.append(r,a)}return t},lT=async({request:e,requestPayload:t,client:r,workflowUrl:a,failureUrl:s,retries:n,telemetry:i,flowControl:o,debug:l})=>{try{if(!e.headers.get("Upstash-Workflow-Callback"))return lg("continue-workflow");{let u;if(t)u=t;else{let t=e.headers.get("upstash-workflow-runid"),a=e.headers.get("upstash-message-id");if(!t)throw new oY("workflow run id missing in context.call lazy fetch.");if(!a)throw new oY("message id missing in context.call lazy fetch.");let{steps:s,workflowRunEnded:n}=await la(r.http,t,a,l);if(n)return lg("workflow-ended");let i=s.find(e=>e.messageId===a);if(!i)throw new oY("Failed to submit the context.call. "+(0===s.length?"No steps found.":`No step was found with matching messageId ${a} out of ${s.length} steps.`));u=atob(i.body)}let c=JSON.parse(u);if(!(c.status>=200&&c.status<300)&&c.maxRetries&&c.retried!==c.maxRetries)return await l?.log("WARN","SUBMIT_THIRD_PARTY_RESULT",{status:c.status,body:atob(c.body??"")}),console.warn(`Workflow Warning: "context.call" failed with status ${c.status} and will retry (retried ${c.retried??0} out of ${c.maxRetries} times). Error Message:
${atob(c.body??"")}`),lg("call-will-retry");let d=e.headers.get(oW),p=e.headers.get("Upstash-Workflow-StepId"),h=e.headers.get("Upstash-Workflow-StepName"),f=e.headers.get("Upstash-Workflow-StepType"),m=e.headers.get("Upstash-Workflow-Concurrent"),y=e.headers.get("Upstash-Workflow-ContentType"),g=e.headers.get(oV);if(!(d&&p&&h&&o1.includes(f)&&m&&y))throw Error(`Missing info in callback message source header: ${JSON.stringify({workflowRunId:d,stepIdString:p,stepName:h,stepType:f,concurrentString:m,contentType:y})}`);let x=lS(e.headers),{headers:v}=lF({initHeaderValue:"false",workflowConfig:{workflowRunId:d,workflowUrl:a,failureUrl:s,retries:n,telemetry:i,flowControl:o},userHeaders:x,invokeCount:Number(g)}),w={status:c.status,body:atob(c.body??""),header:c.header},b={stepId:Number(p),stepName:h,stepType:f,out:JSON.stringify(w),concurrent:Number(m)};await l?.log("SUBMIT","SUBMIT_THIRD_PARTY_RESULT",{step:b,headers:v,url:a});let _=await r.publishJSON({headers:v,method:"POST",body:b,url:a});return await l?.log("SUBMIT","SUBMIT_THIRD_PARTY_RESULT",{messageId:_.messageId}),lg("is-call-return")}}catch(r){let t=e.headers.get("Upstash-Workflow-Callback");return lx(new oY(`Error when handling call return (isCallReturn=${t}): ${r}`))}},lE=e=>({"Upstash-Telemetry-Sdk":e.sdk,"Upstash-Telemetry-Framework":e.framework,"Upstash-Telemetry-Runtime":e.runtime??"unknown"}),lI=async(e,t,r)=>{if(r)try{if(!t)throw Error("`Upstash-Signature` header is not passed.");if(!await r.verify({body:e,signature:t}))throw Error("Signature in `Upstash-Signature` header is not valid")}catch(e){throw new oY(`Failed to verify that the Workflow request comes from QStash: ${e}

If signature is missing, trigger the workflow endpoint by publishing your request to QStash instead of calling it directly.

If you want to disable QStash Verification, you should clear env variables QSTASH_CURRENT_SIGNING_KEY and QSTASH_NEXT_SIGNING_KEY`)}},lC=class e{stepName;constructor(e){if(!e)throw new oY("A workflow step name cannot be undefined or an empty string. Please provide a name for your workflow step.");"string"!=typeof e&&console.warn("Workflow Warning: A workflow step name must be a string. In a future release, this will throw an error."),this.stepName=e}parseOut(t){if(void 0===t){if(this.allowUndefinedOut)return;throw new oY(`Error while parsing output of ${this.stepType} step. Expected a string, but got: undefined`)}if("object"==typeof t)return"Wait"!==this.stepType?(console.warn(`Error while parsing ${this.stepType} step output. Expected a string, but got object. Please reach out to Upstash Support.`),t):{...t,eventData:e.tryParsing(t.eventData)};if("string"!=typeof t)throw new oY(`Error while parsing output of ${this.stepType} step. Expected a string or undefined, but got: ${typeof t}`);return this.safeParseOut(t)}safeParseOut(t){return e.tryParsing(t)}static tryParsing(e){try{return JSON.parse(e)}catch{return e}}getBody({step:e}){return e.out=JSON.stringify(e.out),JSON.stringify(e)}getHeaders({context:e,telemetry:t,invokeCount:r,step:a}){return lF({initHeaderValue:"false",workflowConfig:{workflowRunId:e.workflowRunId,workflowUrl:e.url,failureUrl:e.failureUrl,retries:e.retries,useJSONContent:!1,telemetry:t,flowControl:e.flowControl},userHeaders:e.headers,invokeCount:r,stepInfo:{step:a,lazyStep:this}})}async submitStep({context:e,body:t,headers:r}){return await e.qstashClient.batch([{body:t,headers:r,method:"POST",url:e.url}])}},lA=class extends lC{stepFunction;stepType="Run";allowUndefinedOut=!0;constructor(e,t){super(e),this.stepFunction=t}getPlanStep(e,t){return{stepId:0,stepName:this.stepName,stepType:this.stepType,concurrent:e,targetStep:t}}async getResultStep(e,t){let r=this.stepFunction();return r instanceof Promise&&(r=await r),{stepId:t,stepName:this.stepName,stepType:this.stepType,out:r,concurrent:e}}},lR=class extends lC{sleep;stepType="SleepFor";allowUndefinedOut=!0;constructor(e,t){super(e),this.sleep=t}getPlanStep(e,t){return{stepId:0,stepName:this.stepName,stepType:this.stepType,sleepFor:this.sleep,concurrent:e,targetStep:t}}async getResultStep(e,t){return await Promise.resolve({stepId:t,stepName:this.stepName,stepType:this.stepType,sleepFor:this.sleep,concurrent:e})}async submitStep({context:e,body:t,headers:r,isParallel:a}){return await e.qstashClient.batch([{body:t,headers:r,method:"POST",url:e.url,delay:a?void 0:this.sleep}])}},lN=class extends lC{sleepUntil;stepType="SleepUntil";allowUndefinedOut=!0;constructor(e,t){super(e),this.sleepUntil=t}getPlanStep(e,t){return{stepId:0,stepName:this.stepName,stepType:this.stepType,sleepUntil:this.sleepUntil,concurrent:e,targetStep:t}}async getResultStep(e,t){return await Promise.resolve({stepId:t,stepName:this.stepName,stepType:this.stepType,sleepUntil:this.sleepUntil,concurrent:e})}safeParseOut(){}async submitStep({context:e,body:t,headers:r,isParallel:a}){return await e.qstashClient.batch([{body:t,headers:r,method:"POST",url:e.url,notBefore:a?void 0:this.sleepUntil}])}},lO=class e extends lC{url;method;body;headers;retries;timeout;flowControl;stepType="Call";allowUndefinedOut=!1;constructor(e,t,r,a,s,n,i,o){super(e),this.url=t,this.method=r,this.body=a,this.headers=s,this.retries=n,this.timeout=i,this.flowControl=o}getPlanStep(e,t){return{stepId:0,stepName:this.stepName,stepType:this.stepType,concurrent:e,targetStep:t}}async getResultStep(e,t){return await Promise.resolve({stepId:t,stepName:this.stepName,stepType:this.stepType,concurrent:e,callUrl:this.url,callMethod:this.method,callBody:this.body,callHeaders:this.headers})}safeParseOut(t){let{header:r,status:a,body:s}=JSON.parse(t),n=new Headers(r);if(!e.isText(n.get("content-type")))return{header:r,status:a,body:s};{let e=new Uint8Array(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);let s=JSON.parse(new TextDecoder().decode(e)).body;return{status:a,header:r,body:lC.tryParsing(s)}}}static applicationContentTypes=["application/json","application/xml","application/javascript","application/x-www-form-urlencoded","application/xhtml+xml","application/ld+json","application/rss+xml","application/atom+xml"];static isText=t=>!!t&&!!(e.applicationContentTypes.some(e=>t.includes(e))||t.startsWith("text/"));getBody({step:e}){if(!e.callUrl)throw new oY("Incompatible step received in LazyCallStep.getBody");return JSON.stringify(e.callBody)}getHeaders({context:e,telemetry:t,invokeCount:r,step:a}){let{headers:s,contentType:n}=super.getHeaders({context:e,telemetry:t,invokeCount:r,step:a});if(s["Upstash-Retries"]=this.retries.toString(),s[oK]="WF_NoDelete,InitialBody",this.flowControl){let{flowControlKey:e,flowControlValue:t}=lB(this.flowControl);s["Upstash-Flow-Control-Key"]=e,s["Upstash-Flow-Control-Value"]=t}this.timeout&&(s["Upstash-Timeout"]=this.timeout.toString());let i=Object.fromEntries(Object.entries(this.headers).map(([e,t])=>[`Upstash-Forward-${e}`,t]));return{headers:{...s,...i,"Upstash-Callback":e.url,"Upstash-Callback-Workflow-RunId":e.workflowRunId,"Upstash-Callback-Workflow-CallType":"fromCallback","Upstash-Callback-Workflow-Init":"false","Upstash-Callback-Workflow-Url":e.url,"Upstash-Callback-Feature-Set":"LazyFetch,InitialBody","Upstash-Callback-Forward-Upstash-Workflow-Callback":"true","Upstash-Callback-Forward-Upstash-Workflow-StepId":a.stepId.toString(),"Upstash-Callback-Forward-Upstash-Workflow-StepName":this.stepName,"Upstash-Callback-Forward-Upstash-Workflow-StepType":this.stepType,"Upstash-Callback-Forward-Upstash-Workflow-Concurrent":a.concurrent.toString(),"Upstash-Callback-Forward-Upstash-Workflow-ContentType":n,"Upstash-Workflow-CallType":"toCallback"},contentType:n}}async submitStep({context:e,headers:t}){return await e.qstashClient.batch([{headers:t,body:JSON.stringify(this.body),method:this.method,url:this.url}])}},lP=class extends lC{eventId;timeout;stepType="Wait";allowUndefinedOut=!1;constructor(e,t,r){super(e),this.eventId=t,this.timeout=r}getPlanStep(e,t){return{stepId:0,stepName:this.stepName,stepType:this.stepType,waitEventId:this.eventId,timeout:this.timeout,concurrent:e,targetStep:t}}async getResultStep(e,t){return await Promise.resolve({stepId:t,stepName:this.stepName,stepType:this.stepType,waitEventId:this.eventId,timeout:this.timeout,concurrent:e})}safeParseOut(e){let t=JSON.parse(e);return{...t,eventData:lC.tryParsing(t.eventData)}}getHeaders({context:e,telemetry:t,invokeCount:r,step:a}){let s=super.getHeaders({context:e,telemetry:t,invokeCount:r,step:a});return s.headers["Upstash-Workflow-CallType"]="step",s}getBody({context:e,step:t,headers:r,telemetry:a}){if(!t.waitEventId)throw new oY("Incompatible step received in LazyWaitForEventStep.getBody");let s={...Object.fromEntries(Object.entries(r).map(([e,t])=>[e,[t]])),...a?Object.fromEntries(Object.entries(lE(a)).map(([e,t])=>[e,[t]])):{},"Upstash-Workflow-Runid":[e.workflowRunId],[oz]:["false"],[oJ]:[e.url],"Upstash-Workflow-CallType":["step"]};return JSON.stringify({url:e.url,timeout:t.timeout,timeoutBody:void 0,timeoutUrl:e.url,timeoutHeaders:s,step:{stepId:t.stepId,stepType:"Wait",stepName:t.stepName,concurrent:t.concurrent,targetStep:t.targetStep}})}async submitStep({context:e,body:t,headers:r}){return[await e.qstashClient.http.request({path:["v2","wait",this.eventId],body:t,headers:r,method:"POST",parseResponseAsJson:!1})]}},lU=class extends lA{stepType="Notify";constructor(e,t,r,a){super(e,async()=>{let e=await le(a,t,r);return{eventId:t,eventData:r,notifyResponse:e}})}safeParseOut(e){let t=JSON.parse(e);return{...t,eventData:lC.tryParsing(t.eventData)}}},l$=class extends lC{stepType="Invoke";params;allowUndefinedOut=!1;workflowId;constructor(e,{workflow:t,body:r,headers:a={},workflowRunId:s,retries:n,flowControl:i}){super(e),this.params={workflow:t,body:r,headers:a,workflowRunId:ln(s),retries:n,flowControl:i};let{workflowId:o}=t;if(!o)throw new oY("You can only invoke workflow which has a workflowId");this.workflowId=o}getPlanStep(e,t){return{stepId:0,stepName:this.stepName,stepType:this.stepType,concurrent:e,targetStep:t}}getResultStep(e,t){return Promise.resolve({stepId:t,stepName:this.stepName,stepType:this.stepType,concurrent:e})}safeParseOut(e){let t=JSON.parse(e);return{...t,body:lC.tryParsing(t.body)}}getBody({context:e,step:t,telemetry:r,invokeCount:a}){let{headers:s}=lF({initHeaderValue:"false",workflowConfig:{workflowRunId:e.workflowRunId,workflowUrl:e.url,failureUrl:e.failureUrl,retries:e.retries,telemetry:r,flowControl:e.flowControl,useJSONContent:!1},userHeaders:e.headers,invokeCount:a});return s["Upstash-Workflow-Runid"]=e.workflowRunId,JSON.stringify({body:JSON.stringify(this.params.body),headers:Object.fromEntries(Object.entries(s).map(e=>[e[0],[e[1]]])),workflowRunId:e.workflowRunId,workflowUrl:e.url,step:t})}getHeaders({context:e,telemetry:t,invokeCount:r}){let{workflow:a,headers:s={},workflowRunId:n=ln(),retries:i,flowControl:o}=this.params,l=e.url.replace(/[^/]+$/,this.workflowId),{retries:u,failureFunction:c,failureUrl:d,useJSONContent:p,flowControl:h}=a.options,{headers:f,contentType:m}=lF({initHeaderValue:"true",workflowConfig:{workflowRunId:n,workflowUrl:l,retries:i??u,telemetry:t,failureUrl:c?l:d,flowControl:o??h,useJSONContent:p??!1},invokeCount:r+1,userHeaders:new Headers(s)});return f["Upstash-Workflow-Invoke"]="true",{headers:f,contentType:m}}async submitStep({context:e,body:t,headers:r}){let a=e.url.replace(/[^/]+$/,this.workflowId);return[await e.qstashClient.publish({headers:r,method:"POST",body:t,url:a})]}},lj=class{userHeaders;workflowConfig;invokeCount;initHeaderValue;stepInfo;headers;constructor({userHeaders:e,workflowConfig:t,invokeCount:r,initHeaderValue:a,stepInfo:s}){this.userHeaders=e,this.workflowConfig=t,this.invokeCount=r,this.initHeaderValue=a,this.stepInfo=s,this.headers={rawHeaders:{},workflowHeaders:{},failureHeaders:{}}}getHeaders(){this.addBaseHeaders(),this.addRetries(),this.addFlowControl(),this.addUserHeaders(),this.addInvokeCount(),this.addFailureUrl();let e=this.addContentType();return this.prefixHeaders(e)}addBaseHeaders(){this.headers.rawHeaders={...this.headers.rawHeaders,[oz]:this.initHeaderValue,[oW]:this.workflowConfig.workflowRunId,[oJ]:this.workflowConfig.workflowUrl,[oK]:"LazyFetch,InitialBody",[oG]:"1",...this.workflowConfig.telemetry?lE(this.workflowConfig.telemetry):{},...this.workflowConfig.telemetry&&this.stepInfo?.lazyStep instanceof lO&&this.stepInfo.lazyStep.headers[o2]?{"Upstash-Telemetry-Agent":"true"}:{}},this.stepInfo?.lazyStep.stepType!=="Call"&&(this.headers.rawHeaders[`Upstash-Forward-${oG}`]="1")}addInvokeCount(){if(void 0===this.invokeCount||0===this.invokeCount)return;let e=this.invokeCount.toString();this.headers.workflowHeaders[`Forward-${oV}`]=e,this.workflowConfig.failureUrl&&(this.headers.failureHeaders[`Forward-${oV}`]=e),this.stepInfo?.lazyStep instanceof lO&&(this.headers.rawHeaders[`Upstash-Forward-${oV}`]=e)}addRetries(){if(void 0===this.workflowConfig.retries||3===this.workflowConfig.retries)return;let e=this.workflowConfig.retries.toString();this.headers.workflowHeaders.Retries=e,this.workflowConfig.failureUrl&&(this.headers.failureHeaders.Retries=e)}addFlowControl(){if(!this.workflowConfig.flowControl)return;let{flowControlKey:e,flowControlValue:t}=lB(this.workflowConfig.flowControl);this.headers.workflowHeaders["Flow-Control-Key"]=e,this.headers.workflowHeaders["Flow-Control-Value"]=t,this.workflowConfig.failureUrl&&(this.headers.failureHeaders["Flow-Control-Key"]=e,this.headers.failureHeaders["Flow-Control-Value"]=t)}addUserHeaders(){for(let[e,t]of this.userHeaders.entries()){let r=`Forward-${e}`;this.headers.workflowHeaders[r]=t,this.workflowConfig.failureUrl&&(this.headers.failureHeaders[r]=t)}}addFailureUrl(){this.workflowConfig.failureUrl&&(this.headers.workflowHeaders["Failure-Callback"]=this.workflowConfig.failureUrl,this.headers.failureHeaders[`Forward-${oZ}`]="true",this.headers.failureHeaders["Forward-Upstash-Workflow-Failure-Callback"]="true",this.headers.failureHeaders["Workflow-Runid"]=this.workflowConfig.workflowRunId,this.headers.failureHeaders["Workflow-Init"]="false",this.headers.failureHeaders["Workflow-Url"]=this.workflowConfig.workflowUrl,this.headers.failureHeaders["Workflow-Calltype"]="failureCall",this.headers.failureHeaders["Feature-Set"]="LazyFetch,InitialBody",void 0!==this.workflowConfig.retries&&3!==this.workflowConfig.retries&&(this.headers.failureHeaders.Retries=this.workflowConfig.retries.toString()))}addContentType(){if(this.workflowConfig.useJSONContent)return this.headers.rawHeaders["content-type"]="application/json","application/json";let e=new Headers(this.stepInfo?.lazyStep instanceof lO?this.stepInfo.lazyStep.headers:{}),t=(e.get("content-type")?e.get("content-type"):this.userHeaders?.get("Content-Type")?this.userHeaders.get("Content-Type"):void 0)??"application/json";return this.headers.rawHeaders["content-type"]=t,t}prefixHeaders(e){let{rawHeaders:t,workflowHeaders:r,failureHeaders:a}=this.headers,s=this.stepInfo?.lazyStep.stepType==="Call";return{headers:{...t,...lM(r,s?"Upstash-Callback-":"Upstash-"),...lM(a,"Upstash-Failure-Callback-"),...s?lM(a,"Upstash-Callback-Failure-Callback-"):{}},contentType:e}}};function lM(e,t){let r={};for(let[a,s]of Object.entries(e))r[`${t}${a}`]=s;return r}var lB=e=>{let t=e.parallelism?.toString(),r=(e.rate??e.ratePerSecond)?.toString(),a="number"==typeof e.period?`${e.period}s`:e.period,s=[t?`parallelism=${t}`:void 0,r?`rate=${r}`:void 0,a?`period=${a}`:void 0].filter(Boolean);if(0===s.length)throw new tr("Provide at least one of parallelism or ratePerSecond for flowControl");return{flowControlKey:e.key,flowControlValue:s.join(", ")}},lF=e=>new lj(e).getHeaders(),lq=async({context:e,steps:t,initialStepCount:r,invokeCount:a,telemetry:s,debug:n})=>{let i=t.map((e,a)=>e.getPlanStep(t.length,r+a));await n?.log("SUBMIT","SUBMIT_STEP",{length:i.length,steps:i});let o=await e.qstashClient.batch(i.map(t=>{let{headers:r}=lF({initHeaderValue:"false",workflowConfig:{workflowRunId:e.workflowRunId,workflowUrl:e.url,failureUrl:e.failureUrl,retries:e.retries,flowControl:e.flowControl,telemetry:s},userHeaders:e.headers,invokeCount:a});return{headers:r,method:"POST",url:e.url,body:JSON.stringify(t),notBefore:t.sleepUntil,delay:t.sleepFor}}));throw await n?.log("INFO","SUBMIT_STEP",{messageIds:o.map(e=>({message:e.messageId}))}),new oX(i[0].stepName,i[0])},lD=async({context:e,lazyStep:t,stepId:r,invokeCount:a,concurrency:s,telemetry:n,debug:i})=>{let o=await t.getResultStep(s,r);await i?.log("INFO","RUN_SINGLE",{fromRequest:!1,step:o,stepCount:r});let{headers:l}=t.getHeaders({context:e,step:o,invokeCount:a,telemetry:n}),u=t.getBody({context:e,step:o,headers:l,invokeCount:a,telemetry:n});await i?.log("SUBMIT","SUBMIT_STEP",{length:1,steps:[o]});let c=await t.submitStep({context:e,body:u,headers:l,isParallel:1!==s,invokeCount:a,step:o,telemetry:n});return await i?.log("INFO","SUBMIT_STEP",{messageIds:c.map(e=>({message:e.messageId}))}),o},lL=class e{context;promises=new WeakMap;activeLazyStepList;debug;nonPlanStepCount;steps;indexInCurrentList=0;invokeCount;telemetry;stepCount=0;planStepCount=0;executingStep=!1;constructor(e,t,r,a,s){this.context=e,this.steps=t,this.telemetry=r,this.invokeCount=a??0,this.debug=s,this.nonPlanStepCount=this.steps.filter(e=>!e.targetStep).length}async addStep(t){if(this.executingStep)throw new oY(`A step can not be run inside another step. Tried to run '${t.stepName}' inside '${this.executingStep}'`);this.stepCount+=1;let r=this.activeLazyStepList??[];this.activeLazyStepList||(this.activeLazyStepList=r,this.indexInCurrentList=0),r.push(t);let a=this.indexInCurrentList++,s=this.deferExecution().then(async()=>{if(!this.promises.has(r)){let e=this.getExecutionPromise(r);this.promises.set(r,e),this.activeLazyStepList=void 0,this.planStepCount+=r.length>1?r.length:0}return this.promises.get(r)}),n=await s;return e.getResult(r,n,a)}wrapStep(e,t){this.executingStep=e;let r=t();return this.executingStep=!1,r}async runSingle(e){if(this.stepCount<this.nonPlanStepCount){let t=this.steps[this.stepCount+this.planStepCount];return lH(e,t),await this.debug?.log("INFO","RUN_SINGLE",{fromRequest:!0,step:t,stepCount:this.stepCount}),e.parseOut(t.out)}let t=await lD({context:this.context,lazyStep:e,stepId:this.stepCount,invokeCount:this.invokeCount,concurrency:1,telemetry:this.telemetry,debug:this.debug});throw new oX(e.stepName,t)}async runParallel(e){let t=this.stepCount-(e.length-1),r=this.getParallelCallState(e.length,t),a=lz(this.steps),s=a[t+this.planStepCount]?.concurrent;if("first"!==r&&s!==e.length)throw new oY(`Incompatible number of parallel steps when call state was '${r}'. Expected ${e.length}, got ${s} from the request.`);switch(await this.debug?.log("INFO","RUN_PARALLEL",{parallelCallState:r,initialStepCount:t,plannedParallelStepCount:s,stepCount:this.stepCount,planStepCount:this.planStepCount}),r){case"first":await lq({context:this.context,steps:e,initialStepCount:t,invokeCount:this.invokeCount,telemetry:this.telemetry,debug:this.debug});break;case"partial":{let r=this.steps.at(-1);if(!r||void 0===r.targetStep)throw new oY(`There must be a last step and it should have targetStep larger than 0.Received: ${JSON.stringify(r)}`);let a=r.targetStep-t;lH(e[a],r);try{let t=e[a],s=await lD({context:this.context,lazyStep:t,stepId:r.targetStep,invokeCount:this.invokeCount,concurrency:e.length,telemetry:this.telemetry,debug:this.debug});throw new oX(t.stepName,s)}catch(e){if(e instanceof oX||e instanceof tr&&400===e.status)throw e;throw new oY(`Error submitting steps to QStash in partial parallel step execution: ${e}`)}break}case"discard":throw new oX("discarded parallel");case"last":{let r=a.filter(e=>e.stepId>=t).slice(0,e.length);return lW(e,r),r.map((t,r)=>e[r].parseOut(t.out))}}return Array.from({length:e.length}).fill(void 0)}getParallelCallState(e,t){let r=this.steps.filter(e=>(e.targetStep||e.stepId)>=t);return 0===r.length?"first":r.length>=2*e?"last":r.at(-1)?.targetStep?"partial":"discard"}getExecutionPromise(e){return 1===e.length?this.runSingle(e[0]):this.runParallel(e)}static getResult(e,t,r){if(1===e.length)return t;if(Array.isArray(t)&&e.length===t.length&&r<e.length)return t[r];throw new oY(`Unexpected parallel call result while executing step ${r}: '${t}'. Expected ${e.length} many items`)}async deferExecution(){await Promise.resolve(),await Promise.resolve()}},lH=(e,t)=>{if(e.stepName!==t.stepName)throw new oY(`Incompatible step name. Expected '${e.stepName}', got '${t.stepName}' from the request`);if(e.stepType!==t.stepType)throw new oY(`Incompatible step type. Expected '${e.stepType}', got '${t.stepType}' from the request`)},lW=(e,t)=>{try{for(let[r,a]of t.entries())lH(e[r],a)}catch(r){if(r instanceof oY){let a=e.map(e=>e.stepName),s=e.map(e=>e.stepType),n=t.map(e=>e.stepName),i=t.map(e=>e.stepType);throw new oY(`Incompatible steps detected in parallel execution: ${r.message}
  > Step Names from the request: ${JSON.stringify(n)}
    Step Types from the request: ${JSON.stringify(i)}
  > Step Names expected: ${JSON.stringify(a)}
    Step Types expected: ${JSON.stringify(s)}`)}throw r}},lz=e=>{let t=e=>e.targetStep||e.stepId;return[...e].sort((e,r)=>t(e)-t(r))},lJ=e=>{if(!e.provider)throw new oY("A Provider must be provided.");if("upstash"===e.provider.owner)throw new oY("Upstash provider isn't supported.");let{name:t,provider:r,...a}=e;if(!r.baseUrl)throw TypeError("baseUrl cannot be empty or undefined!");if(!r.token)throw TypeError("token cannot be empty or undefined!");if(r.apiKind!==t)throw TypeError(`Unexpected api name. Expected '${r.apiKind}', received ${t}`);let s={url:r.getUrl(),baseUrl:r.baseUrl,route:r.getRoute(),appendHeaders:r.getHeaders(a),owner:r.owner,method:r.method};return r.onFinish(s,a)},lZ=class{context;constructor({context:e}){this.context=e}async callApi(e,t){let{url:r,appendHeaders:a,method:s}=lJ(t.api),{method:n,body:i,headers:o={},retries:l=0,timeout:u}=t;return await this.context.call(e,{url:r,method:n??s,body:i,headers:{...a,...o},retries:l,timeout:u})}},lK=class extends lZ{async call(e,t){let{token:r,operation:a,...s}=t;return await this.callApi(e,{api:{name:"llm",provider:ty({token:r})},...s})}},lV=class extends lZ{async call(e,t){let{token:r,organization:a,operation:s,baseURL:n,...i}=t,o=void 0===n?tm({token:r,organization:a}):tg({baseUrl:n,token:r});return await this.callApi(e,{api:{name:"llm",provider:o},...i})}},lG=class extends lZ{async call(e,t){let{token:r,batch:a=!1,...s}=t;return await this.callApi(e,{api:{name:"email",provider:tZ({token:r,batch:a})},...s})}},lQ=class extends lZ{get openai(){return new lV({context:this.context})}get resend(){return new lG({context:this.context})}get anthropic(){return new lK({context:this.context})}},lY=e=>"disabled"in e,lX=class{name;tools;maxSteps;background;model;temparature;context;constructor({tools:e,maxSteps:t,background:r,name:a,model:s,temparature:n=.1},i){this.name=a,this.tools=e??{},this.maxSteps=t,this.background=r,this.model=s,this.temparature=n,this.context=i}async call({prompt:e}){try{return lY(this.context)&&await this.context.sleep("abort",0),{text:(await iO({model:this.model,tools:this.tools,maxSteps:this.maxSteps,system:this.background,prompt:e,headers:{[o2]:this.name},temperature:this.temparature})).text}}catch(e){if(e instanceof ip){if(e.cause instanceof Error&&"WorkflowAbort"===e.cause.name)throw e.cause;if(e.cause instanceof ip&&e.cause.cause instanceof Error&&"WorkflowAbort"===e.cause.cause.name)throw e.cause.cause}throw e}}asTool(){let e=Object.values(this.tools).map(e=>e.description).join("\n");return{parameters:sy({prompt:su()}),execute:async({prompt:e})=>await this.call({prompt:e}),description:`An AI Agent with the following background: ${this.background}Has access to the following tools: ${e}`}}},l0=class extends lX{agents;constructor({agents:e,background:t=o4,model:r,maxSteps:a,name:s="manager llm"},n){super({background:t,maxSteps:a,tools:Object.fromEntries(e.map(e=>[e.name,e.asTool()])),name:s,model:r},n),this.agents=e}},l1=class{context;taskParameters;constructor({context:e,taskParameters:t}){this.context=e,this.taskParameters=t}async run(){let{prompt:e,...t}=this.taskParameters;if("agent"in t){let r=t.agent;return{text:(await r.call({prompt:e})).text}}{let{agents:r,maxSteps:a,model:s,background:n}=t,i=new l0({model:s,maxSteps:a,agents:r,name:"Manager LLM",background:n},this.context);return{text:(await i.call({prompt:e})).text}}}},l2=class{context;constructor({context:e}){this.context=e}agent(e){let t=o5({context:this.context,tools:e.tools});return new lX({...e,tools:t},this.context)}task(e){return new l1({context:this.context,taskParameters:e})}openai(...e){let[t,r]=e,{baseURL:a,apiKey:s,callSettings:n,...i}=r??{};return this.AISDKModel({context:this.context,provider:oH,providerParams:{baseURL:a,apiKey:s,compatibility:"strict"},agentCallParams:n})(t,i)}AISDKModel=o6},l4=class{executor;steps;qstashClient;workflowRunId;url;failureUrl;requestPayload;headers;env;retries;flowControl;constructor({qstashClient:e,workflowRunId:t,headers:r,steps:a,url:s,failureUrl:n,debug:i,initialPayload:o,env:l,retries:u,telemetry:c,invokeCount:d,flowControl:p}){this.qstashClient=e,this.workflowRunId=t,this.steps=a,this.url=s,this.failureUrl=n,this.headers=r,this.requestPayload=o,this.env=l??{},this.retries=u??3,this.flowControl=p,this.executor=new lL(this,this.steps,c,d,i)}async run(e,t){return await this.addStep(new lA(e,()=>this.executor.wrapStep(e,t)))}async sleep(e,t){await this.addStep(new lR(e,t))}async sleepUntil(e,t){let r;r="number"==typeof t?t:Math.round((t="string"==typeof t?new Date(t):t).getTime()/1e3),await this.addStep(new lN(e,r))}async call(e,t){let r;if("workflow"in t)r=new lO(e,o7(this.url,t.workflow.workflowId),"POST",t.body,t.headers||{},t.retries||0,t.timeout,t.flowControl??t.workflow.options.flowControl);else{let{url:a,method:s="GET",body:n,headers:i={},retries:o=0,timeout:l,flowControl:u}=t;r=new lO(e,a,s,n,i,o,l,u)}return await this.addStep(r)}async waitForEvent(e,t,r={}){let{timeout:a="7d"}=r,s="string"==typeof a?a:`${a}s`;return await this.addStep(new lP(e,t,s))}async notify(e,t,r){return await this.addStep(new lU(e,t,r,this.qstashClient.http))}async invoke(e,t){return await this.addStep(new l$(e,t))}async cancel(){throw new oX("cancel",void 0,!0)}async addStep(e){return await this.executor.addStep(e)}get api(){return new lQ({context:this})}get agents(){return new l2({context:this})}},l8=["DEBUG","INFO","SUBMIT","WARN","ERROR"],l6=class e{logs=[];options;workflowRunId=void 0;constructor(e){this.options=e}async log(e,t,r){if(this.shouldLog(e)){let a={timestamp:Date.now(),workflowRunId:this.workflowRunId??"",logLevel:e,eventType:t,details:r};this.logs.push(a),"console"===this.options.logOutput&&this.writeToConsole(a),await new Promise(e=>setTimeout(e,100))}}setWorkflowRunId(e){this.workflowRunId=e}writeToConsole(e){("ERROR"===e.logLevel?console.error:"WARN"===e.logLevel?console.warn:console.log)(JSON.stringify(e,void 0,2))}shouldLog(e){return l8.indexOf(e)>=l8.indexOf(this.options.logLevel)}static getLogger(t){return"object"==typeof t?t:t?new e({logLevel:"INFO",logOutput:"console"}):void 0}},l5=class e extends l4{static disabledMessage="disabled-qstash-worklfow-run";disabled=!0;async addStep(t){throw new oX(e.disabledMessage)}async cancel(){}static async tryAuthentication(t,r){let a=new e({qstashClient:new tN({baseUrl:"disabled-client",token:"disabled-client"}),workflowRunId:r.workflowRunId,headers:r.headers,steps:[],url:r.url,failureUrl:r.failureUrl,initialPayload:r.requestPayload,env:r.env,retries:r.retries,flowControl:r.flowControl});try{await t(a)}catch(e){if(e instanceof oX&&e.stepName===this.disabledMessage)return lg("step-found");return lx(e)}return lg("run-ended")}},l3=async e=>{try{return await e.text()}catch{return}},l9=e=>{let[t,...r]=e,a=li(t.body),s=[{stepId:0,stepName:"init",stepType:"Initial",out:a,concurrent:1},...r.filter(e=>"step"===e.callType).map(e=>{let t=JSON.parse(li(e.body));if(t.waitEventId){let e={eventData:t.out?li(t.out):void 0,timeout:t.waitTimeout??!1};t.out=e}return t})];return{rawInitialPayload:a,steps:s}},l7=e=>{let t=[],r=[],a=[];for(let s of e)0===s.stepId?t.includes(s.targetStep??0)||(a.push(s),t.push(s.targetStep??0)):r.includes(s.stepId)||(a.push(s),r.push(s.stepId));return a},ue=async(e,t)=>{if(e.length<2)return!1;let r=e.at(-1),a=r.stepId,s=r.targetStep;for(let r=0;r<e.length-1;r++){let n=e[r];if(n.stepId===a&&n.targetStep===s){let e=`Upstash Workflow: The step '${n.stepName}' with id '${n.stepId}'  has run twice during workflow execution. Rest of the workflow will continue running as usual.`;return await t?.log("WARN","RESPONSE_DEFAULT",e),console.warn(e),!0}}return!1},ut=e=>{let t=e.headers.get(oG),r=!t;if(!r&&"1"!==t)throw new oY(`Incompatible workflow sdk protocol version. Expected 1, got ${t} from the request.`);let a=r?ln():e.headers.get(oW)??"";if(0===a.length)throw new oY("Couldn't get workflow id from header");return{isFirstInvocation:r,workflowRunId:a}},ur=async(e,t,r,a,s,n)=>{if(t)return{rawInitialPayload:e??"",steps:[],isLastDuplicate:!1,workflowRunEnded:!1};{let t;if(e)t=JSON.parse(e);else{await n?.log("INFO","ENDPOINT_START","request payload is empty, steps will be fetched from QStash.");let{steps:e,workflowRunEnded:i}=await la(a,r,s,n);if(i)return{rawInitialPayload:void 0,steps:void 0,isLastDuplicate:void 0,workflowRunEnded:!0};t=e}let{rawInitialPayload:i,steps:o}=l9(t),l=await ue(o,n);return{rawInitialPayload:i,steps:l7(o),isLastDuplicate:l,workflowRunEnded:!1}}},ua=async(e,t,r,a,s,n,i,o,l,u)=>{if("true"!==e.headers.get(oZ))return lg("not-failure-callback");if(!n)return lx(new oY("Workflow endpoint is called to handle a failure, but a failureFunction is not provided in serve options. Either provide a failureUrl or a failureFunction."));try{let{status:c,header:d,body:p,url:h,sourceBody:f,workflowRunId:m}=JSON.parse(t),y=p?li(p):"{}",g=JSON.parse(y),x=new l4({qstashClient:r,workflowRunId:m,initialPayload:f?a(li(f)):void 0,headers:lS(e.headers),steps:[],url:h,failureUrl:h,debug:u,env:i,retries:o,flowControl:l,telemetry:void 0}),v=await l5.tryAuthentication(s,x);if(v.isErr())throw await u?.log("ERROR","ERROR",{error:v.error.message}),v.error;if("run-ended"===v.value)return lx(new oY("Not authorized to run the failure function."));await n({context:x,failStatus:c,failResponse:g.message,failHeaders:d})}catch(e){return lx(e)}return lg("is-failure-callback")},us=e=>{let t=e?.env??("undefined"==typeof process?{}:process.env),r=!!(t.QSTASH_CURRENT_SIGNING_KEY&&t.QSTASH_NEXT_SIGNING_KEY);return{qstashClient:new tN({baseUrl:t.QSTASH_URL,token:t.QSTASH_TOKEN}),onStepFinish:(e,t)=>"auth-fail"===t?(console.error(ui),new Response(JSON.stringify({message:ui,workflowRunId:e}),{status:400})):new Response(JSON.stringify({workflowRunId:e}),{status:200}),initialPayloadParser:t=>{if(t)try{let r=JSON.parse(t);return e?.schema?e.schema.parse(r):r}catch(e){if(e instanceof SyntaxError)return t;throw e}},receiver:r?new te({currentSigningKey:t.QSTASH_CURRENT_SIGNING_KEY,nextSigningKey:t.QSTASH_NEXT_SIGNING_KEY}):void 0,baseUrl:t.UPSTASH_WORKFLOW_URL,env:t,retries:3,useJSONContent:!1,disableTelemetry:!1,onError:console.error,...e}},un=async(e,t,r,a,s,n)=>{let i=t??e.url,o=r?i.replace(/^(https?:\/\/[^/]+)(\/.*)?$/,(e,t,a)=>r+(a||"")):i;o!==i&&await n?.log("WARN","ENDPOINT_START",{warning:`Upstash Workflow: replacing the base of the url with "${r}" and using it as workflow endpoint.`,originalURL:i,updatedURL:o});let l=a?o:s;if(o.includes("localhost")&&await n?.log("WARN","ENDPOINT_START",{message:`Workflow URL contains localhost. This can happen in local development, but shouldn't happen in production unless you have a route which contains localhost. Received: ${o}`}),!(o.startsWith("http://")||o.startsWith("https://")))throw new oY(`Workflow URL should start with 'http://' or 'https://'. Recevied is '${o}'`);return{workflowUrl:o,workflowFailureUrl:l}},ui="Failed to authenticate Workflow request. If this is unexpected, see the caveat https://upstash.com/docs/workflow/basics/caveats#avoid-non-deterministic-code-outside-context-run",uo=(e,t,r)=>{let{qstashClient:a,onStepFinish:s,initialPayloadParser:n,url:i,verbose:o,receiver:l,failureUrl:u,failureFunction:c,baseUrl:d,env:p,retries:h,useJSONContent:f,disableTelemetry:m,flowControl:y,onError:g}=us(r);t=m?void 0:t;let x=l6.getLogger(o),v=async r=>{await x?.log("INFO","ENDPOINT_START");let{workflowUrl:o,workflowFailureUrl:m}=await un(r,i,d,c,u,x),g=await l3(r)??"";await lI(g,r.headers.get("upstash-signature"),l);let{isFirstInvocation:v,workflowRunId:w}=ut(r);x?.setWorkflowRunId(w);let{rawInitialPayload:b,steps:_,isLastDuplicate:k,workflowRunEnded:S}=await ur(g,v,w,a.http,r.headers.get("upstash-message-id"),x);if(S)return s(w,"workflow-already-ended");if(k)return s(w,"duplicate-step");let T=await ua(r,g,a,n,e,c,p,h,y,x);if(T.isErr())throw T.error;if("is-failure-callback"===T.value)return await x?.log("WARN","RESPONSE_DEFAULT","failureFunction executed"),s(w,"failure-callback");let E=Number(r.headers.get(oV)??"0"),I=new l4({qstashClient:a,workflowRunId:w,initialPayload:n(b),headers:lS(r.headers),steps:_,url:o,failureUrl:m,debug:x,env:p,retries:h,telemetry:t,invokeCount:E,flowControl:y}),C=await l5.tryAuthentication(e,I);if(C.isErr())throw await x?.log("ERROR","ERROR",{error:C.error.message}),C.error;if("run-ended"===C.value)return await x?.log("ERROR","ERROR",{error:ui}),s(v?"no-workflow-id":I.workflowRunId,"auth-fail");let A=await lT({request:r,requestPayload:b,client:a,workflowUrl:o,failureUrl:m,retries:h,flowControl:y,telemetry:t,debug:x});if(A.isErr())throw await x?.log("ERROR","SUBMIT_THIRD_PARTY_RESULT",{error:A.error.message}),A.error;if("continue-workflow"===A.value){let r=v?await lb({workflowContext:I,useJSONContent:f,telemetry:t,debug:x,invokeCount:E}):await l_({onStep:async()=>e(I),onCleanup:async e=>{await lk(I,e,x)},onCancel:async()=>{await lr(I.qstashClient.http,w)},debug:x});if(r.isErr())throw await x?.log("ERROR","ERROR",{error:r.error.message}),r.error;return await x?.log("INFO","RESPONSE_WORKFLOW"),s(I.workflowRunId,"success")}return"workflow-ended"===A.value?s(I.workflowRunId,"workflow-already-ended"):(await x?.log("INFO","RESPONSE_DEFAULT"),s("no-workflow-id","fromCallback"))};return{handler:async e=>{try{return await v(e)}catch(t){let e=o0(t);try{g?.(t)}catch(a){let t=o0(a),r=`Error while running onError callback: '${t.message}'.
Original error: '${e.message}'`;return console.error(r),new Response(r,{status:500})}return new Response(JSON.stringify(e),{status:500})}}}},ul={sdk:oQ,framework:"nextjs",runtime:`node@${process.version}`},uu=(process.versions.bun?(process.versions.bun,process.version):process.version,r(17611)),uc=r(16726),ud=r(47579),up=class{client;constructor(e){e?.token||console.error("QStash token is required for Upstash Workflow!\n\nTo fix this:\n1. Get your token from the Upstash Console (https://console.upstash.com/qstash)\n2. Initialize the workflow client with:\n\n   const client = new Client({\n     token: '<YOUR_QSTASH_TOKEN>'\n   });"),this.client=new tN(e)}async cancel({ids:e,urlStartingWith:t,all:r}){let a;if(e)a=JSON.stringify({workflowRunIds:"string"==typeof e?[e]:e});else if(t)a=JSON.stringify({workflowUrl:t});else if(r)a="{}";else throw TypeError("The `cancel` method cannot be called without any options.");return await this.client.http.request({path:["v2","workflows","runs"],method:"DELETE",body:a,headers:{"Content-Type":"application/json"}})}async notify({eventId:e,eventData:t}){return await le(this.client.http,e,t)}async getWaiters({eventId:e}){return await lt(this.client.http,e)}async trigger(e){let t=Array.isArray(e),r=(t?e:[e]).map(e=>{let t=e.useFailureFunction?e.url:e.failureUrl,r=ln(e.workflowRunId);return{workflowContext:new l4({qstashClient:this.client,headers:new Headers(e.headers??{}),initialPayload:e.body,steps:[],url:e.url,workflowRunId:r,retries:e.retries,telemetry:void 0,flowControl:e.flowControl,failureUrl:t}),telemetry:void 0,delay:e.delay}}),a=await lb(r),s=r.map(e=>e.workflowContext.workflowRunId);if(a.isOk())return t?s.map(e=>({workflowRunId:e})):{workflowRunId:s[0]};throw a.error}async logs(e){let{workflowRunId:t,cursor:r,count:a,state:s,workflowUrl:n,workflowCreatedAt:i}=e??{},o=new URLSearchParams({groupBy:"workflowRunId"});return t&&o.append("workflowRunId",t),r&&o.append("cursor",r),a&&o.append("count",a.toString()),s&&o.append("state",s),n&&o.append("workflowUrl",n),i&&o.append("workflowCreatedAt",i.toString()),await this.client.http.request({path:["v2","workflows",`events?${o.toString()}`]})}},uh=r(96725);new up({baseUrl:uh.A.env.upstash.qstashUrl,token:uh.A.env.upstash.qstashToken});let uf=new tN({token:uh.A.env.upstash.qstashToken}),um=async({email:e,subject:t,message:r})=>{await uf.publishJSON({api:{name:"email",provider:tZ({token:uh.A.env.resendToken})},body:{from:"JS Mastery <contact@adrianjsmastery.com>",to:[e],subject:t,html:r}})},uy=async e=>{let t=await uu.db.select().from(uc.VV).where((0,ud.eq)(uc.VV.email,e)).limit(1);if(0===t.length)return"non-active";let r=new Date(t[0].lastActivityDate),a=new Date().getTime()-r.getTime();return a>2592e5&&a<=2592e6?"non-active":"active"},{POST:ug}=((e,t)=>{let{handler:r}=uo(e,ul,t);return{POST:async e=>await r(e)}})(async e=>{let{email:t,fullName:r}=e.requestPayload;for(await e.run("new-signup",async()=>{await um({email:t,subject:"Welcome to the platform",message:`Welcome ${r}!`})}),await e.sleep("wait-for-3-days",259200);;){let a=await e.run("check-user-state",async()=>await uy(t));"non-active"===a?await e.run("send-email-non-active",async()=>{await um({email:t,subject:"Are you still there?",message:`Hey ${r}, we miss you!`})}):"active"===a&&await e.run("send-email-active",async()=>{await um({email:t,subject:"Welcome back!",message:`Welcome back ${r}!`})}),await e.sleep("wait-for-1-month",2592e3)}}),ux=new q.AppRouteRouteModule({definition:{kind:D.RouteKind.APP_ROUTE,page:"/api/workflows/onboarding/route",pathname:"/api/workflows/onboarding",filename:"route",bundlePath:"app/api/workflows/onboarding/route"},resolvedPagePath:"C:\\Users\\USER\\Desktop\\WORK\\new_creation\\app\\api\\workflows\\onboarding\\route.ts",nextConfigOutput:"",userland:F}),{workAsyncStorage:uv,workUnitAsyncStorage:uw,serverHooks:ub}=ux;function u_(){return(0,L.patchFetch)({workAsyncStorage:uv,workUnitAsyncStorage:uw})}},96487:()=>{},78335:()=>{},17611:(e,t,r)=>{"use strict";r.d(t,{db:()=>i});var a=r(96725),s=r(57980);let n=(0,r(12042).lw)(a.A.env.databaseUrl),i=(0,s.fd)(n)},16726:(e,t,r)=>{"use strict";r.d(t,{VV:()=>f,b7:()=>m});var a=r(19357),s=r(86556),n=r(60011),i=r(99063),o=r(44799),l=r(46964),u=r(32590),c=r(9848);let d=(0,a.rL)("status",["PENDING","APPROVED","REJECTED"]),p=(0,a.rL)("role",["USER","ADMIN"]),h=(0,a.rL)("borrow_status",["BORROWED","RETURNED"]),f=(0,s.cJ)("users",{id:(0,n.uR)("id").notNull().primaryKey().defaultRandom().unique(),fullName:(0,i.yf)("full_name",{length:255}).notNull(),email:(0,o.Qq)("email").notNull().unique(),password:(0,o.Qq)("password").notNull(),status:d("status").default("PENDING"),role:p("role").default("USER"),lastActivityDate:(0,l.p6)("last_activity_date").defaultNow(),createdAt:(0,u.vE)("created_at",{withTimezone:!0}).defaultNow()}),m=(0,s.cJ)("books",{id:(0,n.uR)("id").notNull().primaryKey().defaultRandom().unique(),title:(0,i.yf)("title",{length:255}).notNull(),author:(0,i.yf)("author",{length:255}).notNull(),genre:(0,o.Qq)("genre").notNull(),rating:(0,c.nd)("rating").notNull(),coverUrl:(0,o.Qq)("cover_url").notNull(),coverColor:(0,i.yf)("cover_color",{length:7}).notNull(),description:(0,o.Qq)("description").notNull(),totalCopies:(0,c.nd)("total_copies").notNull().default(1),availableCopies:(0,c.nd)("available_copies").notNull().default(0),videoUrl:(0,o.Qq)("video_url").notNull(),summary:(0,i.yf)("summary").notNull(),createdAt:(0,u.vE)("created_at",{withTimezone:!0}).defaultNow()});(0,s.cJ)("borrow_records",{id:(0,n.uR)("id").notNull().primaryKey().defaultRandom().unique(),userId:(0,n.uR)("user_id").references(()=>f.id).notNull(),bookId:(0,n.uR)("book_id").references(()=>m.id).notNull(),borrowDate:(0,u.vE)("borrow_date",{withTimezone:!0}).defaultNow().notNull(),dueDate:(0,l.p6)("due_date").notNull(),returnDate:(0,l.p6)("return_date"),status:h("status").default("BORROWED").notNull(),createdAt:(0,u.vE)("created_at",{withTimezone:!0}).defaultNow()})},96725:(e,t,r)=>{"use strict";r.d(t,{A:()=>a});let a={env:{apiEndpoint:"HTTP://LOCALHOST:3000",prodApiEndpoint:process.env.NEXT_PUBLIC_PROD_API_ENDPOINT,imagekit:{publicKey:"public_BtS+r9Vnb8MycIO2ZwDml3Hga3s=",urlEndpoint:"https://ik.imagekit.io/newCreation",privateKey:process.env.IMAGEKIT_PRIVATE_KEY},databaseUrl:process.env.DATABASE_URL,upstash:{redisUrl:process.env.UPSTASH_REDIS_URL,redisToken:process.env.UPSTASH_REDIS_TOKEN,qstashUrl:process.env.QSTASH_URL,qstashToken:process.env.QSTASH_TOKEN},resendToken:process.env.RESEND_TOKEN}}},15903:function(e,t,r){var a;a=function(e){var t,r,a,s,n,i,o,l,u,c,d,p,h,f;return t=e.lib.BlockCipher,r=e.algo,a=[],s=[],n=[],i=[],o=[],l=[],u=[],c=[],d=[],p=[],function(){for(var e=[],t=0;t<256;t++)t<128?e[t]=t<<1:e[t]=t<<1^283;for(var r=0,h=0,t=0;t<256;t++){var f=h^h<<1^h<<2^h<<3^h<<4;f=f>>>8^255&f^99,a[r]=f,s[f]=r;var m=e[r],y=e[m],g=e[y],x=257*e[f]^0x1010100*f;n[r]=x<<24|x>>>8,i[r]=x<<16|x>>>16,o[r]=x<<8|x>>>24,l[r]=x;var x=0x1010101*g^65537*y^257*m^0x1010100*r;u[f]=x<<24|x>>>8,c[f]=x<<16|x>>>16,d[f]=x<<8|x>>>24,p[f]=x,r?(r=m^e[e[e[g^m]]],h^=e[e[h]]):r=h=1}}(),h=[0,1,2,4,8,16,32,64,128,27,54],f=r.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e,t=this._keyPriorReset=this._key,r=t.words,s=t.sigBytes/4,n=((this._nRounds=s+6)+1)*4,i=this._keySchedule=[],o=0;o<n;o++)o<s?i[o]=r[o]:(e=i[o-1],o%s?s>6&&o%s==4&&(e=a[e>>>24]<<24|a[e>>>16&255]<<16|a[e>>>8&255]<<8|a[255&e]):e=(a[(e=e<<8|e>>>24)>>>24]<<24|a[e>>>16&255]<<16|a[e>>>8&255]<<8|a[255&e])^h[o/s|0]<<24,i[o]=i[o-s]^e);for(var l=this._invKeySchedule=[],f=0;f<n;f++){var o=n-f;if(f%4)var e=i[o];else var e=i[o-4];f<4||o<=4?l[f]=e:l[f]=u[a[e>>>24]]^c[a[e>>>16&255]]^d[a[e>>>8&255]]^p[a[255&e]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,n,i,o,l,a)},decryptBlock:function(e,t){var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r,this._doCryptBlock(e,t,this._invKeySchedule,u,c,d,p,s);var r=e[t+1];e[t+1]=e[t+3],e[t+3]=r},_doCryptBlock:function(e,t,r,a,s,n,i,o){for(var l=this._nRounds,u=e[t]^r[0],c=e[t+1]^r[1],d=e[t+2]^r[2],p=e[t+3]^r[3],h=4,f=1;f<l;f++){var m=a[u>>>24]^s[c>>>16&255]^n[d>>>8&255]^i[255&p]^r[h++],y=a[c>>>24]^s[d>>>16&255]^n[p>>>8&255]^i[255&u]^r[h++],g=a[d>>>24]^s[p>>>16&255]^n[u>>>8&255]^i[255&c]^r[h++],x=a[p>>>24]^s[u>>>16&255]^n[c>>>8&255]^i[255&d]^r[h++];u=m,c=y,d=g,p=x}var m=(o[u>>>24]<<24|o[c>>>16&255]<<16|o[d>>>8&255]<<8|o[255&p])^r[h++],y=(o[c>>>24]<<24|o[d>>>16&255]<<16|o[p>>>8&255]<<8|o[255&u])^r[h++],g=(o[d>>>24]<<24|o[p>>>16&255]<<16|o[u>>>8&255]<<8|o[255&c])^r[h++],x=(o[p>>>24]<<24|o[u>>>16&255]<<16|o[c>>>8&255]<<8|o[255&d])^r[h++];e[t]=m,e[t+1]=y,e[t+2]=g,e[t+3]=x},keySize:8}),e.AES=t._createHelper(f),e.AES},e.exports=a(r(4549),r(9406),r(74876),r(80046),r(53797))},46368:function(e,t,r){var a;a=function(e){return function(){var t=e.lib.BlockCipher,r=e.algo;let a=[0x243f6a88,0x85a308d3,0x13198a2e,0x3707344,0xa4093822,0x299f31d0,0x82efa98,0xec4e6c89,0x452821e6,0x38d01377,0xbe5466cf,0x34e90c6c,0xc0ac29b7,0xc97c50dd,0x3f84d5b5,0xb5470917,0x9216d5d9,0x8979fb1b],s=[[0xd1310ba6,0x98dfb5ac,0x2ffd72db,0xd01adfb7,0xb8e1afed,0x6a267e96,0xba7c9045,0xf12c7f99,0x24a19947,0xb3916cf7,0x801f2e2,0x858efc16,0x636920d8,0x71574e69,0xa458fea3,0xf4933d7e,0xd95748f,0x728eb658,0x718bcd58,0x82154aee,0x7b54a41d,0xc25a59b5,0x9c30d539,0x2af26013,0xc5d1b023,0x286085f0,0xca417918,0xb8db38ef,0x8e79dcb0,0x603a180e,0x6c9e0e8b,0xb01e8a3e,0xd71577c1,0xbd314b27,0x78af2fda,0x55605c60,0xe65525f3,0xaa55ab94,0x57489862,0x63e81440,0x55ca396a,0x2aab10b6,0xb4cc5c34,0x1141e8ce,0xa15486af,0x7c72e993,0xb3ee1411,0x636fbc2a,0x2ba9c55d,0x741831f6,0xce5c3e16,0x9b87931e,0xafd6ba33,0x6c24cf5c,0x7a325381,0x28958677,0x3b8f4898,0x6b4bb9af,0xc4bfe81b,0x66282193,0x61d809cc,0xfb21a991,0x487cac60,0x5dec8032,0xef845d5d,0xe98575b1,0xdc262302,0xeb651b88,0x23893e81,0xd396acc5,0xf6d6ff3,0x83f44239,0x2e0b4482,0xa4842004,0x69c8f04a,0x9e1f9b5e,0x21c66842,0xf6e96c9a,0x670c9c61,0xabd388f0,0x6a51a0d2,0xd8542f68,0x960fa728,0xab5133a3,0x6eef0b6c,0x137a3be4,0xba3bf050,0x7efb2a98,0xa1f1651d,0x39af0176,0x66ca593e,0x82430e88,0x8cee8619,0x456f9fb4,0x7d84a5c3,0x3b8b5ebe,0xe06f75d8,0x85c12073,0x401a449f,0x56c16aa6,0x4ed3aa62,0x363f7706,0x1bfedf72,0x429b023d,0x37d0d724,0xd00a1248,0xdb0fead3,0x49f1c09b,0x75372c9,0x80991b7b,0x25d479d8,0xf6e8def7,0xe3fe501a,0xb6794c3b,0x976ce0bd,0x4c006ba,0xc1a94fb6,0x409f60c4,0x5e5c9ec2,0x196a2463,0x68fb6faf,0x3e6c53b5,0x1339b2eb,0x3b52ec6f,0x6dfc511f,0x9b30952c,0xcc814544,0xaf5ebd09,0xbee3d004,0xde334afd,0x660f2807,0x192e4bb3,0xc0cba857,0x45c8740f,0xd20b5f39,0xb9d3fbdb,0x5579c0bd,0x1a60320a,0xd6a100c6,0x402c7279,0x679f25fe,0xfb1fa3cc,0x8ea5e9f8,0xdb3222f8,0x3c7516df,0xfd616b15,0x2f501ec8,0xad0552ab,0x323db5fa,0xfd238760,0x53317b48,0x3e00df82,0x9e5c57bb,0xca6f8ca0,0x1a87562e,0xdf1769db,0xd542a8f6,0x287effc3,0xac6732c6,0x8c4f5573,0x695b27b0,0xbbca58c8,0xe1ffa35d,0xb8f011a0,0x10fa3d98,0xfd2183b8,0x4afcb56c,0x2dd1d35b,0x9a53e479,0xb6f84565,0xd28e49bc,0x4bfb9790,0xe1ddf2da,0xa4cb7e33,0x62fb1341,0xcee4c6e8,0xef20cada,0x36774c01,0xd07e9efe,0x2bf11fb4,0x95dbda4d,0xae909198,0xeaad8e71,0x6b93d5a0,0xd08ed1d0,0xafc725e0,0x8e3c5b2f,0x8e7594b7,0x8ff6e2fb,0xf2122b64,0x8888b812,0x900df01c,0x4fad5ea0,0x688fc31c,0xd1cff191,0xb3a8c1ad,0x2f2f2218,0xbe0e1777,0xea752dfe,0x8b021fa1,0xe5a0cc0f,0xb56f74e8,0x18acf3d6,0xce89e299,0xb4a84fe0,0xfd13e0b7,0x7cc43b81,0xd2ada8d9,0x165fa266,0x80957705,0x93cc7314,0x211a1477,0xe6ad2065,0x77b5fa86,0xc75442f5,0xfb9d35cf,0xebcdaf0c,0x7b3e89a0,0xd6411bd3,0xae1e7e49,2428461,0x2071b35e,0x226800bb,0x57b8e0af,0x2464369b,0xf009b91e,0x5563911d,0x59dfa6aa,0x78c14389,0xd95a537f,0x207d5ba2,0x2e5b9c5,0x83260376,0x6295cfa9,0x11c81968,0x4e734a41,0xb3472dca,0x7b14a94a,0x1b510052,0x9a532915,0xd60f573f,0xbc9bc6e4,0x2b60a476,0x81e67400,0x8ba6fb5,0x571be91f,0xf296ec6b,0x2a0dd915,0xb6636521,0xe7b9f9b6,0xff34052e,0xc5855664,0x53b02d5d,0xa99f8fa1,0x8ba4799,0x6e85076a],[0x4b7a70e9,0xb5b32944,0xdb75092e,0xc4192623,290971e4,0x49a7df7d,0x9cee60b8,0x8fedb266,0xecaa8c71,0x699a17ff,0x5664526c,0xc2b19ee1,0x193602a5,0x75094c29,0xa0591340,0xe4183a3e,0x3f54989a,0x5b429d65,0x6b8fe4d6,0x99f73fd6,0xa1d29c07,0xefe830f5,0x4d2d38e6,0xf0255dc1,0x4cdd2086,0x8470eb26,0x6382e9c6,0x21ecc5e,0x9686b3f,0x3ebaefc9,0x3c971814,0x6b6a70a1,0x687f3584,0x52a0e286,0xb79c5305,0xaa500737,0x3e07841c,0x7fdeae5c,0x8e7d44ec,0x5716f2b8,0xb03ada37,0xf0500c0d,0xf01c1f04,0x200b3ff,0xae0cf51a,0x3cb574b2,0x25837a58,0xdc0921bd,0xd19113f9,0x7ca92ff6,0x94324773,0x22f54701,0x3ae5e581,0x37c2dadc,0xc8b57634,0x9af3dda7,0xa9446146,0xfd0030e,0xecc8c73e,0xa4751e41,0xe238cd99,0x3bea0e2f,0x3280bba1,0x183eb331,0x4e548b38,0x4f6db908,0x6f420d03,0xf60a04bf,0x2cb81290,0x24977c79,0x5679b072,0xbcaf89af,0xde9a771f,0xd9930810,0xb38bae12,0xdccf3f2e,0x5512721f,0x2e6b7124,0x501adde6,0x9f84cd87,0x7a584718,0x7408da17,0xbc9f9abc,0xe94b7d8c,0xec7aec3a,0xdb851dfa,0x63094366,0xc464c3d2,0xef1c1847,0x3215d908,0xdd433b37,0x24c2ba16,0x12a14d43,0x2a65c451,0x50940002,0x133ae4dd,0x71dff89e,0x10314e55,0x81ac77d6,0x5f11199b,0x43556f1,0xd7a3c76b,0x3c11183b,0x5924a509,0xf28fe6ed,0x97f1fbfa,0x9ebabf2c,0x1e153c6e,0x86e34570,0xeae96fb1,0x860e5e0a,0x5a3e2ab3,0x771fe71c,0x4e3d06fa,0x2965dcb9,0x99e71d0f,0x803e89d6,0x5266c825,0x2e4cc978,0x9c10b36a,0xc6150eba,0x94e2ea78,0xa5fc3c53,0x1e0a2df4,0xf2f74ea7,0x361d2b3d,0x1939260f,0x19c27960,0x5223a708,0xf71312b6,0xebadfe6e,0xeac31f66,0xe3bc4595,0xa67bc883,0xb17f37d1,0x18cff28,0xc332ddef,0xbe6c5aa5,0x65582185,0x68ab9802,0xeecea50f,0xdb2f953b,0x2aef7dad,0x5b6e2f84,0x1521b628,0x29076170,0xecdd4775,0x619f1510,0x13cca830,0xeb61bd96,0x334fe1e,0xaa0363cf,0xb5735c90,0x4c70a239,0xd59e9e0b,0xcbaade14,0xeecc86bc,0x60622ca7,0x9cab5cab,0xb2f3846e,0x648b1eaf,0x19bdf0ca,0xa02369b9,0x655abb50,0x40685a32,0x3c2ab4b3,0x319ee9d5,0xc021b8f7,0x9b540b19,0x875fa099,0x95f7997e,0x623d7da8,0xf837889a,0x97e32d77,0x11ed935f,0x16681281,0xe358829,0xc7e61fd6,0x96dedfa1,0x7858ba99,0x57f584a5,0x1b227263,0x9b83c3ff,0x1ac24696,0xcdb30aeb,0x532e3054,0x8fd948e4,0x6dbc3128,0x58ebf2ef,0x34c6ffea,0xfe28ed61,0xee7c3c73,0x5d4a14d9,0xe864b7e3,0x42105d14,0x203e13e0,0x45eee2b6,0xa3aaabea,0xdb6c4f15,0xfacb4fd0,0xc742f442,0xef6abbb5,0x654f3b1d,0x41cd2105,0xd81e799e,0x86854dc7,0xe44b476a,0x3d816250,0xcf62a1f2,0x5b8d2646,0xfc8883a0,0xc1c7b6a3,0x7f1524c3,0x69cb7492,0x47848a0b,0x5692b285,0x95bbf00,0xad19489d,0x1462b174,0x23820e00,0x58428d2a,0xc55f5ea,0x1dadf43e,0x233f7061,0x3372f092,0x8d937e41,0xd65fecf1,0x6c223bdb,0x7cde3759,0xcbee7460,0x4085f2a7,0xce77326e,0xa6078084,0x19f8509e,0xe8efd855,0x61d99735,0xa969a7aa,0xc50c06c2,0x5a04abfc,0x800bcadc,0x9e447a2e,0xc3453484,0xfdd56705,0xe1e9ec9,0xdb73dbd3,0x105588cd,0x675fda79,0xe3674340,0xc5c43465,0x713e38d8,0x3d28f89e,0xf16dff20,0x153e21e7,0x8fb03d4a,0xe6e39f2b,0xdb83adf7],[0xe93d5a68,0x948140f7,0xf64c261c,0x94692934,0x411520f7,0x7602d4f7,0xbcf46b2e,0xd4a20068,0xd4082471,0x3320f46a,0x43b7d4b7,0x500061af,0x1e39f62e,0x97244546,0x14214f74,0xbf8b8840,0x4d95fc1d,0x96b591af,0x70f4ddd3,0x66a02f45,0xbfbc09ec,0x3bd9785,0x7fac6dd0,0x31cb8504,0x96eb27b3,0x55fd3941,0xda2547e6,0xabca0a9a,0x28507825,0x530429f4,0xa2c86da,0xe9b66dfb,0x68dc1462,0xd7486900,0x680ec0a4,0x27a18dee,0x4f3ffea2,0xe887ad8c,0xb58ce006,0x7af4d6b6,0xaace1e7c,0xd3375fec,0xce78a399,0x406b2a42,0x20fe9e35,0xd9f385b9,0xee39d7ab,0x3b124e8b,0x1dc9faf7,0x4b6d1856,0x26a36631,0xeae397b2,0x3a6efa74,0xdd5b4332,0x6841e7f7,0xca7820fb,0xfb0af54e,0xd8feb397,0x454056ac,0xba489527,0x55533a3a,0x20838d87,0xfe6ba9b7,0xd096954b,0x55a867bc,0xa1159a58,0xcca92963,0x99e1db33,0xa62a4a56,0x3f3125f9,0x5ef47e1c,0x9029317c,0xfdf8e802,0x4272f70,0x80bb155c,0x5282ce3,0x95c11548,0xe4c66d22,0x48c1133f,0xc70f86dc,0x7f9c9ee,0x41041f0f,0x404779a4,0x5d886e17,0x325f51eb,0xd59bc0d1,0xf2bcc18f,0x41113564,0x257b7834,0x602a9c60,0xdff8e8a3,0x1f636c1b,0xe12b4c2,0x2e1329e,0xaf664fd1,0xcad18115,0x6b2395e0,0x333e92e1,0x3b240b62,0xeebeb922,0x85b2a20e,0xe6ba0d99,0xde720c8c,0x2da2f728,0xd0127845,0x95b794fd,0x647d0862,0xe7ccf5f0,0x5449a36f,0x877d48fa,0xc39dfd27,0xf33e8d1e,0xa476341,0x992eff74,0x3a6f6eab,0xf4f8fd37,0xa812dc60,0xa1ebddf8,0x991be14c,0xdb6e6b0d,0xc67b5510,0x6d672c37,0x2765d43b,0xdcd0e804,0xf1290dc7,0xcc00ffa3,0xb5390f92,0x690fed0b,0x667b9ffb,0xcedb7d9c,0xa091cf0b,0xd9155ea3,0xbb132f88,0x515bad24,0x7b9479bf,0x763bd6eb,0x37392eb3,0xcc115979,0x8026e297,0xf42e312d,0x6842ada7,0xc66a2b3b,0x12754ccc,0x782ef11c,0x6a124237,0xb79251e7,0x6a1bbe6,0x4bfb6350,0x1a6b1018,0x11caedfa,0x3d25bdd8,0xe2e1c3c9,0x44421659,0xa121386,0xd90cec6e,0xd5abea2a,0x64af674e,0xda86a85f,0xbebfe988,0x64e4c3fe,0x9dbc8057,0xf0f7c086,0x60787bf8,0x6003604d,0xd1fd8346,0xf6381fb0,0x7745ae04,0xd736fccc,0x83426b33,0xf01eab71,0xb0804187,0x3c005e5f,0x77a057be,0xbde8ae24,0x55464299,0xbf582e61,0x4e58f48f,0xf2ddfda2,0xf474ef38,0x8789bdc2,0x5366f9c3,0xc8b38e74,0xb475f255,0x46fcd9b9,0x7aeb2661,0x8b1ddf84,0x846a0e79,0x915f95e2,0x466e598e,0x20b45770,0x8cd55591,0xc902de4c,0xb90bace1,0xbb8205d0,0x11a86248,0x7574a99e,0xb77f19b6,0xe0a9dc09,0x662d09a1,0xc4324633,0xe85a1f02,0x9f0be8c,0x4a99a025,0x1d6efe10,0x1ab93d1d,0xba5a4df,0xa186f20f,0x2868f169,0xdcb7da83,0x573906fe,0xa1e2ce9b,0x4fcd7f52,0x50115e01,0xa70683fa,0xa002b5c4,0xde6d027,0x9af88c27,0x773f8641,0xc3604c06,0x61a806b5,0xf0177a28,0xc0f586e0,6314154,0x30dc7d62,0x11e69ed7,0x2338ea63,0x53c2dd94,0xc2c21634,0xbbcbee56,0x90bcb6de,0xebfc7da1,0xce591d76,0x6f05e409,0x4b7c0188,0x39720a3d,0x7c927c24,0x86e3725f,0x724d9db9,0x1ac15bb4,0xd39eb8fc,0xed545578,0x8fca5b5,0xd83d7cd3,0x4dad0fc4,0x1e50ef5e,0xb161e6f8,0xa28514d9,0x6c51133c,0x6fd5c7e7,0x56e14ec4,0x362abfce,0xddc6c837,0xd79a3234,0x92638212,0x670efa8e,0x406000e0],[0x3a39ce37,0xd3faf5cf,0xabc27737,0x5ac52d1b,0x5cb0679e,0x4fa33742,0xd3822740,0x99bc9bbe,0xd5118e9d,0xbf0f7315,0xd62d1c7e,0xc700c47b,0xb78c1b6b,0x21a19045,0xb26eb1be,0x6a366eb4,0x5748ab2f,0xbc946e79,0xc6a376d2,0x6549c2c8,0x530ff8ee,0x468dde7d,0xd5730a1d,0x4cd04dc6,0x2939bbdb,0xa9ba4650,0xac9526e8,0xbe5ee304,0xa1fad5f0,0x6a2d519a,0x63ef8ce2,0x9a86ee22,0xc089c2b8,0x43242ef6,0xa51e03aa,0x9cf2d0a4,0x83c061ba,0x9be96a4d,0x8fe51550,0xba645bd6,0x2826a2f9,0xa73a3ae1,0x4ba99586,0xef5562e9,0xc72fefd3,0xf752f7da,0x3f046f69,0x77fa0a59,0x80e4a915,0x87b08601,0x9b09e6ad,0x3b3ee593,0xe990fd5a,0x9e34d797,0x2cf0b7d9,0x22b8b51,0x96d5ac3a,0x17da67d,0xd1cf3ed6,0x7c7d2d28,0x1f9f25cf,0xadf2b89b,0x5ad6b472,0x5a88f54c,0xe029ac71,0xe019a5e6,0x47b0acfd,0xed93fa9b,0xe8d3c48d,0x283b57cc,0xf8d56629,0x79132e28,0x785f0191,0xed756055,0xf7960e44,0xe3d35e8c,0x15056dd4,0x88f46dba,0x3a16125,0x564f0bd,0xc3eb9e15,0x3c9057a2,0x97271aec,0xa93a072a,0x1b3f6d9b,0x1e6321f5,0xf59c66fb,0x26dcf319,0x7533d928,0xb155fdf5,0x3563482,0x8aba3cbb,0x28517711,0xc20ad9f8,0xabcc5167,0xccad925f,0x4de81751,0x3830dc8e,0x379d5862,0x9320f991,0xea7a90c2,0xfb3e7bce,0x5121ce64,0x774fbe32,0xa8b6e37e,0xc3293d46,0x48de5369,0x6413e680,0xa2ae0810,0xdd6db224,0x69852dfd,0x9072166,0xb39a460a,0x6445c0dd,0x586cdecf,0x1c20c8ae,0x5bbef7dd,0x1b588d40,0xccd2017f,0x6bb4e3bb,0xdda26a7e,0x3a59ff45,0x3e350a44,0xbcb4cdd5,0x72eacea8,0xfa6484bb,0x8d6612ae,0xbf3c6f47,0xd29be463,0x542f5d9e,0xaec2771b,0xf64e6370,0x740e0d8d,0xe75b1357,0xf8721671,0xaf537d5d,0x4040cb08,0x4eb4e2cc,0x34d2466a,0x115af84,3786409e3,0x95983a1d,0x6b89fb4,0xce6ea048,0x6f3f3b82,0x3520ab82,0x11a1d4b,0x277227f8,0x611560b1,0xe7933fdc,0xbb3a792b,0x344525bd,0xa08839e1,0x51ce794b,0x2f32c9b7,0xa01fbac9,0xe01cc87e,0xbcc7d1f6,0xcf0111c3,0xa1e8aac7,0x1a908749,0xd44fbd9a,0xd0dadecb,0xd50ada38,0x339c32a,0xc6913667,0x8df9317c,0xe0b12b4f,0xf79e59b7,0x43f5bb3a,0xf2d519ff,0x27d9459c,0xbf97222c,0x15e6fc2a,0xf91fc71,0x9b941525,0xfae59361,0xceb69ceb,0xc2a86459,0x12baa8d1,0xb6c1075e,0xe3056a0c,0x10d25065,0xcb03a442,0xe0ec6e0e,0x1698db3b,0x4c98a0be,0x3278e964,0x9f1f9532,0xe0d392df,0xd3a0342b,0x8971f21e,0x1b0a7441,0x4ba3348c,0xc5be7120,0xc37632d8,0xdf359f8d,0x9b992f2e,0xe60b6f47,0xfe3f11d,0xe54cda54,0x1edad891,0xce6279cf,0xcd3e7e6f,0x1618b166,0xfd2c1d05,0x848fd2c5,0xf6fb2299,0xf523f357,0xa6327623,0x93a83531,0x56cccd02,0xacf08162,0x5a75ebb5,0x6e163697,0x88d273cc,0xde966292,0x81b949d0,0x4c50901b,0x71c65614,0xe6c6c7bd,0x327a140a,0x45e1d006,0xc3f27b9a,0xc9aa53fd,0x62a80f00,0xbb25bfe2,0x35bdd2f6,0x71126905,0xb2040222,0xb6cbcf7c,0xcd769c2b,0x53113ec0,0x1640e3d3,0x38abbd60,0x2547adf0,0xba38209c,0xf746ce76,0x77afa1c5,0x20756060,0x85cbfe4e,0x8ae88dd8,0x7aaaf9b0,0x4cf9aa7e,0x1948c25c,0x2fb8a8c,0x1c36ae4,0xd6ebe1f9,0x90d4f869,0xa65cdea0,0x3f09252d,0xc208e69f,0xb74e6132,0xce77e25b,0x578fdfe3,0x3ac372e6]];var n={pbox:[],sbox:[]};function i(e,t){let r=e.sbox[0][t>>24&255]+e.sbox[1][t>>16&255];return r^=e.sbox[2][t>>8&255],r+=e.sbox[3][255&t]}function o(e,t,r){let a,s=t,n=r;for(let t=0;t<16;++t)s^=e.pbox[t],n=i(e,s)^n,a=s,s=n,n=a;return a=s,s=n,n=a^e.pbox[16],{left:s^=e.pbox[17],right:n}}var l=r.Blowfish=t.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var e=this._keyPriorReset=this._key;!function(e,t,r){for(let t=0;t<4;t++){e.sbox[t]=[];for(let r=0;r<256;r++)e.sbox[t][r]=s[t][r]}let n=0;for(let s=0;s<18;s++)e.pbox[s]=a[s]^t[n],++n>=r&&(n=0);let i=0,l=0,u=0;for(let t=0;t<18;t+=2)i=(u=o(e,i,l)).left,l=u.right,e.pbox[t]=i,e.pbox[t+1]=l;for(let t=0;t<4;t++)for(let r=0;r<256;r+=2)i=(u=o(e,i,l)).left,l=u.right,e.sbox[t][r]=i,e.sbox[t][r+1]=l}(n,e.words,e.sigBytes/4)}},encryptBlock:function(e,t){var r=o(n,e[t],e[t+1]);e[t]=r.left,e[t+1]=r.right},decryptBlock:function(e,t){var r=function(e,t,r){let a,s=t,n=r;for(let t=17;t>1;--t)s^=e.pbox[t],n=i(e,s)^n,a=s,s=n,n=a;return a=s,s=n,n=a^e.pbox[1],{left:s^=e.pbox[0],right:n}}(n,e[t],e[t+1]);e[t]=r.left,e[t+1]=r.right},blockSize:2,keySize:4,ivSize:2});e.Blowfish=t._createHelper(l)}(),e.Blowfish},e.exports=a(r(4549),r(9406),r(74876),r(80046),r(53797))},53797:function(e,t,r){var a;a=function(e){var t,r,a,s,n,i,o,l,u,c,d,p,h,f,m,y,g;e.lib.Cipher||(r=(t=e.lib).Base,a=t.WordArray,s=t.BufferedBlockAlgorithm,(n=e.enc).Utf8,i=n.Base64,o=e.algo.EvpKDF,l=t.Cipher=s.extend({cfg:r.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,r){this.cfg=this.cfg.extend(r),this._xformMode=e,this._key=t,this.reset()},reset:function(){s.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?g:m}return function(t){return{encrypt:function(r,a,s){return e(a).encrypt(t,r,a,s)},decrypt:function(r,a,s){return e(a).decrypt(t,r,a,s)}}}}()}),t.StreamCipher=l.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),u=e.mode={},c=t.BlockCipherMode=r.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),d=u.CBC=function(){var e=c.extend();function t(e,t,r){var a,s=this._iv;s?(a=s,this._iv=void 0):a=this._prevBlock;for(var n=0;n<r;n++)e[t+n]^=a[n]}return e.Encryptor=e.extend({processBlock:function(e,r){var a=this._cipher,s=a.blockSize;t.call(this,e,r,s),a.encryptBlock(e,r),this._prevBlock=e.slice(r,r+s)}}),e.Decryptor=e.extend({processBlock:function(e,r){var a=this._cipher,s=a.blockSize,n=e.slice(r,r+s);a.decryptBlock(e,r),t.call(this,e,r,s),this._prevBlock=n}}),e}(),p=(e.pad={}).Pkcs7={pad:function(e,t){for(var r=4*t,s=r-e.sigBytes%r,n=s<<24|s<<16|s<<8|s,i=[],o=0;o<s;o+=4)i.push(n);var l=a.create(i,s);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},t.BlockCipher=l.extend({cfg:l.cfg.extend({mode:d,padding:p}),reset:function(){l.reset.call(this);var e,t=this.cfg,r=t.iv,a=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=a.createEncryptor:(e=a.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,r&&r.words):(this._mode=e.call(a,this,r&&r.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),h=t.CipherParams=r.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),f=(e.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,r=e.salt;return(r?a.create([0x53616c74,0x65645f5f]).concat(r).concat(t):t).toString(i)},parse:function(e){var t,r=i.parse(e),s=r.words;return 0x53616c74==s[0]&&0x65645f5f==s[1]&&(t=a.create(s.slice(2,4)),s.splice(0,4),r.sigBytes-=16),h.create({ciphertext:r,salt:t})}},m=t.SerializableCipher=r.extend({cfg:r.extend({format:f}),encrypt:function(e,t,r,a){a=this.cfg.extend(a);var s=e.createEncryptor(r,a),n=s.finalize(t),i=s.cfg;return h.create({ciphertext:n,key:r,iv:i.iv,algorithm:e,mode:i.mode,padding:i.padding,blockSize:e.blockSize,formatter:a.format})},decrypt:function(e,t,r,a){return a=this.cfg.extend(a),t=this._parse(t,a.format),e.createDecryptor(r,a).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),y=(e.kdf={}).OpenSSL={execute:function(e,t,r,s,n){if(s||(s=a.random(8)),n)var i=o.create({keySize:t+r,hasher:n}).compute(e,s);else var i=o.create({keySize:t+r}).compute(e,s);var l=a.create(i.words.slice(t),4*r);return i.sigBytes=4*t,h.create({key:i,iv:l,salt:s})}},g=t.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:y}),encrypt:function(e,t,r,a){var s=(a=this.cfg.extend(a)).kdf.execute(r,e.keySize,e.ivSize,a.salt,a.hasher);a.iv=s.iv;var n=m.encrypt.call(this,e,t,s.key,a);return n.mixIn(s),n},decrypt:function(e,t,r,a){a=this.cfg.extend(a),t=this._parse(t,a.format);var s=a.kdf.execute(r,e.keySize,e.ivSize,t.salt,a.hasher);return a.iv=s.iv,m.decrypt.call(this,e,t,s.key,a)}}))},e.exports=a(r(4549),r(80046))},4549:function(e,t,r){var a;a=function(){var e=e||function(e,t){if("undefined"!=typeof window&&window.crypto&&(a=window.crypto),"undefined"!=typeof self&&self.crypto&&(a=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(a=globalThis.crypto),!a&&"undefined"!=typeof window&&window.msCrypto&&(a=window.msCrypto),!a&&"undefined"!=typeof global&&global.crypto&&(a=global.crypto),!a)try{a=r(55511)}catch(e){}var a,s=function(){if(a){if("function"==typeof a.getRandomValues)try{return a.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof a.randomBytes)try{return a.randomBytes(4).readInt32LE()}catch(e){}}throw Error("Native crypto module could not be used to get secure random number.")},n=Object.create||function(){function e(){}return function(t){var r;return e.prototype=t,r=new e,e.prototype=null,r}}(),i={},o=i.lib={},l=o.Base={extend:function(e){var t=n(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=o.WordArray=l.extend({init:function(e,r){e=this.words=e||[],t!=r?this.sigBytes=r:this.sigBytes=4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,r=e.words,a=this.sigBytes,s=e.sigBytes;if(this.clamp(),a%4)for(var n=0;n<s;n++){var i=r[n>>>2]>>>24-n%4*8&255;t[a+n>>>2]|=i<<24-(a+n)%4*8}else for(var o=0;o<s;o+=4)t[a+o>>>2]=r[o>>>2];return this.sigBytes+=s,this},clamp:function(){var t=this.words,r=this.sigBytes;t[r>>>2]&=0xffffffff<<32-r%4*8,t.length=e.ceil(r/4)},clone:function(){var e=l.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],r=0;r<e;r+=4)t.push(s());return new u.init(t,e)}}),c=i.enc={},d=c.Hex={stringify:function(e){for(var t=e.words,r=e.sigBytes,a=[],s=0;s<r;s++){var n=t[s>>>2]>>>24-s%4*8&255;a.push((n>>>4).toString(16)),a.push((15&n).toString(16))}return a.join("")},parse:function(e){for(var t=e.length,r=[],a=0;a<t;a+=2)r[a>>>3]|=parseInt(e.substr(a,2),16)<<24-a%8*4;return new u.init(r,t/2)}},p=c.Latin1={stringify:function(e){for(var t=e.words,r=e.sigBytes,a=[],s=0;s<r;s++){var n=t[s>>>2]>>>24-s%4*8&255;a.push(String.fromCharCode(n))}return a.join("")},parse:function(e){for(var t=e.length,r=[],a=0;a<t;a++)r[a>>>2]|=(255&e.charCodeAt(a))<<24-a%4*8;return new u.init(r,t)}},h=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(p.stringify(e)))}catch(e){throw Error("Malformed UTF-8 data")}},parse:function(e){return p.parse(unescape(encodeURIComponent(e)))}},f=o.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=h.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var r,a=this._data,s=a.words,n=a.sigBytes,i=this.blockSize,o=n/(4*i),l=(o=t?e.ceil(o):e.max((0|o)-this._minBufferSize,0))*i,c=e.min(4*l,n);if(l){for(var d=0;d<l;d+=i)this._doProcessBlock(s,d);r=s.splice(0,l),a.sigBytes-=c}return new u.init(r,c)},clone:function(){var e=l.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0});o.Hasher=f.extend({cfg:l.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,r){return new e.init(r).finalize(t)}},_createHmacHelper:function(e){return function(t,r){return new m.HMAC.init(e,r).finalize(t)}}});var m=i.algo={};return i}(Math);return e},e.exports=a()},9406:function(e,t,r){var a;a=function(e){var t;return t=e.lib.WordArray,e.enc.Base64={stringify:function(e){var t=e.words,r=e.sigBytes,a=this._map;e.clamp();for(var s=[],n=0;n<r;n+=3)for(var i=(t[n>>>2]>>>24-n%4*8&255)<<16|(t[n+1>>>2]>>>24-(n+1)%4*8&255)<<8|t[n+2>>>2]>>>24-(n+2)%4*8&255,o=0;o<4&&n+.75*o<r;o++)s.push(a.charAt(i>>>6*(3-o)&63));var l=a.charAt(64);if(l)for(;s.length%4;)s.push(l);return s.join("")},parse:function(e){var r=e.length,a=this._map,s=this._reverseMap;if(!s){s=this._reverseMap=[];for(var n=0;n<a.length;n++)s[a.charCodeAt(n)]=n}var i=a.charAt(64);if(i){var o=e.indexOf(i);-1!==o&&(r=o)}return function(e,r,a){for(var s=[],n=0,i=0;i<r;i++)if(i%4){var o=a[e.charCodeAt(i-1)]<<i%4*2|a[e.charCodeAt(i)]>>>6-i%4*2;s[n>>>2]|=o<<24-n%4*8,n++}return t.create(s,n)}(e,r,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},e.enc.Base64},e.exports=a(r(4549))},76045:function(e,t,r){var a;a=function(e){var t;return t=e.lib.WordArray,e.enc.Base64url={stringify:function(e,t){void 0===t&&(t=!0);var r=e.words,a=e.sigBytes,s=t?this._safe_map:this._map;e.clamp();for(var n=[],i=0;i<a;i+=3)for(var o=(r[i>>>2]>>>24-i%4*8&255)<<16|(r[i+1>>>2]>>>24-(i+1)%4*8&255)<<8|r[i+2>>>2]>>>24-(i+2)%4*8&255,l=0;l<4&&i+.75*l<a;l++)n.push(s.charAt(o>>>6*(3-l)&63));var u=s.charAt(64);if(u)for(;n.length%4;)n.push(u);return n.join("")},parse:function(e,r){void 0===r&&(r=!0);var a=e.length,s=r?this._safe_map:this._map,n=this._reverseMap;if(!n){n=this._reverseMap=[];for(var i=0;i<s.length;i++)n[s.charCodeAt(i)]=i}var o=s.charAt(64);if(o){var l=e.indexOf(o);-1!==l&&(a=l)}return function(e,r,a){for(var s=[],n=0,i=0;i<r;i++)if(i%4){var o=a[e.charCodeAt(i-1)]<<i%4*2|a[e.charCodeAt(i)]>>>6-i%4*2;s[n>>>2]|=o<<24-n%4*8,n++}return t.create(s,n)}(e,a,n)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"},e.enc.Base64url},e.exports=a(r(4549))},8251:function(e,t,r){var a;a=function(e){return function(){var t=e.lib.WordArray,r=e.enc;function a(e){return e<<8&0xff00ff00|e>>>8&0xff00ff}r.Utf16=r.Utf16BE={stringify:function(e){for(var t=e.words,r=e.sigBytes,a=[],s=0;s<r;s+=2){var n=t[s>>>2]>>>16-s%4*8&65535;a.push(String.fromCharCode(n))}return a.join("")},parse:function(e){for(var r=e.length,a=[],s=0;s<r;s++)a[s>>>1]|=e.charCodeAt(s)<<16-s%2*16;return t.create(a,2*r)}},r.Utf16LE={stringify:function(e){for(var t=e.words,r=e.sigBytes,s=[],n=0;n<r;n+=2){var i=a(t[n>>>2]>>>16-n%4*8&65535);s.push(String.fromCharCode(i))}return s.join("")},parse:function(e){for(var r=e.length,s=[],n=0;n<r;n++)s[n>>>1]|=a(e.charCodeAt(n)<<16-n%2*16);return t.create(s,2*r)}}}(),e.enc.Utf16},e.exports=a(r(4549))},80046:function(e,t,r){var a;a=function(e){var t,r,a,s,n,i;return r=(t=e.lib).Base,a=t.WordArray,n=(s=e.algo).MD5,i=s.EvpKDF=r.extend({cfg:r.extend({keySize:4,hasher:n,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r,s=this.cfg,n=s.hasher.create(),i=a.create(),o=i.words,l=s.keySize,u=s.iterations;o.length<l;){r&&n.update(r),r=n.update(e).finalize(t),n.reset();for(var c=1;c<u;c++)r=n.finalize(r),n.reset();i.concat(r)}return i.sigBytes=4*l,i}}),e.EvpKDF=function(e,t,r){return i.create(r).compute(e,t)},e.EvpKDF},e.exports=a(r(4549),r(40379),r(3505))},27561:function(e,t,r){var a;a=function(e){var t,r;return t=e.lib.CipherParams,r=e.enc.Hex,e.format.Hex={stringify:function(e){return e.ciphertext.toString(r)},parse:function(e){var a=r.parse(e);return t.create({ciphertext:a})}},e.format.Hex},e.exports=a(r(4549),r(53797))},3505:function(e,t,r){var a;a=function(e){var t,r;t=e.lib.Base,r=e.enc.Utf8,e.algo.HMAC=t.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=r.parse(t));var a=e.blockSize,s=4*a;t.sigBytes>s&&(t=e.finalize(t)),t.clamp();for(var n=this._oKey=t.clone(),i=this._iKey=t.clone(),o=n.words,l=i.words,u=0;u<a;u++)o[u]^=0x5c5c5c5c,l[u]^=0x36363636;n.sigBytes=i.sigBytes=s,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,r=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(r))}})},e.exports=a(r(4549))},15236:function(e,t,r){var a;a=function(e){return e},e.exports=a(r(4549),r(17376),r(70256),r(8251),r(9406),r(76045),r(74876),r(40379),r(49169),r(49076),r(76324),r(91821),r(86641),r(63648),r(3505),r(85975),r(80046),r(53797),r(35417),r(34991),r(72676),r(75261),r(17418),r(24537),r(80345),r(53742),r(40783),r(46668),r(27561),r(15903),r(3356),r(32713),r(22070),r(1632),r(46368))},70256:function(e,t,r){var a;a=function(e){return function(){if("function"==typeof ArrayBuffer){var t=e.lib.WordArray,r=t.init;(t.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var t=e.byteLength,a=[],s=0;s<t;s++)a[s>>>2]|=e[s]<<24-s%4*8;r.call(this,a,t)}else r.apply(this,arguments)}).prototype=t}}(),e.lib.WordArray},e.exports=a(r(4549))},74876:function(e,t,r){var a;a=function(e){return function(t){var r=e.lib,a=r.WordArray,s=r.Hasher,n=e.algo,i=[];!function(){for(var e=0;e<64;e++)i[e]=0x100000000*t.abs(t.sin(e+1))|0}();var o=n.MD5=s.extend({_doReset:function(){this._hash=new a.init([0x67452301,0xefcdab89,0x98badcfe,0x10325476])},_doProcessBlock:function(e,t){for(var r=0;r<16;r++){var a=t+r,s=e[a];e[a]=(s<<8|s>>>24)&0xff00ff|(s<<24|s>>>8)&0xff00ff00}var n=this._hash.words,o=e[t+0],p=e[t+1],h=e[t+2],f=e[t+3],m=e[t+4],y=e[t+5],g=e[t+6],x=e[t+7],v=e[t+8],w=e[t+9],b=e[t+10],_=e[t+11],k=e[t+12],S=e[t+13],T=e[t+14],E=e[t+15],I=n[0],C=n[1],A=n[2],R=n[3];I=l(I,C,A,R,o,7,i[0]),R=l(R,I,C,A,p,12,i[1]),A=l(A,R,I,C,h,17,i[2]),C=l(C,A,R,I,f,22,i[3]),I=l(I,C,A,R,m,7,i[4]),R=l(R,I,C,A,y,12,i[5]),A=l(A,R,I,C,g,17,i[6]),C=l(C,A,R,I,x,22,i[7]),I=l(I,C,A,R,v,7,i[8]),R=l(R,I,C,A,w,12,i[9]),A=l(A,R,I,C,b,17,i[10]),C=l(C,A,R,I,_,22,i[11]),I=l(I,C,A,R,k,7,i[12]),R=l(R,I,C,A,S,12,i[13]),A=l(A,R,I,C,T,17,i[14]),C=l(C,A,R,I,E,22,i[15]),I=u(I,C,A,R,p,5,i[16]),R=u(R,I,C,A,g,9,i[17]),A=u(A,R,I,C,_,14,i[18]),C=u(C,A,R,I,o,20,i[19]),I=u(I,C,A,R,y,5,i[20]),R=u(R,I,C,A,b,9,i[21]),A=u(A,R,I,C,E,14,i[22]),C=u(C,A,R,I,m,20,i[23]),I=u(I,C,A,R,w,5,i[24]),R=u(R,I,C,A,T,9,i[25]),A=u(A,R,I,C,f,14,i[26]),C=u(C,A,R,I,v,20,i[27]),I=u(I,C,A,R,S,5,i[28]),R=u(R,I,C,A,h,9,i[29]),A=u(A,R,I,C,x,14,i[30]),C=u(C,A,R,I,k,20,i[31]),I=c(I,C,A,R,y,4,i[32]),R=c(R,I,C,A,v,11,i[33]),A=c(A,R,I,C,_,16,i[34]),C=c(C,A,R,I,T,23,i[35]),I=c(I,C,A,R,p,4,i[36]),R=c(R,I,C,A,m,11,i[37]),A=c(A,R,I,C,x,16,i[38]),C=c(C,A,R,I,b,23,i[39]),I=c(I,C,A,R,S,4,i[40]),R=c(R,I,C,A,o,11,i[41]),A=c(A,R,I,C,f,16,i[42]),C=c(C,A,R,I,g,23,i[43]),I=c(I,C,A,R,w,4,i[44]),R=c(R,I,C,A,k,11,i[45]),A=c(A,R,I,C,E,16,i[46]),C=c(C,A,R,I,h,23,i[47]),I=d(I,C,A,R,o,6,i[48]),R=d(R,I,C,A,x,10,i[49]),A=d(A,R,I,C,T,15,i[50]),C=d(C,A,R,I,y,21,i[51]),I=d(I,C,A,R,k,6,i[52]),R=d(R,I,C,A,f,10,i[53]),A=d(A,R,I,C,b,15,i[54]),C=d(C,A,R,I,p,21,i[55]),I=d(I,C,A,R,v,6,i[56]),R=d(R,I,C,A,E,10,i[57]),A=d(A,R,I,C,g,15,i[58]),C=d(C,A,R,I,S,21,i[59]),I=d(I,C,A,R,m,6,i[60]),R=d(R,I,C,A,_,10,i[61]),A=d(A,R,I,C,h,15,i[62]),C=d(C,A,R,I,w,21,i[63]),n[0]=n[0]+I|0,n[1]=n[1]+C|0,n[2]=n[2]+A|0,n[3]=n[3]+R|0},_doFinalize:function(){var e=this._data,r=e.words,a=8*this._nDataBytes,s=8*e.sigBytes;r[s>>>5]|=128<<24-s%32;var n=t.floor(a/0x100000000);r[(s+64>>>9<<4)+15]=(n<<8|n>>>24)&0xff00ff|(n<<24|n>>>8)&0xff00ff00,r[(s+64>>>9<<4)+14]=(a<<8|a>>>24)&0xff00ff|(a<<24|a>>>8)&0xff00ff00,e.sigBytes=(r.length+1)*4,this._process();for(var i=this._hash,o=i.words,l=0;l<4;l++){var u=o[l];o[l]=(u<<8|u>>>24)&0xff00ff|(u<<24|u>>>8)&0xff00ff00}return i},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function l(e,t,r,a,s,n,i){var o=e+(t&r|~t&a)+s+i;return(o<<n|o>>>32-n)+t}function u(e,t,r,a,s,n,i){var o=e+(t&a|r&~a)+s+i;return(o<<n|o>>>32-n)+t}function c(e,t,r,a,s,n,i){var o=e+(t^r^a)+s+i;return(o<<n|o>>>32-n)+t}function d(e,t,r,a,s,n,i){var o=e+(r^(t|~a))+s+i;return(o<<n|o>>>32-n)+t}e.MD5=s._createHelper(o),e.HmacMD5=s._createHmacHelper(o)}(Math),e.MD5},e.exports=a(r(4549))},35417:function(e,t,r){var a;a=function(e){return e.mode.CFB=function(){var t=e.lib.BlockCipherMode.extend();function r(e,t,r,a){var s,n=this._iv;n?(s=n.slice(0),this._iv=void 0):s=this._prevBlock,a.encryptBlock(s,0);for(var i=0;i<r;i++)e[t+i]^=s[i]}return t.Encryptor=t.extend({processBlock:function(e,t){var a=this._cipher,s=a.blockSize;r.call(this,e,t,s,a),this._prevBlock=e.slice(t,t+s)}}),t.Decryptor=t.extend({processBlock:function(e,t){var a=this._cipher,s=a.blockSize,n=e.slice(t,t+s);r.call(this,e,t,s,a),this._prevBlock=n}}),t}(),e.mode.CFB},e.exports=a(r(4549),r(53797))},72676:function(e,t,r){var a;a=function(e){return e.mode.CTRGladman=function(){var t=e.lib.BlockCipherMode.extend();function r(e){if((e>>24&255)==255){var t=e>>16&255,r=e>>8&255,a=255&e;255===t?(t=0,255===r?(r=0,255===a?a=0:++a):++r):++t,e=0+(t<<16)+(r<<8)+a}else e+=0x1000000;return e}var a=t.Encryptor=t.extend({processBlock:function(e,t){var a,s=this._cipher,n=s.blockSize,i=this._iv,o=this._counter;i&&(o=this._counter=i.slice(0),this._iv=void 0),0===((a=o)[0]=r(a[0]))&&(a[1]=r(a[1]));var l=o.slice(0);s.encryptBlock(l,0);for(var u=0;u<n;u++)e[t+u]^=l[u]}});return t.Decryptor=a,t}(),e.mode.CTRGladman},e.exports=a(r(4549),r(53797))},34991:function(e,t,r){var a;a=function(e){var t,r;return e.mode.CTR=(r=(t=e.lib.BlockCipherMode.extend()).Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,a=r.blockSize,s=this._iv,n=this._counter;s&&(n=this._counter=s.slice(0),this._iv=void 0);var i=n.slice(0);r.encryptBlock(i,0),n[a-1]=n[a-1]+1|0;for(var o=0;o<a;o++)e[t+o]^=i[o]}}),t.Decryptor=r,t),e.mode.CTR},e.exports=a(r(4549),r(53797))},17418:function(e,t,r){var a;a=function(e){var t;return e.mode.ECB=((t=e.lib.BlockCipherMode.extend()).Encryptor=t.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),t.Decryptor=t.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),t),e.mode.ECB},e.exports=a(r(4549),r(53797))},75261:function(e,t,r){var a;a=function(e){var t,r;return e.mode.OFB=(r=(t=e.lib.BlockCipherMode.extend()).Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,a=r.blockSize,s=this._iv,n=this._keystream;s&&(n=this._keystream=s.slice(0),this._iv=void 0),r.encryptBlock(n,0);for(var i=0;i<a;i++)e[t+i]^=n[i]}}),t.Decryptor=r,t),e.mode.OFB},e.exports=a(r(4549),r(53797))},24537:function(e,t,r){var a;a=function(e){return e.pad.AnsiX923={pad:function(e,t){var r=e.sigBytes,a=4*t,s=a-r%a,n=r+s-1;e.clamp(),e.words[n>>>2]|=s<<24-n%4*8,e.sigBytes+=s},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Ansix923},e.exports=a(r(4549),r(53797))},80345:function(e,t,r){var a;a=function(e){return e.pad.Iso10126={pad:function(t,r){var a=4*r,s=a-t.sigBytes%a;t.concat(e.lib.WordArray.random(s-1)).concat(e.lib.WordArray.create([s<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},e.pad.Iso10126},e.exports=a(r(4549),r(53797))},53742:function(e,t,r){var a;a=function(e){return e.pad.Iso97971={pad:function(t,r){t.concat(e.lib.WordArray.create([0x80000000],1)),e.pad.ZeroPadding.pad(t,r)},unpad:function(t){e.pad.ZeroPadding.unpad(t),t.sigBytes--}},e.pad.Iso97971},e.exports=a(r(4549),r(53797))},46668:function(e,t,r){var a;a=function(e){return e.pad.NoPadding={pad:function(){},unpad:function(){}},e.pad.NoPadding},e.exports=a(r(4549),r(53797))},40783:function(e,t,r){var a;a=function(e){return e.pad.ZeroPadding={pad:function(e,t){var r=4*t;e.clamp(),e.sigBytes+=r-(e.sigBytes%r||r)},unpad:function(e){for(var t=e.words,r=e.sigBytes-1,r=e.sigBytes-1;r>=0;r--)if(t[r>>>2]>>>24-r%4*8&255){e.sigBytes=r+1;break}}},e.pad.ZeroPadding},e.exports=a(r(4549),r(53797))},85975:function(e,t,r){var a;a=function(e){var t,r,a,s,n,i,o;return r=(t=e.lib).Base,a=t.WordArray,n=(s=e.algo).SHA256,i=s.HMAC,o=s.PBKDF2=r.extend({cfg:r.extend({keySize:4,hasher:n,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var r=this.cfg,s=i.create(r.hasher,e),n=a.create(),o=a.create([1]),l=n.words,u=o.words,c=r.keySize,d=r.iterations;l.length<c;){var p=s.update(t).finalize(o);s.reset();for(var h=p.words,f=h.length,m=p,y=1;y<d;y++){m=s.finalize(m),s.reset();for(var g=m.words,x=0;x<f;x++)h[x]^=g[x]}n.concat(p),u[0]++}return n.sigBytes=4*c,n}}),e.PBKDF2=function(e,t,r){return o.create(r).compute(e,t)},e.PBKDF2},e.exports=a(r(4549),r(49169),r(3505))},1632:function(e,t,r){var a;a=function(e){return function(){var t=e.lib.StreamCipher,r=e.algo,a=[],s=[],n=[],i=r.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],a=this._C=[e[2]<<16|e[2]>>>16,0xffff0000&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,0xffff0000&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,0xffff0000&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,0xffff0000&e[3]|65535&e[0]];this._b=0;for(var s=0;s<4;s++)o.call(this);for(var s=0;s<8;s++)a[s]^=r[s+4&7];if(t){var n=t.words,i=n[0],l=n[1],u=(i<<8|i>>>24)&0xff00ff|(i<<24|i>>>8)&0xff00ff00,c=(l<<8|l>>>24)&0xff00ff|(l<<24|l>>>8)&0xff00ff00,d=u>>>16|0xffff0000&c,p=c<<16|65535&u;a[0]^=u,a[1]^=d,a[2]^=c,a[3]^=p,a[4]^=u,a[5]^=d,a[6]^=c,a[7]^=p;for(var s=0;s<4;s++)o.call(this)}},_doProcessBlock:function(e,t){var r=this._X;o.call(this),a[0]=r[0]^r[5]>>>16^r[3]<<16,a[1]=r[2]^r[7]>>>16^r[5]<<16,a[2]=r[4]^r[1]>>>16^r[7]<<16,a[3]=r[6]^r[3]>>>16^r[1]<<16;for(var s=0;s<4;s++)a[s]=(a[s]<<8|a[s]>>>24)&0xff00ff|(a[s]<<24|a[s]>>>8)&0xff00ff00,e[t+s]^=a[s]},blockSize:4,ivSize:2});function o(){for(var e=this._X,t=this._C,r=0;r<8;r++)s[r]=t[r];t[0]=t[0]+0x4d34d34d+this._b|0,t[1]=t[1]+0xd34d34d3+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+0x34d34d34+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+0x4d34d34d+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+0xd34d34d3+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+0x34d34d34+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+0x4d34d34d+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+0xd34d34d3+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0;for(var r=0;r<8;r++){var a=e[r]+t[r],i=65535&a,o=a>>>16,l=((i*i>>>17)+i*o>>>15)+o*o,u=((0xffff0000&a)*a|0)+((65535&a)*a|0);n[r]=l^u}e[0]=n[0]+(n[7]<<16|n[7]>>>16)+(n[6]<<16|n[6]>>>16)|0,e[1]=n[1]+(n[0]<<8|n[0]>>>24)+n[7]|0,e[2]=n[2]+(n[1]<<16|n[1]>>>16)+(n[0]<<16|n[0]>>>16)|0,e[3]=n[3]+(n[2]<<8|n[2]>>>24)+n[1]|0,e[4]=n[4]+(n[3]<<16|n[3]>>>16)+(n[2]<<16|n[2]>>>16)|0,e[5]=n[5]+(n[4]<<8|n[4]>>>24)+n[3]|0,e[6]=n[6]+(n[5]<<16|n[5]>>>16)+(n[4]<<16|n[4]>>>16)|0,e[7]=n[7]+(n[6]<<8|n[6]>>>24)+n[5]|0}e.RabbitLegacy=t._createHelper(i)}(),e.RabbitLegacy},e.exports=a(r(4549),r(9406),r(74876),r(80046),r(53797))},22070:function(e,t,r){var a;a=function(e){return function(){var t=e.lib.StreamCipher,r=e.algo,a=[],s=[],n=[],i=r.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,r=0;r<4;r++)e[r]=(e[r]<<8|e[r]>>>24)&0xff00ff|(e[r]<<24|e[r]>>>8)&0xff00ff00;var a=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],s=this._C=[e[2]<<16|e[2]>>>16,0xffff0000&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,0xffff0000&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,0xffff0000&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,0xffff0000&e[3]|65535&e[0]];this._b=0;for(var r=0;r<4;r++)o.call(this);for(var r=0;r<8;r++)s[r]^=a[r+4&7];if(t){var n=t.words,i=n[0],l=n[1],u=(i<<8|i>>>24)&0xff00ff|(i<<24|i>>>8)&0xff00ff00,c=(l<<8|l>>>24)&0xff00ff|(l<<24|l>>>8)&0xff00ff00,d=u>>>16|0xffff0000&c,p=c<<16|65535&u;s[0]^=u,s[1]^=d,s[2]^=c,s[3]^=p,s[4]^=u,s[5]^=d,s[6]^=c,s[7]^=p;for(var r=0;r<4;r++)o.call(this)}},_doProcessBlock:function(e,t){var r=this._X;o.call(this),a[0]=r[0]^r[5]>>>16^r[3]<<16,a[1]=r[2]^r[7]>>>16^r[5]<<16,a[2]=r[4]^r[1]>>>16^r[7]<<16,a[3]=r[6]^r[3]>>>16^r[1]<<16;for(var s=0;s<4;s++)a[s]=(a[s]<<8|a[s]>>>24)&0xff00ff|(a[s]<<24|a[s]>>>8)&0xff00ff00,e[t+s]^=a[s]},blockSize:4,ivSize:2});function o(){for(var e=this._X,t=this._C,r=0;r<8;r++)s[r]=t[r];t[0]=t[0]+0x4d34d34d+this._b|0,t[1]=t[1]+0xd34d34d3+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+0x34d34d34+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+0x4d34d34d+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+0xd34d34d3+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+0x34d34d34+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+0x4d34d34d+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+0xd34d34d3+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0;for(var r=0;r<8;r++){var a=e[r]+t[r],i=65535&a,o=a>>>16,l=((i*i>>>17)+i*o>>>15)+o*o,u=((0xffff0000&a)*a|0)+((65535&a)*a|0);n[r]=l^u}e[0]=n[0]+(n[7]<<16|n[7]>>>16)+(n[6]<<16|n[6]>>>16)|0,e[1]=n[1]+(n[0]<<8|n[0]>>>24)+n[7]|0,e[2]=n[2]+(n[1]<<16|n[1]>>>16)+(n[0]<<16|n[0]>>>16)|0,e[3]=n[3]+(n[2]<<8|n[2]>>>24)+n[1]|0,e[4]=n[4]+(n[3]<<16|n[3]>>>16)+(n[2]<<16|n[2]>>>16)|0,e[5]=n[5]+(n[4]<<8|n[4]>>>24)+n[3]|0,e[6]=n[6]+(n[5]<<16|n[5]>>>16)+(n[4]<<16|n[4]>>>16)|0,e[7]=n[7]+(n[6]<<8|n[6]>>>24)+n[5]|0}e.Rabbit=t._createHelper(i)}(),e.Rabbit},e.exports=a(r(4549),r(9406),r(74876),r(80046),r(53797))},32713:function(e,t,r){var a;a=function(e){return function(){var t=e.lib.StreamCipher,r=e.algo,a=r.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,r=e.sigBytes,a=this._S=[],s=0;s<256;s++)a[s]=s;for(var s=0,n=0;s<256;s++){var i=s%r,o=t[i>>>2]>>>24-i%4*8&255;n=(n+a[s]+o)%256;var l=a[s];a[s]=a[n],a[n]=l}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=s.call(this)},keySize:8,ivSize:0});function s(){for(var e=this._S,t=this._i,r=this._j,a=0,s=0;s<4;s++){r=(r+e[t=(t+1)%256])%256;var n=e[t];e[t]=e[r],e[r]=n,a|=e[(e[t]+e[r])%256]<<24-8*s}return this._i=t,this._j=r,a}e.RC4=t._createHelper(a);var n=r.RC4Drop=a.extend({cfg:a.cfg.extend({drop:192}),_doReset:function(){a._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)s.call(this)}});e.RC4Drop=t._createHelper(n)}(),e.RC4},e.exports=a(r(4549),r(9406),r(74876),r(80046),r(53797))},63648:function(e,t,r){var a;a=function(e){return function(t){var r=e.lib,a=r.WordArray,s=r.Hasher,n=e.algo,i=a.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),o=a.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),l=a.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),u=a.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),c=a.create([0,0x5a827999,0x6ed9eba1,0x8f1bbcdc,0xa953fd4e]),d=a.create([0x50a28be6,0x5c4dd124,0x6d703ef3,0x7a6d76e9,0]),p=n.RIPEMD160=s.extend({_doReset:function(){this._hash=a.create([0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0])},_doProcessBlock:function(e,t){for(var r,a,s,n,p,f,m,y,g,x,v,w,b,_,k,S,T,E,I,C=0;C<16;C++){var A=t+C,R=e[A];e[A]=(R<<8|R>>>24)&0xff00ff|(R<<24|R>>>8)&0xff00ff00}var N=this._hash.words,O=c.words,P=d.words,U=i.words,$=o.words,j=l.words,M=u.words;_=g=N[0],k=x=N[1],S=v=N[2],T=w=N[3],E=b=N[4];for(var C=0;C<80;C+=1)I=g+e[t+U[C]]|0,C<16?I+=(x^v^w)+O[0]:C<32?I+=((r=x)&v|~r&w)+O[1]:C<48?I+=((x|~v)^w)+O[2]:C<64?I+=(a=x,s=v,(a&(n=w)|s&~n)+O[3]):I+=(x^(v|~w))+O[4],I|=0,I=(I=h(I,j[C]))+b|0,g=b,b=w,w=h(v,10),v=x,x=I,I=_+e[t+$[C]]|0,C<16?I+=(k^(S|~T))+P[0]:C<32?I+=(p=k,f=S,(p&(m=T)|f&~m)+P[1]):C<48?I+=((k|~S)^T)+P[2]:C<64?I+=((y=k)&S|~y&T)+P[3]:I+=(k^S^T)+P[4],I|=0,I=(I=h(I,M[C]))+E|0,_=E,E=T,T=h(S,10),S=k,k=I;I=N[1]+v+T|0,N[1]=N[2]+w+E|0,N[2]=N[3]+b+_|0,N[3]=N[4]+g+k|0,N[4]=N[0]+x+S|0,N[0]=I},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,a=8*e.sigBytes;t[a>>>5]|=128<<24-a%32,t[(a+64>>>9<<4)+14]=(r<<8|r>>>24)&0xff00ff|(r<<24|r>>>8)&0xff00ff00,e.sigBytes=(t.length+1)*4,this._process();for(var s=this._hash,n=s.words,i=0;i<5;i++){var o=n[i];n[i]=(o<<8|o>>>24)&0xff00ff|(o<<24|o>>>8)&0xff00ff00}return s},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function h(e,t){return e<<t|e>>>32-t}e.RIPEMD160=s._createHelper(p),e.HmacRIPEMD160=s._createHmacHelper(p)}(Math),e.RIPEMD160},e.exports=a(r(4549))},40379:function(e,t,r){var a;a=function(e){var t,r,a,s,n,i;return r=(t=e.lib).WordArray,a=t.Hasher,s=e.algo,n=[],i=s.SHA1=a.extend({_doReset:function(){this._hash=new r.init([0x67452301,0xefcdab89,0x98badcfe,0x10325476,0xc3d2e1f0])},_doProcessBlock:function(e,t){for(var r=this._hash.words,a=r[0],s=r[1],i=r[2],o=r[3],l=r[4],u=0;u<80;u++){if(u<16)n[u]=0|e[t+u];else{var c=n[u-3]^n[u-8]^n[u-14]^n[u-16];n[u]=c<<1|c>>>31}var d=(a<<5|a>>>27)+l+n[u];u<20?d+=(s&i|~s&o)+0x5a827999:u<40?d+=(s^i^o)+0x6ed9eba1:u<60?d+=(s&i|s&o|i&o)-0x70e44324:d+=(s^i^o)-0x359d3e2a,l=o,o=i,i=s<<30|s>>>2,s=a,a=d}r[0]=r[0]+a|0,r[1]=r[1]+s|0,r[2]=r[2]+i|0,r[3]=r[3]+o|0,r[4]=r[4]+l|0},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,a=8*e.sigBytes;return t[a>>>5]|=128<<24-a%32,t[(a+64>>>9<<4)+14]=Math.floor(r/0x100000000),t[(a+64>>>9<<4)+15]=r,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),e.SHA1=a._createHelper(i),e.HmacSHA1=a._createHmacHelper(i),e.SHA1},e.exports=a(r(4549))},49076:function(e,t,r){var a;a=function(e){var t,r,a,s;return t=e.lib.WordArray,a=(r=e.algo).SHA256,s=r.SHA224=a.extend({_doReset:function(){this._hash=new t.init([0xc1059ed8,0x367cd507,0x3070dd17,0xf70e5939,0xffc00b31,0x68581511,0x64f98fa7,0xbefa4fa4])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=4,e}}),e.SHA224=a._createHelper(s),e.HmacSHA224=a._createHmacHelper(s),e.SHA224},e.exports=a(r(4549),r(49169))},49169:function(e,t,r){var a;a=function(e){var t,r,a,s,n,i,o,l,u;return t=Math,a=(r=e.lib).WordArray,s=r.Hasher,n=e.algo,i=[],o=[],function(){function e(e){return(e-(0|e))*0x100000000|0}for(var r=2,a=0;a<64;)(function(e){for(var r=t.sqrt(e),a=2;a<=r;a++)if(!(e%a))return!1;return!0})(r)&&(a<8&&(i[a]=e(t.pow(r,.5))),o[a]=e(t.pow(r,1/3)),a++),r++}(),l=[],u=n.SHA256=s.extend({_doReset:function(){this._hash=new a.init(i.slice(0))},_doProcessBlock:function(e,t){for(var r=this._hash.words,a=r[0],s=r[1],n=r[2],i=r[3],u=r[4],c=r[5],d=r[6],p=r[7],h=0;h<64;h++){if(h<16)l[h]=0|e[t+h];else{var f=l[h-15],m=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,y=l[h-2],g=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;l[h]=m+l[h-7]+g+l[h-16]}var x=u&c^~u&d,v=a&s^a&n^s&n,w=(a<<30|a>>>2)^(a<<19|a>>>13)^(a<<10|a>>>22),b=p+((u<<26|u>>>6)^(u<<21|u>>>11)^(u<<7|u>>>25))+x+o[h]+l[h],_=w+v;p=d,d=c,c=u,u=i+b|0,i=n,n=s,s=a,a=b+_|0}r[0]=r[0]+a|0,r[1]=r[1]+s|0,r[2]=r[2]+n|0,r[3]=r[3]+i|0,r[4]=r[4]+u|0,r[5]=r[5]+c|0,r[6]=r[6]+d|0,r[7]=r[7]+p|0},_doFinalize:function(){var e=this._data,r=e.words,a=8*this._nDataBytes,s=8*e.sigBytes;return r[s>>>5]|=128<<24-s%32,r[(s+64>>>9<<4)+14]=t.floor(a/0x100000000),r[(s+64>>>9<<4)+15]=a,e.sigBytes=4*r.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}}),e.SHA256=s._createHelper(u),e.HmacSHA256=s._createHmacHelper(u),e.SHA256},e.exports=a(r(4549))},86641:function(e,t,r){var a;a=function(e){var t,r,a,s,n,i,o,l,u,c,d;return t=Math,a=(r=e.lib).WordArray,s=r.Hasher,n=e.x64.Word,i=e.algo,o=[],l=[],u=[],function(){for(var e=1,t=0,r=0;r<24;r++){o[e+5*t]=(r+1)*(r+2)/2%64;var a=t%5,s=(2*e+3*t)%5;e=a,t=s}for(var e=0;e<5;e++)for(var t=0;t<5;t++)l[e+5*t]=t+(2*e+3*t)%5*5;for(var i=1,c=0;c<24;c++){for(var d=0,p=0,h=0;h<7;h++){if(1&i){var f=(1<<h)-1;f<32?p^=1<<f:d^=1<<f-32}128&i?i=i<<1^113:i<<=1}u[c]=n.create(d,p)}}(),c=[],function(){for(var e=0;e<25;e++)c[e]=n.create()}(),d=i.SHA3=s.extend({cfg:s.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new n.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var r=this._state,a=this.blockSize/2,s=0;s<a;s++){var n=e[t+2*s],i=e[t+2*s+1];n=(n<<8|n>>>24)&0xff00ff|(n<<24|n>>>8)&0xff00ff00,i=(i<<8|i>>>24)&0xff00ff|(i<<24|i>>>8)&0xff00ff00;var d=r[s];d.high^=i,d.low^=n}for(var p=0;p<24;p++){for(var h=0;h<5;h++){for(var f=0,m=0,y=0;y<5;y++){var d=r[h+5*y];f^=d.high,m^=d.low}var g=c[h];g.high=f,g.low=m}for(var h=0;h<5;h++)for(var x=c[(h+4)%5],v=c[(h+1)%5],w=v.high,b=v.low,f=x.high^(w<<1|b>>>31),m=x.low^(b<<1|w>>>31),y=0;y<5;y++){var d=r[h+5*y];d.high^=f,d.low^=m}for(var _=1;_<25;_++){var f,m,d=r[_],k=d.high,S=d.low,T=o[_];T<32?(f=k<<T|S>>>32-T,m=S<<T|k>>>32-T):(f=S<<T-32|k>>>64-T,m=k<<T-32|S>>>64-T);var E=c[l[_]];E.high=f,E.low=m}var I=c[0],C=r[0];I.high=C.high,I.low=C.low;for(var h=0;h<5;h++)for(var y=0;y<5;y++){var _=h+5*y,d=r[_],A=c[_],R=c[(h+1)%5+5*y],N=c[(h+2)%5+5*y];d.high=A.high^~R.high&N.high,d.low=A.low^~R.low&N.low}var d=r[0],O=u[p];d.high^=O.high,d.low^=O.low}},_doFinalize:function(){var e=this._data,r=e.words;this._nDataBytes;var s=8*e.sigBytes,n=32*this.blockSize;r[s>>>5]|=1<<24-s%32,r[(t.ceil((s+1)/n)*n>>>5)-1]|=128,e.sigBytes=4*r.length,this._process();for(var i=this._state,o=this.cfg.outputLength/8,l=o/8,u=[],c=0;c<l;c++){var d=i[c],p=d.high,h=d.low;p=(p<<8|p>>>24)&0xff00ff|(p<<24|p>>>8)&0xff00ff00,h=(h<<8|h>>>24)&0xff00ff|(h<<24|h>>>8)&0xff00ff00,u.push(h),u.push(p)}return new a.init(u,o)},clone:function(){for(var e=s.clone.call(this),t=e._state=this._state.slice(0),r=0;r<25;r++)t[r]=t[r].clone();return e}}),e.SHA3=s._createHelper(d),e.HmacSHA3=s._createHmacHelper(d),e.SHA3},e.exports=a(r(4549),r(17376))},91821:function(e,t,r){var a;a=function(e){var t,r,a,s,n,i;return r=(t=e.x64).Word,a=t.WordArray,n=(s=e.algo).SHA512,i=s.SHA384=n.extend({_doReset:function(){this._hash=new a.init([new r.init(0xcbbb9d5d,0xc1059ed8),new r.init(0x629a292a,0x367cd507),new r.init(0x9159015a,0x3070dd17),new r.init(0x152fecd8,0xf70e5939),new r.init(0x67332667,0xffc00b31),new r.init(0x8eb44a87,0x68581511),new r.init(0xdb0c2e0d,0x64f98fa7),new r.init(0x47b5481d,0xbefa4fa4)])},_doFinalize:function(){var e=n._doFinalize.call(this);return e.sigBytes-=16,e}}),e.SHA384=n._createHelper(i),e.HmacSHA384=n._createHmacHelper(i),e.SHA384},e.exports=a(r(4549),r(17376),r(76324))},76324:function(e,t,r){var a;a=function(e){return function(){var t=e.lib.Hasher,r=e.x64,a=r.Word,s=r.WordArray,n=e.algo;function i(){return a.create.apply(a,arguments)}var o=[i(0x428a2f98,0xd728ae22),i(0x71374491,0x23ef65cd),i(0xb5c0fbcf,0xec4d3b2f),i(0xe9b5dba5,0x8189dbbc),i(0x3956c25b,0xf348b538),i(0x59f111f1,0xb605d019),i(0x923f82a4,0xaf194f9b),i(0xab1c5ed5,0xda6d8118),i(0xd807aa98,0xa3030242),i(0x12835b01,0x45706fbe),i(0x243185be,0x4ee4b28c),i(0x550c7dc3,0xd5ffb4e2),i(0x72be5d74,0xf27b896f),i(0x80deb1fe,0x3b1696b1),i(0x9bdc06a7,0x25c71235),i(0xc19bf174,0xcf692694),i(0xe49b69c1,0x9ef14ad2),i(0xefbe4786,0x384f25e3),i(0xfc19dc6,0x8b8cd5b5),i(0x240ca1cc,0x77ac9c65),i(0x2de92c6f,0x592b0275),i(0x4a7484aa,0x6ea6e483),i(0x5cb0a9dc,0xbd41fbd4),i(0x76f988da,0x831153b5),i(0x983e5152,0xee66dfab),i(0xa831c66d,0x2db43210),i(0xb00327c8,0x98fb213f),i(0xbf597fc7,0xbeef0ee4),i(0xc6e00bf3,0x3da88fc2),i(0xd5a79147,0x930aa725),i(0x6ca6351,0xe003826f),i(0x14292967,0xa0e6e70),i(0x27b70a85,0x46d22ffc),i(0x2e1b2138,0x5c26c926),i(0x4d2c6dfc,0x5ac42aed),i(0x53380d13,0x9d95b3df),i(0x650a7354,0x8baf63de),i(0x766a0abb,0x3c77b2a8),i(0x81c2c92e,0x47edaee6),i(0x92722c85,0x1482353b),i(0xa2bfe8a1,0x4cf10364),i(0xa81a664b,0xbc423001),i(0xc24b8b70,0xd0f89791),i(0xc76c51a3,0x654be30),i(0xd192e819,0xd6ef5218),i(0xd6990624,0x5565a910),i(0xf40e3585,0x5771202a),i(0x106aa070,0x32bbd1b8),i(0x19a4c116,0xb8d2d0c8),i(0x1e376c08,0x5141ab53),i(0x2748774c,0xdf8eeb99),i(0x34b0bcb5,0xe19b48a8),i(0x391c0cb3,0xc5c95a63),i(0x4ed8aa4a,0xe3418acb),i(0x5b9cca4f,0x7763e373),i(0x682e6ff3,0xd6b2b8a3),i(0x748f82ee,0x5defb2fc),i(0x78a5636f,0x43172f60),i(0x84c87814,0xa1f0ab72),i(0x8cc70208,0x1a6439ec),i(0x90befffa,0x23631e28),i(0xa4506ceb,0xde82bde9),i(0xbef9a3f7,0xb2c67915),i(0xc67178f2,0xe372532b),i(0xca273ece,0xea26619c),i(0xd186b8c7,0x21c0c207),i(0xeada7dd6,0xcde0eb1e),i(0xf57d4f7f,0xee6ed178),i(0x6f067aa,0x72176fba),i(0xa637dc5,0xa2c898a6),i(0x113f9804,0xbef90dae),i(0x1b710b35,0x131c471b),i(0x28db77f5,0x23047d84),i(0x32caab7b,0x40c72493),i(0x3c9ebe0a,0x15c9bebc),i(0x431d67c4,0x9c100d4c),i(0x4cc5d4be,0xcb3e42b6),i(0x597f299c,0xfc657e2a),i(0x5fcb6fab,0x3ad6faec),i(0x6c44198c,0x4a475817)],l=[];!function(){for(var e=0;e<80;e++)l[e]=i()}();var u=n.SHA512=t.extend({_doReset:function(){this._hash=new s.init([new a.init(0x6a09e667,0xf3bcc908),new a.init(0xbb67ae85,0x84caa73b),new a.init(0x3c6ef372,0xfe94f82b),new a.init(0xa54ff53a,0x5f1d36f1),new a.init(0x510e527f,0xade682d1),new a.init(0x9b05688c,0x2b3e6c1f),new a.init(0x1f83d9ab,0xfb41bd6b),new a.init(0x5be0cd19,0x137e2179)])},_doProcessBlock:function(e,t){for(var r=this._hash.words,a=r[0],s=r[1],n=r[2],i=r[3],u=r[4],c=r[5],d=r[6],p=r[7],h=a.high,f=a.low,m=s.high,y=s.low,g=n.high,x=n.low,v=i.high,w=i.low,b=u.high,_=u.low,k=c.high,S=c.low,T=d.high,E=d.low,I=p.high,C=p.low,A=h,R=f,N=m,O=y,P=g,U=x,$=v,j=w,M=b,B=_,F=k,q=S,D=T,L=E,H=I,W=C,z=0;z<80;z++){var J,Z,K=l[z];if(z<16)Z=K.high=0|e[t+2*z],J=K.low=0|e[t+2*z+1];else{var V=l[z-15],G=V.high,Q=V.low,Y=(G>>>1|Q<<31)^(G>>>8|Q<<24)^G>>>7,X=(Q>>>1|G<<31)^(Q>>>8|G<<24)^(Q>>>7|G<<25),ee=l[z-2],et=ee.high,er=ee.low,ea=(et>>>19|er<<13)^(et<<3|er>>>29)^et>>>6,es=(er>>>19|et<<13)^(er<<3|et>>>29)^(er>>>6|et<<26),en=l[z-7],ei=en.high,eo=en.low,el=l[z-16],eu=el.high,ec=el.low;Z=Y+ei+((J=X+eo)>>>0<X>>>0?1:0),J+=es,Z=Z+ea+(J>>>0<es>>>0?1:0),J+=ec,Z=Z+eu+(J>>>0<ec>>>0?1:0),K.high=Z,K.low=J}var ed=M&F^~M&D,ep=B&q^~B&L,eh=A&N^A&P^N&P,ef=R&O^R&U^O&U,em=(A>>>28|R<<4)^(A<<30|R>>>2)^(A<<25|R>>>7),ey=(R>>>28|A<<4)^(R<<30|A>>>2)^(R<<25|A>>>7),eg=(M>>>14|B<<18)^(M>>>18|B<<14)^(M<<23|B>>>9),ex=(B>>>14|M<<18)^(B>>>18|M<<14)^(B<<23|M>>>9),ev=o[z],ew=ev.high,eb=ev.low,e_=W+ex,ek=H+eg+(e_>>>0<W>>>0?1:0),e_=e_+ep,ek=ek+ed+(e_>>>0<ep>>>0?1:0),e_=e_+eb,ek=ek+ew+(e_>>>0<eb>>>0?1:0),e_=e_+J,ek=ek+Z+(e_>>>0<J>>>0?1:0),eS=ey+ef,eT=em+eh+(eS>>>0<ey>>>0?1:0);H=D,W=L,D=F,L=q,F=M,q=B,M=$+ek+((B=j+e_|0)>>>0<j>>>0?1:0)|0,$=P,j=U,P=N,U=O,N=A,O=R,A=ek+eT+((R=e_+eS|0)>>>0<e_>>>0?1:0)|0}f=a.low=f+R,a.high=h+A+(f>>>0<R>>>0?1:0),y=s.low=y+O,s.high=m+N+(y>>>0<O>>>0?1:0),x=n.low=x+U,n.high=g+P+(x>>>0<U>>>0?1:0),w=i.low=w+j,i.high=v+$+(w>>>0<j>>>0?1:0),_=u.low=_+B,u.high=b+M+(_>>>0<B>>>0?1:0),S=c.low=S+q,c.high=k+F+(S>>>0<q>>>0?1:0),E=d.low=E+L,d.high=T+D+(E>>>0<L>>>0?1:0),C=p.low=C+W,p.high=I+H+(C>>>0<W>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,r=8*this._nDataBytes,a=8*e.sigBytes;return t[a>>>5]|=128<<24-a%32,t[(a+128>>>10<<5)+30]=Math.floor(r/0x100000000),t[(a+128>>>10<<5)+31]=r,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(u),e.HmacSHA512=t._createHmacHelper(u)}(),e.SHA512},e.exports=a(r(4549),r(17376))},3356:function(e,t,r){var a;a=function(e){return function(){var t=e.lib,r=t.WordArray,a=t.BlockCipher,s=e.algo,n=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],i=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],o=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],l=[{0:8421888,0x10000000:32768,0x20000000:8421378,0x30000000:2,0x40000000:512,0x50000000:8421890,0x60000000:8389122,0x70000000:8388608,0x80000000:514,0x90000000:8389120,0xa0000000:33280,0xb0000000:8421376,0xc0000000:32770,0xd0000000:8388610,0xe0000000:0,0xf0000000:33282,0x8000000:0,0x18000000:8421890,0x28000000:33282,0x38000000:32768,0x48000000:8421888,0x58000000:512,0x68000000:8421378,0x78000000:2,0x88000000:8389120,0x98000000:33280,0xa8000000:8421376,0xb8000000:8389122,0xc8000000:8388610,0xd8000000:32770,0xe8000000:514,0xf8000000:8388608,1:32768,0x10000001:2,0x20000001:8421888,0x30000001:8388608,0x40000001:8421378,0x50000001:33280,0x60000001:512,0x70000001:8389122,0x80000001:8421890,0x90000001:8421376,0xa0000001:8388610,0xb0000001:33282,0xc0000001:514,0xd0000001:8389120,0xe0000001:32770,0xf0000001:0,0x8000001:8421890,0x18000001:8421376,0x28000001:8388608,0x38000001:512,0x48000001:32768,0x58000001:8388610,0x68000001:2,0x78000001:33282,0x88000001:32770,0x98000001:8389122,0xa8000001:514,0xb8000001:8421888,0xc8000001:8389120,0xd8000001:0,0xe8000001:33280,0xf8000001:8421378},{0:0x40084010,0x1000000:16384,0x2000000:524288,0x3000000:0x40080010,0x4000000:0x40000010,0x5000000:0x40084000,0x6000000:0x40004000,0x7000000:16,0x8000000:540672,0x9000000:0x40004010,0xa000000:0x40000000,0xb000000:540688,0xc000000:524304,0xd000000:0,0xe000000:16400,0xf000000:0x40080000,8388608:0x40004000,0x1800000:540688,0x2800000:16,0x3800000:0x40004010,0x4800000:0x40084010,0x5800000:0x40000000,0x6800000:524288,0x7800000:0x40080010,0x8800000:524304,0x9800000:0,0xa800000:16384,0xb800000:0x40080000,0xc800000:0x40000010,0xd800000:540672,0xe800000:0x40084000,0xf800000:16400,0x10000000:0,0x11000000:0x40080010,0x12000000:0x40004010,0x13000000:0x40084000,0x14000000:0x40080000,0x15000000:16,0x16000000:540688,0x17000000:16384,0x18000000:16400,0x19000000:524288,0x1a000000:524304,0x1b000000:0x40000010,0x1c000000:540672,0x1d000000:0x40004000,0x1e000000:0x40000000,0x1f000000:0x40084010,0x10800000:540688,0x11800000:524288,0x12800000:0x40080000,0x13800000:16384,0x14800000:0x40004000,0x15800000:0x40084010,0x16800000:16,0x17800000:0x40000000,0x18800000:0x40084000,0x19800000:0x40000010,0x1a800000:0x40004010,0x1b800000:524304,0x1c800000:0,0x1d800000:16400,0x1e800000:0x40080010,0x1f800000:540672},{0:260,1048576:0,2097152:0x4000100,3145728:65796,4194304:65540,5242880:0x4000004,6291456:0x4010104,7340032:0x4010000,8388608:0x4000000,9437184:0x4010100,0xa00000:65792,0xb00000:0x4010004,0xc00000:0x4000104,0xd00000:65536,0xe00000:4,0xf00000:256,524288:0x4010100,1572864:0x4010004,2621440:0,3670016:0x4000100,4718592:0x4000004,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,0xa80000:0x4010000,0xb80000:65796,0xc80000:65792,0xd80000:0x4000104,0xe80000:0x4010104,0xf80000:0x4000000,0x1000000:0x4010100,0x1100000:65540,0x1200000:65536,0x1300000:0x4000100,0x1400000:256,0x1500000:0x4010104,0x1600000:0x4000004,0x1700000:0,0x1800000:0x4000104,0x1900000:0x4000000,0x1a00000:4,0x1b00000:65792,0x1c00000:0x4010000,0x1d00000:260,0x1e00000:65796,0x1f00000:0x4010004,0x1080000:0x4000000,0x1180000:260,0x1280000:0x4010100,0x1380000:0,0x1480000:65540,0x1580000:0x4000100,0x1680000:256,0x1780000:0x4010004,0x1880000:65536,0x1980000:0x4010104,0x1a80000:65796,0x1b80000:0x4000004,0x1c80000:0x4000104,0x1d80000:0x4010000,0x1e80000:4,0x1f80000:65792},{0:0x80401000,65536:0x80001040,131072:4198464,196608:0x80400000,262144:0,327680:4198400,393216:0x80000040,458752:4194368,524288:0x80000000,589824:4194304,655360:64,720896:0x80001000,786432:0x80400040,851968:4160,917504:4096,983040:0x80401040,32768:0x80001040,98304:64,163840:0x80400040,229376:0x80001000,294912:4198400,360448:0x80401040,425984:0,491520:0x80400000,557056:4096,622592:0x80401000,688128:4194304,753664:4160,819200:0x80000000,884736:4194368,950272:4198464,1015808:0x80000040,1048576:4194368,1114112:4198400,1179648:0x80000040,1245184:0,1310720:4160,1376256:0x80400040,1441792:0x80401000,1507328:0x80001040,1572864:0x80401040,1638400:0x80000000,1703936:0x80400000,1769472:4198464,1835008:0x80001000,1900544:4194304,1966080:64,2031616:4096,1081344:0x80400000,1146880:0x80401040,1212416:0,1277952:4198400,1343488:4194368,1409024:0x80000000,1474560:0x80001040,1540096:64,1605632:0x80000040,1671168:4096,1736704:0x80001000,1802240:0x80400040,1867776:4160,1933312:0x80401000,1998848:4194304,2064384:4198464},{0:128,4096:0x1040000,8192:262144,12288:0x20000000,16384:0x20040080,20480:0x1000080,24576:0x21000080,28672:262272,32768:0x1000000,36864:0x20040000,40960:0x20000080,45056:0x21040080,49152:0x21040000,53248:0,57344:0x1040080,61440:0x21000000,2048:0x1040080,6144:0x21000080,10240:128,14336:0x1040000,18432:262144,22528:0x20040080,26624:0x21040000,30720:0x20000000,34816:0x20040000,38912:0,43008:0x21040080,47104:0x1000080,51200:0x20000080,55296:0x21000000,59392:0x1000000,63488:262272,65536:262144,69632:128,73728:0x20000000,77824:0x21000080,81920:0x1000080,86016:0x21040000,90112:0x20040080,94208:0x1000000,98304:0x21040080,102400:0x21000000,106496:0x1040000,110592:0x20040000,114688:262272,118784:0x20000080,122880:0,126976:0x1040080,67584:0x21000080,71680:0x1000000,75776:0x1040000,79872:0x20040080,83968:0x20000000,88064:0x1040080,92160:128,96256:0x21040000,100352:262272,104448:0x21040080,108544:0,112640:0x21000000,116736:0x1000080,120832:262144,124928:0x20040000,129024:0x20000080},{0:0x10000008,256:8192,512:0x10200000,768:0x10202008,1024:0x10002000,1280:2097152,1536:2097160,1792:0x10000000,2048:0,2304:0x10002008,2560:2105344,2816:8,3072:0x10200008,3328:2105352,3584:8200,3840:0x10202000,128:0x10200000,384:0x10202008,640:8,896:2097152,1152:2105352,1408:0x10000008,1664:0x10002000,1920:8200,2176:2097160,2432:8192,2688:0x10002008,2944:0x10200008,3200:0,3456:0x10202000,3712:2105344,3968:0x10000000,4096:0x10002000,4352:0x10200008,4608:0x10202008,4864:8200,5120:2097152,5376:0x10000000,5632:0x10000008,5888:2105344,6144:2105352,6400:0,6656:8,6912:0x10200000,7168:8192,7424:0x10002008,7680:0x10202000,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:0x10000008,5248:0x10002000,5504:8200,5760:0x10202008,6016:0x10200000,6272:0x10202000,6528:0x10200008,6784:8192,7040:2105352,7296:2097160,7552:0,7808:0x10000000,8064:0x10002008},{0:1048576,16:0x2000401,32:1024,48:1049601,64:0x2100401,80:0,96:1,112:0x2100001,128:0x2000400,144:1048577,160:0x2000001,176:0x2100400,192:0x2100000,208:1025,224:1049600,240:0x2000000,8:0x2100001,24:0,40:0x2000401,56:0x2100400,72:1048576,88:0x2000001,104:0x2000000,120:1025,136:1049601,152:0x2000400,168:0x2100000,184:1048577,200:1024,216:0x2100401,232:1,248:1049600,256:0x2000000,272:1048576,288:0x2000401,304:0x2100001,320:1048577,336:0x2000400,352:0x2100400,368:1049601,384:1025,400:0x2100401,416:1049600,432:1,448:0,464:0x2100000,480:0x2000001,496:1024,264:1049600,280:0x2000401,296:0x2100001,312:1,328:0x2000000,344:1048576,360:1025,376:0x2100400,392:0x2000001,408:0x2100000,424:0,440:0x2100401,456:1049601,472:1024,488:0x2000400,504:1048577},{0:0x8000820,1:131072,2:0x8000000,3:32,4:131104,5:0x8020820,6:0x8020800,7:2048,8:0x8020000,9:0x8000800,10:133120,11:0x8020020,12:2080,13:0,14:0x8000020,15:133152,0x80000000:2048,0x80000001:0x8020820,0x80000002:0x8000820,0x80000003:0x8000000,0x80000004:0x8020000,0x80000005:133120,0x80000006:133152,0x80000007:32,0x80000008:0x8000020,0x80000009:2080,0x8000000a:131104,0x8000000b:0x8020800,0x8000000c:0,0x8000000d:0x8020020,0x8000000e:0x8000800,0x8000000f:131072,16:133152,17:0x8020800,18:32,19:2048,20:0x8000800,21:0x8000020,22:0x8020020,23:131072,24:0,25:131104,26:0x8020000,27:0x8000820,28:0x8020820,29:133120,30:2080,31:0x8000000,0x80000010:131072,0x80000011:2048,0x80000012:0x8020020,0x80000013:133152,0x80000014:32,0x80000015:0x8020000,0x80000016:0x8000000,0x80000017:0x8000820,0x80000018:0x8020820,0x80000019:0x8000020,0x8000001a:0x8000800,0x8000001b:0,0x8000001c:133120,0x8000001d:2080,0x8000001e:131104,0x8000001f:0x8020800}],u=[0xf8000001,0x1f800000,0x1f80000,2064384,129024,8064,504,0x8000001f],c=s.DES=a.extend({_doReset:function(){for(var e=this._key.words,t=[],r=0;r<56;r++){var a=n[r]-1;t[r]=e[a>>>5]>>>31-a%32&1}for(var s=this._subKeys=[],l=0;l<16;l++){for(var u=s[l]=[],c=o[l],r=0;r<24;r++)u[r/6|0]|=t[(i[r]-1+c)%28]<<31-r%6,u[4+(r/6|0)]|=t[28+(i[r+24]-1+c)%28]<<31-r%6;u[0]=u[0]<<1|u[0]>>>31;for(var r=1;r<7;r++)u[r]=u[r]>>>(r-1)*4+3;u[7]=u[7]<<5|u[7]>>>27}for(var d=this._invSubKeys=[],r=0;r<16;r++)d[r]=s[15-r]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,r){this._lBlock=e[t],this._rBlock=e[t+1],d.call(this,4,0xf0f0f0f),d.call(this,16,65535),p.call(this,2,0x33333333),p.call(this,8,0xff00ff),d.call(this,1,0x55555555);for(var a=0;a<16;a++){for(var s=r[a],n=this._lBlock,i=this._rBlock,o=0,c=0;c<8;c++)o|=l[c][((i^s[c])&u[c])>>>0];this._lBlock=i,this._rBlock=n^o}var h=this._lBlock;this._lBlock=this._rBlock,this._rBlock=h,d.call(this,1,0x55555555),p.call(this,8,0xff00ff),p.call(this,2,0x33333333),d.call(this,16,65535),d.call(this,4,0xf0f0f0f),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function d(e,t){var r=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=r,this._lBlock^=r<<e}function p(e,t){var r=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=r,this._rBlock^=r<<e}e.DES=a._createHelper(c);var h=s.TripleDES=a.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),a=e.length<4?e.slice(0,2):e.slice(2,4),s=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=c.createEncryptor(r.create(t)),this._des2=c.createEncryptor(r.create(a)),this._des3=c.createEncryptor(r.create(s))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=a._createHelper(h)}(),e.TripleDES},e.exports=a(r(4549),r(9406),r(74876),r(80046),r(53797))},17376:function(e,t,r){var a;a=function(e){var t,r,a,s;return r=(t=e.lib).Base,a=t.WordArray,(s=e.x64={}).Word=r.extend({init:function(e,t){this.high=e,this.low=t}}),s.WordArray=r.extend({init:function(e,t){e=this.words=e||[],void 0!=t?this.sigBytes=t:this.sigBytes=8*e.length},toX32:function(){for(var e=this.words,t=e.length,r=[],s=0;s<t;s++){var n=e[s];r.push(n.high),r.push(n.low)}return a.create(r,this.sigBytes)},clone:function(){for(var e=r.clone.call(this),t=e.words=this.words.slice(0),a=t.length,s=0;s<a;s++)t[s]=t[s].clone();return e}}),e},e.exports=a(r(4549))},42706:(e,t,r)=>{"use strict";e.exports=r(44870)},5487:e=>{"use strict";let t="undefined"!=typeof Buffer,r=/"(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])"\s*:/,a=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/;function s(e,s,i){null==i&&null!==s&&"object"==typeof s&&(i=s,s=void 0),t&&Buffer.isBuffer(e)&&(e=e.toString()),e&&65279===e.charCodeAt(0)&&(e=e.slice(1));let o=JSON.parse(e,s);if(null===o||"object"!=typeof o)return o;let l=i&&i.protoAction||"error",u=i&&i.constructorAction||"error";if("ignore"===l&&"ignore"===u)return o;if("ignore"!==l&&"ignore"!==u){if(!1===r.test(e)&&!1===a.test(e))return o}else if("ignore"!==l&&"ignore"===u){if(!1===r.test(e))return o}else if(!1===a.test(e))return o;return n(o,{protoAction:l,constructorAction:u,safe:i&&i.safe})}function n(e,{protoAction:t="error",constructorAction:r="error",safe:a}={}){let s=[e];for(;s.length;){let e=s;for(let n of(s=[],e)){if("ignore"!==t&&Object.prototype.hasOwnProperty.call(n,"__proto__")){if(!0===a)return null;if("error"===t)throw SyntaxError("Object contains forbidden prototype property");delete n.__proto__}if("ignore"!==r&&Object.prototype.hasOwnProperty.call(n,"constructor")&&Object.prototype.hasOwnProperty.call(n.constructor,"prototype")){if(!0===a)return null;if("error"===r)throw SyntaxError("Object contains forbidden prototype property");delete n.constructor}for(let e in n){let t=n[e];t&&"object"==typeof t&&s.push(t)}}}return e}function i(e,t,r){let a=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return s(e,t,r)}finally{Error.stackTraceLimit=a}}e.exports=i,e.exports.default=i,e.exports.parse=i,e.exports.safeParse=function(e,t){let r=Error.stackTraceLimit;Error.stackTraceLimit=0;try{return s(e,t,{safe:!0})}catch(e){return null}finally{Error.stackTraceLimit=r}},e.exports.scan=n}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),a=t.X(0,[994,980],()=>r(50700));module.exports=a})();